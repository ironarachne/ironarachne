var Ta=Object.defineProperty;var xa=(r,e,a)=>e in r?Ta(r,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):r[e]=a;var c=(r,e,a)=>(xa(r,typeof e!="symbol"?e+"":e,a),a);import{s as _a,n as $t,r as La,o as ka}from"../chunks/scheduler.4deff733.js";import{S as Ca,i as Ra,s as E,g as C,m as I,z as ja,f as x,c as O,h as R,j as B,x as ee,n as D,k as y,a as X,y as f,D as xe,C as Ne,G as Xe,o as U,A as ge,e as Gt}from"../chunks/index.40f68b98.js";import{g as Ea}from"../chunks/globals.7f7f1b26.js";import{e as Z}from"../chunks/each.e59479a4.js";import{v as $e}from"../chunks/currency.8e2112d0.js";import{w as _e,r as H,i as T,c as re,a as mt,b as Oa}from"../chunks/index.960e07c4.js";import{c as ut,b as Le,a as ma,t as At}from"../chunks/index.a61fa5dd.js";import{r as Na,g as Mt,a as It,b as Dt,c as $a,d as Ga,s as Ge,w as Aa,e as Ma,f as S,h as We,i as wt,j as Pe}from"../chunks/characters.38564557.js";import{g as Ia}from"../chunks/premade_configs.822d4812.js";import{r as Da,g as Va}from"../chunks/size_matrix.e52d484f.js";import{a as Vt,g as Sa,b as Ha}from"../chunks/climates.327e0d8d.js";import{M as Ya,w as Ba,a as qa,b as Xa,c as Fa,f as Wa,d as Pa}from"../chunks/patterns.88c2829e.js";import{G as Ue}from"../chunks/lodash.50d9611c.js";import{r as ae}from"../chunks/dice.f60f190e.js";function Ua(r){let e=_e(r.speciesOptions),a=Da(r.ageCategoryNames,e.ageCategories),t=H.int(a.minAge,a.maxAge);const n=T(r.genderNames);let s=e.genders.find(p=>p.name===n);const l=Va(s.name,a.name,e.sizeGeneratorConfigMatrix),i=H.int(l.minHeight,l.maxHeight),o=H.int(l.minWeight,l.maxWeight),h=H.int(l.minLength,l.maxLength);let m=Na(e),u=["cautious","hunting","lethargic","resting","sleeping","stalking"],d=T(u),b=e.abilities,v=e.baseThreatLevel;for(let p=0;p<b.length;p++)v+=b[p].threatLevel;return{name:e.name,description:e.description,summary:d,statBlock:null,species:e,abilities:b,behaviors:u,threatLevel:v,physicalTraits:m,gender:s,height:i,weight:o,length:h,age:t,ageCategory:a,carried:[],tags:e.tags,creatureTypes:e.creatureTypes}}function Qa(){return{ageCategoryNames:["adult"],genderNames:["female","male"],speciesOptions:[]}}function Ka(r){let e=[];if(r.template===null)throw new Error("EncounterGenerator requires a template.");for(let t=0;t<r.template.groupTemplates.length;t++){let n=[],s=r.template.groupTemplates[t],l=H.int(s.minNumber,s.maxNumber),i=[],o=[];s.isSentient?o=JSON.parse(JSON.stringify(r.sentientOptions)):o=JSON.parse(JSON.stringify(r.creatureOptions));let h=s.filter.withAllTags.concat(s.filter.withAnyTag);if(h.includes("undead")){let m=o.concat(Mt(o)),u=o.concat(It(o)),d=o.concat(Dt(o));o=o.concat(m),o=o.concat(u),o=o.concat(d)}else if(h.includes("skeleton")){let m=o.concat(Mt(o));o=o.concat(m)}else if(h.includes("vampire")){let m=o.concat(It(o));o=o.concat(m)}else if(h.includes("zombie")){let m=o.concat(Dt(o));o=o.concat(m)}i=s.filter.apply(o),i.length===0&&(console.error("No options for filter",s.filter),console.debug("Used options",o)),s.isSentient?n=Za(i,s.archetypes,l):n=Ja(i,l),e.push({name:s.name,mobs:n})}let a=0;for(let t=0;t<e.length;t++){let n=e[t];for(let s=0;s<n.mobs.length;s++)a+=n.mobs[s].threatLevel}return{groups:e,totalThreatLevel:a}}function Ja(r,e){let a=T(r),t=[],n=Qa();for(let s=0;s<e;s++){n.speciesOptions=[a];let l=Ua(n);t.push(l)}return t}function Za(r,e,a){let t=T(r),n=[],s=Ia();s.speciesOptions=[t];for(let l=0;l<a;l++){let i=$a(s);i.archetype=T(e),i.abilities=i.abilities.concat(i.archetype.abilities),i.threatLevel=Ga(i),i.summary=`${i.gender.name} ${i.species.adjective} ${i.archetype.name}`;for(let o=0;o<i.archetype.itemGenerators.length;o++)i.carried.push(i.archetype.itemGenerators[o].generate());n.push(i)}return n}function za(){return{isHostile:!0,environment:"forest",template:null,sentientOptions:Ge(),creatureOptions:Aa("sentient",Ma),minThreatLevel:1,maxThreatLevel:4}}function Qe(r,e){return Math.sqrt(Math.pow(e.x-r.x,2)+Math.pow(e.y-r.y,2))}function er(r){let e=[];for(let a=0;a<r.length;a++){let t=r[a],n=r[0];a<r.length-1&&(n=r[a+1]);let s={a:t,b:n};e.push(s)}return e}function tr(r){let e=(r.a.x+r.b.x)/2,a=(r.a.y+r.b.y)/2;return{x:e,y:a}}function ar(r){return(r.b.y-r.a.y)/(r.b.x-r.a.x)}function yt(r,e){return r.x==e.x&&r.y==e.y}function rr(r,e){for(let a=0;a<e.length;a++)if(yt(r,e[a]))return!0;return!1}class nr{constructor(){c(this,"id");c(this,"name");c(this,"description");c(this,"objectId");c(this,"strength");c(this,"isLocked");this.id="",this.name="a lock",this.description="a lock",this.objectId=-1,this.strength=1,this.isLocked=!0}}const ft=0,Tt=1,xt=2,gt=3,ua=4,fa=5;class ne{constructor(e,a,t,n,s,l,i,o,h,m,u,d,b){c(this,"name");c(this,"allowedEnvironments");c(this,"minWidth");c(this,"maxWidth");c(this,"minHeight");c(this,"maxHeight");c(this,"flooringOptions");c(this,"dressingGenerators");c(this,"featureGenerators");c(this,"mutators");c(this,"shapes");c(this,"tags");c(this,"commonality");this.name=e,this.allowedEnvironments=a,this.minWidth=t,this.maxWidth=s,this.minHeight=n,this.maxHeight=l,this.flooringOptions=i,this.dressingGenerators=o,this.featureGenerators=h,this.mutators=m,this.shapes=u,this.tags=d,this.commonality=b}}class sr{constructor(){c(this,"id");c(this,"name");c(this,"description");c(this,"secrets");c(this,"shape");c(this,"tileMesh");c(this,"tiles");c(this,"vertices");c(this,"minX");c(this,"minY");c(this,"maxX");c(this,"maxY");c(this,"center");c(this,"lightLevel");c(this,"features");c(this,"treasureCaches");c(this,"encounters");c(this,"theme");c(this,"doors");this.id=-1,this.name="",this.tileMesh=[],this.encounters=[],this.features=[],this.doors=[],this.description="",this.minX=0,this.minY=0,this.maxX=0,this.maxY=0,this.center={x:0,y:0},this.shape={vertices:[],edges:[]},this.theme=new ne("",[],0,0,0,0,[],[],[],[],[],[],0),this.secrets="",this.tiles=[],this.treasureCaches=[],this.vertices=[],this.lightLevel=0}calculateTileMesh(){let e=[],a=this.minY,t=this.maxY,n=this.minX,s=this.maxX;for(let l=a;l<t;l++)for(let i=n;i<s;i++){let o={vertices:[],edges:[]};o.vertices=[{x:i-.5,y:l-.5},{x:i+.5,y:l-.5},{x:i+.5,y:l+.5},{x:i-.5,y:l+.5}],o.edges=er(o.vertices),e.push(o)}this.tileMesh=e}calculateTiles(e,a){let t=[];for(let n=0;n<a;n++){let s=[];t[n]=s;for(let l=0;l<e;l++)t[n][l]=ft}for(let n=0;n<this.vertices.length;n++)this.vertices[n].y>t.length-1&&console.debug(`Vertices outside the bounds of the map: ${t.length} newTiles.length, ${this.vertices[n].y} this.vertices[i].y`,this.vertices),t[this.vertices[n].y][this.vertices[n].x]=Tt;this.tiles=t}calculateVertices(){let e=[];for(let a=0;a<this.tiles.length;a++)for(let t=0;t<this.tiles[a].length;t++)this.tiles[a][t]!=ft&&e.push({x:t,y:a});this.vertices=e}getTileEdges(){let e=[];for(let a=0;a<this.tileMesh.length;a++)for(let t=0;t<this.tileMesh[a].edges.length;t++)e.push(this.tileMesh[a].edges[t]);return e}getCenter(){let e=this.minX+(this.maxX-this.minX)/2,a=this.minY+(this.maxY-this.minY)/2;return{x:e,y:a}}getMinX(){let e=this.vertices[0].x;for(let a=0;a<this.vertices.length;a++)this.vertices[a].x<e&&(e=this.vertices[a].x);return e}getMaxX(){let e=this.vertices[0].x;for(let a=0;a<this.vertices.length;a++)this.vertices[a].x>e&&(e=this.vertices[a].x);return e}getMinY(){let e=this.vertices[0].y;for(let a=0;a<this.vertices.length;a++)this.vertices[a].y<e&&(e=this.vertices[a].y);return e}getMaxY(){let e=this.vertices[0].y;for(let a=0;a<this.vertices.length;a++)this.vertices[a].y>e&&(e=this.vertices[a].y);return e}getHeight(){return this.maxY-this.minY}getWidth(){return this.maxX-this.minX}moveBy(e,a,t,n){for(let s=0;s<this.vertices.length;s++)this.vertices[s].x+=e,this.vertices[s].y+=a;this.calculateTiles(t,n),this.minX=this.getMinX(),this.maxX=this.getMaxX(),this.minY=this.getMinY(),this.maxY=this.getMaxY(),this.center=this.getCenter()}moveTo(e,a,t,n){const s=e-this.minX,l=a-this.minY;for(let i=0;i<this.vertices.length;i++)this.vertices[i].x+=s,this.vertices[i].y+=l;this.calculateTiles(t,n),this.minX=this.getMinX(),this.maxX=this.getMaxX(),this.minY=this.getMinY(),this.maxY=this.getMaxY(),this.center=this.getCenter()}}class ga{constructor(e){c(this,"config");this.config=e}generate(){let e=H.int(this.config.theme.minWidth,this.config.theme.maxWidth),a=H.int(this.config.theme.minHeight,this.config.theme.maxHeight),t=H.int(2,this.config.mapWidth-e-3),n=H.int(2,this.config.mapHeight-a-3),s=new sr;s.name=this.config.theme.name,s.theme=this.config.theme;let l=T(this.config.theme.shapes);if(l=="rectangular"?(s=or(t,n,e,a,s),s.description=T([`This rectangular room is ${e*5}' wide and ${a*5}' long.`,`This ${s.name} is ${e*5}' wide and ${a*5}' long.`])):l=="square"?(s=hr(t,n,e,s),s.description=T([`This square room is ${e*5}' wide and ${a*5}' long.`,`This room is a square ${e*5}' wide and ${a*5}' long.`,`This ${s.name} is ${e*5}' wide and ${a*5}' long.`])):l=="cavern"?(s=lr(t,n,e,a,s),s.description=T(["This is a cavern."])):l=="corridor"&&(s=ir(t,n,e,a,s),s.description=T(["This is a corridor."])),re(100)>70){let i=T(s.theme.flooringOptions);s.description+=T([` The floor is ${i}.`,` ${ut(i)} flooring is cracked in places.`,` The ${i} flooring is cracked in places.`,` The ${i} flooring is broken in places.`])}for(let i=0;i<this.config.theme.featureGenerators.length;i++){let o=this.config.theme.featureGenerators[i].generate();s.features.push(o),o.secret!=""&&(s.secrets+=o.secret+" ")}if(this.config.theme.dressingGenerators.length>0&&re(100)>70){let i=T(this.config.theme.dressingGenerators);s.features.push(i.generate())}return s.minX=t,s.maxX=s.getMaxX(),s.minY=n,s.maxY=s.getMaxY(),s.center=s.getCenter(),s.calculateTiles(this.config.mapWidth,this.config.mapHeight),s}}function lr(r,e,a,t,n){let s={x:Math.floor((r+a)/2),y:Math.floor((e+t)/2)},l=20;const i=r+a,o=e+t;n.vertices.push(s);let h={x:s.x,y:s.y};for(let m=0;m<l;m++){let u=h.x,d=h.y;if(re(100)>50){let g=H.int(-1,1);u+=g,u>i?u=i:u<r&&(u=r)}else{let g=H.int(-1,1);d+=g,d>o?d=o:d<e&&(d=e)}let b={x:u,y:d},v=!1;for(let g=0;g<n.vertices.length;g++)if(yt(n.vertices[g],b)){v=!0;break}v||n.vertices.push(b),h.x=u,h.y=d}return n}function ir(r,e,a,t,n){let s=H.int(Math.max(3,Math.floor((a+t-2)/2)),a+t-2),l=H.int(r,r+a-1),i=H.int(e,e+t-1);n.vertices.push({x:l,y:i});let o=T([{x:-1,y:0},{x:1,y:0},{x:0,y:-1},{x:0,y:1}]);for(let h=0;h<s;h++){let m=l+o.x,u=i+o.y;if(m>=a+r||m<=r)o.x=0,o.y=T([-1,1]);else if(u>=t+e||u<=e)o.y=0,o.x=T([-1,1]);else{l=m,i=u;let d={x:l,y:i};if(rr(d,n.vertices))continue;n.vertices.push(d),re(100)>90&&(o.y!=0?(o.x=o.y,o.y=0):(o.y=o.x,o.x=0))}}return n}function or(r,e,a,t,n){for(let s=e;s<e+t;s++)for(let l=r;l<r+a;l++)n.vertices.push({x:l,y:s});return n.description=`This room is ${(a+1)*5}' wide and ${(t+1)*5}' long.`,n}function hr(r,e,a,t){for(let n=e;n<e+a;n++)for(let s=r;s<r+a;s++)t.vertices.push({x:s,y:n});return t.description=`This square room is ${(a+1)*5}' wide and ${(a+1)*5}' long.`,t}class da{constructor(e,a,t){c(this,"mapHeight");c(this,"mapWidth");c(this,"theme");this.mapHeight=a,this.mapWidth=e,this.theme=t}}function cr(r,e){let a=1e7;for(let t=0;t<e.length;t++)for(let n=0;n<e[t].vertices.length;n++)for(let s=0;s<r.vertices.length;s++){let l=Qe(e[t].vertices[n],r.vertices[s]);l<=a&&(a=l)}return a}function mr(r,e){for(let a=0;a<e.length;a++)for(let t=0;t<e[a].vertices.length;t++)for(let n=0;n<r.vertices.length;n++)if(yt(r.vertices[n],e[a].vertices[t]))return!0;return!1}function ur(r,e){for(let a=0;a<e.length;a++)for(let t=0;t<e[a].vertices.length;t++)for(let n=0;n<r.vertices.length;n++)if(Qe(r.vertices[n],e[a].vertices[t])==1)return!0;return!1}function fr(r,e){let a=[],t=[];for(let n=0;n<e.length;n++)for(let s=0;s<r.vertices.length;s++)for(let l=0;l<e[n].vertices.length;l++)if(Qe(e[n].vertices[l],r.vertices[s])<=2&&!t.includes(e[n].id)&&e[n].id!=r.id){t.push(e[n].id),a.push(e[n]);break}return a}function St(r,e,a,t){let n=!0,s=r-3,l=e-3,i=new da(r,e,a),o=new ga(i),h=o.generate(),m=0,u=5,d=h.minX+1,b=h.minY;for(;n;)if(!mr(h,t)&&!ur(h,t)&&gr(2,h,t))n=!1;else if(m<=u){if(d+=1,d>s-h.getWidth()&&(d=2,b++,b>l-h.getHeight())){m++,d=2,b=2;continue}h.moveTo(d,b,r,e)}else{if(m>u)return null;m++,h=o.generate(),d=h.minX+1,b=h.minY}return h}function gr(r,e,a){return cr(e,a)==r}function dr(r,e){let a={room1:-1,room2:-1,vertex:{x:0,y:0},tile:0,lock:null,isSecret:!1,description:""},t=[];for(let l=0;l<r.vertices.length;l++)for(let i=0;i<e.vertices.length;i++)if(Qe(r.vertices[l],e.vertices[i])==2){let h=r.vertices[l],m=e.vertices[i];t.push({a:h,b:m})}let n=T(t);a.vertex=tr(n),ar(n)===0?a.tile=gt:a.tile=xt,re(100)>90?(a.lock=new nr,a.lock.id=mt(24)):re(100)>90&&(a.isSecret=!0,a.tile==gt?a.tile=fa:a.tile=ua),a.room1=r.id,a.room2=e.id;let s=T([T(["rough","decaying","rotted"]),"simple","plain",T(["iron-trimmed","copper-trimmed","silver-trimmed","gold-trimmed","painted","carved","ornate"])]);return a.description=Le(s)+" "+s+" door",a}function pr(r){for(let e=0;e<r.rooms.length;e++){let a=fr(r.rooms[e],r.rooms),t=[];for(let b=0;b<a.length;b++){let v=!1;for(let g=0;g<r.rooms[e].doors.length;g++){let p=r.doors[r.rooms[e].doors[g]];(p.room1==r.rooms[e].id&&p.room2==a[b].id||p.room2==r.rooms[e].id&&p.room1==a[b].id)&&(v=!0)}v||t.push(a[b])}if(t.length==0)continue;let n=T(t),s=dr(r.rooms[e],n);n.id==0&&(s.isSecret=!1,r.rooms[0].doors.length<2&&(s.lock=null)),r.doors.push(s);let l=r.doors.length-1;r.rooms[e].doors.push(l);let i=Ht(s,r.rooms[e]),o=Ht(s,r.rooms[n.id]),h="",m="";if(s.isSecret){let b=T([`${T(["It is","It's"])} hidden behind a tapestry.`,`${T(["It is","It's"])} practically undetectable except for a thin seam visible only on close inspection.`,"A tapestry obscures it.","It cannot be opened from this side.",`A pile of ${T(["refuse","debris","trash"])} obscures it.`]);re(100)>50?(m=`${o} ${b}`,o=""):(h=`${i} ${b}`,i=""),r.rooms[e].secrets+=h,r.rooms[n.id].secrets+=m}let u={name:"door",description:i,secret:h,isContainer:!1},d={name:"door",description:o,secret:m,isContainer:!1};r.rooms[e].features.push(u),r.rooms[n.id].doors.push(l),r.rooms[n.id].features.push(d),r.tiles=vr(s,r.tiles)}return r}function vr(r,e){return e[r.vertex.y][r.vertex.x]=r.tile,e}function Ht(r,e){let a="";r.tile==xt?r.vertex.y>e.center.y?r.vertex.x<e.center.x?a="southwest":r.vertex.x>e.center.x?a="southeast":a="south":r.vertex.x<e.center.x?a="northwest":r.vertex.x>e.center.x?a="northeast":a="north":r.vertex.x<e.center.x?r.vertex.y>e.center.y?a="southwest":r.vertex.y<e.center.y?a="northwest":a="west":r.vertex.y>e.center.y?a="southeast":r.vertex.y<e.center.y?a="northeast":a="east";let t=T([`There's ${r.description} in the ${a}`,`There is ${r.description} in the ${a}`,ut(r.description)+` lies in the ${a}`,ut(r.description)+` is in the ${a}`]);return r.lock!=null?t+=". It is locked.":t+=".",t}class P{constructor(e,a,t,n){c(this,"name");c(this,"descriptionOptions");c(this,"secretOptions");c(this,"isContainer");this.name=e,this.descriptionOptions=a,this.secretOptions=t,this.isContainer=n}generate(){let e="";return re(100)>70&&this.secretOptions.length>0&&(e=T(this.secretOptions)),{name:this.name,description:T(this.descriptionOptions),secret:e,isContainer:this.isContainer}}}class Yt{constructor(e,a,t){c(this,"name");c(this,"mutate");c(this,"tags");this.name=e,this.mutate=a,this.tags=t}}function br(){return[new Yt("brazier",r=>{let e=new P("brazier",["There is a large lit brazier in the middle of the room.","There are lit braziers around the room here."],[],!1);return r.features.push(e.generate()),r.lightLevel+=2,r},["light"]),new Yt("torches",r=>{let e=new P("torches",["Torches line the walls.","A few torches sit in sconces on the walls."],[],!1);return r.features.push(e.generate()),r.lightLevel+=1,r},["light"])]}function wr(r,e){let a=[];for(let t=0;t<e.length;t++)e[t].tags.includes(r)&&a.push(e[t]);return a}function yr(){let r=[new P("debris",["There is a pile of random debris here.","Much of the floor is covered in debris.","Debris of unknown origin is scattered about."],[],!1),new P("rags",["There is a pile of rags here.","One of the corners has a large pile of filthy rags.","Small piles of rags are scattered across the floor."],[],!1),new P("cobwebs",["There are a lot of cobwebs here.","The ceiling is partly covered in cobwebs.","Dense cobwebs hang down from the ceiling."],[],!1)];return[new ne("altar room",[],3,3,10,10,["marble","stone tile"],r,[new P("altar",["There is an evil-looking altar here.","There is a blood-covered altar here.","On top of a stone dais is a long altar."],[],!1)],[],["rectangular"],["cult"],5),new ne("armory",[],3,3,6,6,["stone tile"],r,[new P("weapon racks",["Weapon racks full of old spears, swords, and axes line the walls.","Each wall has at least one wooden rack full of weapons.","There are rows of weapon racks here."],[],!1),new P("armor displays",["Pieces of armor in various states of disrepair hang from pegs on the walls.","There are numerous pegs on the walls for armor to be hung.","Several pieces of armor are on armor stands here."],[],!1)],[],["rectangular","square"],["military"],5),new ne("barracks",[],8,8,15,15,["stone tile"],r,[new P("beds",["There are many beds here.","There are many bunk beds here.","There are many cots here.","Beds line the walls.","Cots line the walls."],[],!1),new P("chests",["There are chests at the end of each bed.","Each bed has a chest at the foot."],[],!0)],[],["rectangular"],["military"],5),new ne("burial chamber",[],5,5,10,10,["stone tile"],r,[new P("coffins",["There is a large stone sarcophagus here.","There is an ornate sarcophagus here.","There are several sarcophagi here.","There is a large, ornate coffin here.","There are many coffins here.","Coffins line the walls.","Along the walls are several long alcoves. Each one has a stone coffin."],[],!0)],[],["rectangular"],["tomb"],5),new ne("chamber",[],2,2,6,6,["marble","stone tile"],r,[],[],["rectangular","square"],["dungeon"],40),new ne("fountain chamber",[],2,2,5,5,["stone tile"],r,[new P("fountain",["There is a large fountain here.","There is an ornate fountain here.","There is a disused fountain here with brackish water.","There is an elegant fountain here.","Two fountains lie on either side of the room.","Small fountains sit in each corner of the room.","An old and disused fountain sits in the corner."],[],!0)],[],["rectangular","square"],["dungeon","nobility"],5),new ne("kitchen",[],2,2,5,5,["stone tile"],r,[new P("oven",["There is a large wood-fired oven here.","There are several large ovens here.","Ovens line one of the walls.","A long-dormant oven sits against the back wall."],[],!1),new P("pantry cabinet",["There is a pantry cabinet here.","A pantry cabinet sits against one wall."],[],!0),new P("table",["There is a table here.","A table sits against one wall.","An assortment of kitchen utensils and tools sit on a large table here."],[],!1)],[],["rectangular"],["food","military"],5),new ne("laboratory",[],4,4,6,6,["stone tile"],r,[new P("lab table",["There is a large table here with a wide array of alchemical devices on it.","There are several tables here with various devices on them.","Tables with alchemical devices, books, and other items are arranged around the room."],[],!1),new P("specimen cabinet",["There is a large cabinet here.","There is a simple cabinet here, and the door is ajar.","There is a cabinet here."],[],!0)],[],["rectangular"],["alchemy","mage"],5),new ne("library",[],5,5,15,15,["stone tile"],r,[new P("bookcases",["There are many bookcases here.","There are a number of well-preserved bookcases here.","The walls are lined with bookcases."],[],!0),new P("table",["There are several tables here.","There is a table here with a large book open lying on it."],[],!1)],[],["rectangular","square"],["mage","nobility"],5),new ne("storeroom",[],2,2,6,6,["stone tile"],r,[new P("stacked boxes",["Many boxes are stacked here.","Boxes are stacked in corners here.","Crates and large boxes line the walls.","A few broken crates and boxes are strewn about."],[],!0)],[],["rectangular","square"],["dungeon"],20)]}function Ke(){let r=[];return r=r.concat(yr()),r}function dt(r,e){for(let a=0;a<e.length;a++)if(e[a].name==r)return e[a];throw new Error(`Failed to find room theme with name ${r}.`)}function de(r,e){let a=[];for(let t=0;t<e.length;t++)e[t].tags.includes(r)&&a.push(e[t]);return a}function Tr(){return new ne("entrance",[],2,2,4,4,["stone tile"],[],[new P("entrance",["The entrance to the dungeon is here.","The stairs out of the dungeon are here.","There is a set of stairs here leading out of the dungeon.","The stairs leading out of the dungeon are here."],[],!1)],[],["rectangular","square"],["dungeon","entrance"],10)}class xr{constructor(e,a,t,n){c(this,"name");c(this,"mutate");c(this,"requiredTag");c(this,"tags");this.name=e,this.mutate=a,this.requiredTag=t,this.tags=n}}function _r(){let r=[{element:"fire",damage:"+1d6 fire",description:"The blade is wreathed in flame when wielded. Anything flammable struck with it immediately ignites."},{element:"ice",damage:"+1d6 cold",description:"The blade is surrounded by a layer of ice when wielded. Enemies struck with it are chilled to the bone and have difficulty moving."},{element:"lightning",damage:"+1d6 electricity",description:"The blade is surrounded by crackling lightning when wielded."},{element:"poison",damage:"+1d6 poison",description:"The blade is coated in a sickly green liquid when wielded. The liquid is highly poisonous, causing illness and eventually death if not cured."},{element:"acid",damage:"+1d6 acid",description:"The blade is coated in a thin yellow acid when wielded."},{element:"darkness",damage:"+1d6 darkness",description:"The blade is hidden in shadow when wielded. It is difficult for enemies to predict where attacks with this weapon will come from."},{element:"light",damage:"+1d6 light",description:"The blade glows faintly when wielded. On command, that light glows brightly enough to illuminate a large room."},{element:"earth",damage:"+1d6 earth",description:"The blade appears to be made of stone. Anything struck with it is turned to stone."}],e=[];for(let a of r)e.push(new xr(`${a.element}-enchanted melee weapon`,t=>(t.name=`${a.element}-enchanted ${t.name}`,t instanceof Ya&&(t.damage+=` ${a.damage}`),t.description+=` ${a.description}`,t.value+=1e4,t),"bladed weapon",["weapon","melee weapon","bladed weapon","enchantment",a.element]));return e}function Lr(){let r=[];return r=r.concat(_r()),r}function kr(r,e){let a=[],t=[];for(let n=0;n<e.length;n++)for(let s=0;s<r.length;s++)if(e[n].tags.includes(r[s])&&!t.includes(e[n].name)){a.push(e[n]),t.push(e[n].name);continue}return a}class pa{constructor(e){c(this,"config");this.config=e}generate(){let e=H.int(this.config.minQuality,this.config.maxQuality),a=Ba(this.config.maxQuality,this.config.components);a=qa(this.config.minQuality,a);let t=this.config.pattern.complete(this.config.components,e);if(this.config.useMutator){let n=kr(t.tags,this.config.mutators);n.length>0&&(t=T(n).mutate(t))}return t}}class va{constructor(){c(this,"pattern");c(this,"components");c(this,"minValue");c(this,"maxValue");c(this,"minQuality");c(this,"maxQuality");c(this,"mutators");c(this,"useMutator");this.components=Xa(),this.minValue=0,this.maxValue=0,this.minQuality=0,this.maxQuality=1,this.mutators=Lr(),this.useMutator=!1}}function K(r,e){let a=new va;a.pattern=Fa(r);let t=0,n=e,s=10,l=e;return e==1?s=20:e==2?(t=10,s=30):e==3?(t=30,s=50):e==3?(t=50,s=100):e==4&&(t=100,s=1e4),a.minValue=t,a.maxValue=s,a.minQuality=n,a.maxQuality=l,new pa(a)}function M(r,e){let a=Wa(r);return K(T(a).name,e)}function Cr(){return[{name:"cleric",abilities:[{name:"turn undead",description:"turns undead creatures",category:"divine",threatLevel:1},{name:"divine spellcasting",description:"casts divine spells",category:"divine",threatLevel:1}],tags:["cleric"],threatLevel:2,itemGenerators:[M("mace",1),M("breastplate",1)]},{name:"priest",abilities:[{name:"turn undead",description:"turns undead creatures",category:"divine",threatLevel:1},{name:"divine spellcasting",description:"casts divine spells",category:"divine",threatLevel:2}],tags:["cleric"],threatLevel:1,itemGenerators:[M("staff",1),M("robe",1)]},{name:"high priest",abilities:[{name:"turn undead",description:"turns undead creatures",category:"divine",threatLevel:1},{name:"divine spellcasting",description:"casts divine spells",category:"divine",threatLevel:3}],tags:["cleric"],threatLevel:2,itemGenerators:[M("staff",2),M("robe",2)]}]}function Rr(){return[{name:"cult acolyte",abilities:[],tags:["cult"],threatLevel:1,itemGenerators:[M("staff",1),K("robe",0)]},{name:"cult priest",abilities:[{name:"demonic spellcasting",description:"casts demonic spells",category:"demonic",threatLevel:2}],tags:["cult"],threatLevel:2,itemGenerators:[M("staff",1),K("robe",1)]},{name:"cult high priest",abilities:[{name:"demonic spellcasting",description:"casts demonic spells",category:"demonic",threatLevel:3}],tags:["cult"],threatLevel:3,itemGenerators:[M("staff",3),M("knife",2),K("robe",3)]}]}function jr(){return[{name:"apprentice mage",abilities:[{name:"arcane spellcasting",description:"casts arcane spells",category:"spellcaster",threatLevel:1}],tags:["magic user"],threatLevel:1,itemGenerators:[K("staff",1),K("robe",0)]},{name:"archmage",abilities:[{name:"arcane spellcasting",description:"casts arcane spells",category:"spellcaster",threatLevel:8}],tags:["magic user"],threatLevel:4,itemGenerators:[K("staff",3),K("robe",3)]},{name:"druid",abilities:[{name:"nature spellcasting",description:"casts nature spells",category:"spellcaster",threatLevel:1}],tags:["magic user"],threatLevel:2,itemGenerators:[K("staff",1),K("robe",0)]},{name:"mage",abilities:[{name:"arcane spellcasting",description:"casts arcane spells",category:"spellcaster",threatLevel:4}],tags:["magic user"],threatLevel:2,itemGenerators:[K("staff",1),K("robe",0)]},{name:"necromancer",abilities:[{name:"necromantic spellcasting",description:"casts necromantic spells",category:"spellcaster",threatLevel:2}],tags:["magic user"],threatLevel:4,itemGenerators:[K("staff",3),K("robe",3)]},{name:"sorcerer",abilities:[{name:"arcane spellcasting",description:"casts arcane spells",category:"spellcaster",threatLevel:1}],tags:["magic user"],threatLevel:2,itemGenerators:[]},{name:"warlock",abilities:[{name:"demonic spellcasting",description:"casts demonic spells",category:"spellcaster",threatLevel:1}],tags:["magic user"],threatLevel:2,itemGenerators:[]},{name:"witch",abilities:[{name:"arcane spellcasting",description:"casts arcane spells",category:"spellcaster",threatLevel:1}],tags:["magic user"],threatLevel:2,itemGenerators:[]},{name:"wizard",abilities:[{name:"arcane spellcasting",description:"casts arcane spells",category:"spellcaster",threatLevel:4}],tags:["magic user"],threatLevel:2,itemGenerators:[K("staff",1),K("robe",1)]}]}function Er(){return[{name:"archer",abilities:[],tags:["martial","military"],threatLevel:1,itemGenerators:[M("bow",1)]},{name:"captain",abilities:[],tags:["martial","military"],threatLevel:1,itemGenerators:[M("sword",2),M("breastplate",2),M("helmet",2)]},{name:"general",abilities:[],tags:["martial","military"],threatLevel:1,itemGenerators:[M("sword",3),M("breastplate",3),M("helmet",3)]},{name:"guard",abilities:[],tags:["martial","military"],threatLevel:1,itemGenerators:[M("spear",1),M("body armor",1)]},{name:"hunter",abilities:[],tags:["martial","wilderness"],threatLevel:1,itemGenerators:[]},{name:"martial artist",abilities:[],tags:["martial"],threatLevel:1,itemGenerators:[]},{name:"martial arts master",abilities:[],tags:["martial"],threatLevel:2,itemGenerators:[]},{name:"raider captain",abilities:[],tags:["criminal","martial"],threatLevel:1,itemGenerators:[M("sword",1),M("breastplate",1)]},{name:"raider",abilities:[],tags:["criminal","martial"],threatLevel:1,itemGenerators:[M("weapon",1),M("body armor",1)]},{name:"ranger",abilities:[],tags:["martial","wilderness"],threatLevel:3,itemGenerators:[]},{name:"soldier",abilities:[],tags:["martial","military"],threatLevel:1,itemGenerators:[M("martial weapon",1),M("body armor",1)]},{name:"thug",abilities:[],tags:["criminal","martial"],threatLevel:1,itemGenerators:[M("club",1)]},{name:"veteran hunter",abilities:[],tags:["martial","wilderness"],threatLevel:2,itemGenerators:[M("bow",3)]},{name:"veteran soldier",abilities:[],tags:["martial","military"],threatLevel:2,itemGenerators:[M("sword",2),M("breastplate",2)]},{name:"warrior",abilities:[],tags:["martial","wilderness"],threatLevel:1,itemGenerators:[M("simple weapon",1)]}]}function Or(){return[{name:"lich",abilities:[{name:"necromantic spellcasting",description:"casts necromantic spells",category:"spellcaster",threatLevel:8}],tags:["undead"],threatLevel:5,itemGenerators:[]},{name:"shambler",abilities:[],tags:["undead"],threatLevel:1,itemGenerators:[]},{name:"sprinter",abilities:[],tags:["undead"],threatLevel:2,itemGenerators:[]}]}function ke(){let r=[];return r=r.concat(Cr()),r=r.concat(Rr()),r=r.concat(jr()),r=r.concat(Er()),r=r.concat(Or()),r}function Nr(r,e){let a=[];for(let t=0;t<e.length;t++){let n=!0;for(let s=0;s<r.length;s++)if(!e[t].tags.includes(r[s])){n=!1;break}n===!0&&a.push(e[t])}return a}function $r(r,e){let a=[];for(let t=0;t<e.length;t++){let n=!1;for(let s=0;s<r.length;s++)if(e[t].tags.includes(r[s])){n=!0;break}n===!0&&a.push(e[t])}return a}function Gr(r,e){let a=[];for(let t=0;t<e.length;t++)e[t].creatureTypes.includes(r)&&a.push(e[t]);return a}function Ar(r,e){let a=[];for(let t=0;t<e.length;t++)e[t].environments.includes(r)&&a.push(e[t]);return a}function Mr(r,e){let a=[];for(let t=0;t<e.length;t++){let n=!0;for(let s=0;s<r.length;s++)if(e[t].tags.includes(r[s])){n=!1;break}n===!0&&a.push(e[t])}return a}class ${constructor(e,a,t,n,s){c(this,"withAllTags");c(this,"withAnyTag");c(this,"withCreatureType");c(this,"withEnvironment");c(this,"withNoTags");this.withAllTags=e,this.withAnyTag=a,this.withCreatureType=t,this.withEnvironment=n,this.withNoTags=s}apply(e){let a=e;return this.withAllTags.length>0&&(a=Nr(this.withAllTags,a)),this.withAnyTag.length>0&&(a=$r(this.withAnyTag,a)),this.withCreatureType!=""&&(a=Gr(this.withCreatureType,a)),this.withEnvironment!=""&&(a=Ar(this.withEnvironment,a)),this.withNoTags.length>0&&(a=Mr(this.withNoTags,a)),a}}function Ir(){let r=ke();return[{name:"group of raiders",threatLevel:3,groupTemplates:[{name:"raider captain",threatLevel:2,isSentient:!0,archetypes:[S("raider captain",r)],filter:new $(["martial"],[],"humanoid","",["undead"]),minNumber:1,maxNumber:1},{name:"raiders",threatLevel:3,isSentient:!0,archetypes:[S("raider",r)],filter:new $(["martial"],[],"humanoid","",["undead"]),minNumber:3,maxNumber:6}],tags:["bandits"],commonality:5},{name:"group of looters",threatLevel:3,groupTemplates:[{name:"looters",threatLevel:3,isSentient:!0,archetypes:[S("thug",r)],filter:new $(["martial"],[],"humanoid","",["undead"]),minNumber:3,maxNumber:6}],tags:["bandits"],commonality:5},{name:"group of thugs",threatLevel:2,groupTemplates:[{name:"thugs",threatLevel:2,isSentient:!0,archetypes:[S("thug",r)],filter:new $(["martial"],[],"humanoid","",["undead"]),minNumber:2,maxNumber:4}],tags:["bandits"],commonality:5}]}function Dr(){let r=ke();return[{name:"group of cult acolytes",threatLevel:1,groupTemplates:[{name:"cult acolytes",threatLevel:1,isSentient:!0,archetypes:[S("cult acolyte",r)],filter:new $([],["cult","corruptible"],"humanoid","",["undead"]),minNumber:2,maxNumber:4}],tags:["cult"],commonality:50},{name:"group of lesser demons",threatLevel:4,groupTemplates:[{name:"lesser demons",threatLevel:2,isSentient:!1,archetypes:[],filter:new $(["demon"],[],"","",[]),minNumber:2,maxNumber:4}],tags:["cult","demonic"],commonality:1},{name:"cult priest",threatLevel:2,groupTemplates:[{name:"cult priest",threatLevel:2,isSentient:!0,archetypes:[S("cult priest",r)],filter:new $([],["cult","corruptible"],"humanoid","",["undead"]),minNumber:1,maxNumber:1}],tags:["cult"],commonality:20},{name:"cult high priest",threatLevel:5,groupTemplates:[{name:"cult high priest",threatLevel:5,isSentient:!0,archetypes:[S("cult high priest",r)],filter:new $([],["cult","corruptible"],"humanoid","",["undead"]),minNumber:1,maxNumber:1}],tags:["cult"],commonality:15}]}function _t(){return[{name:"swarming insects",threatLevel:3,groupTemplates:[{name:"swarming insects",threatLevel:3,isSentient:!1,archetypes:[],filter:new $(["swarm"],[],"","",[]),minNumber:3,maxNumber:8}],tags:["insects"],commonality:5},{name:"wandering creature",threatLevel:2,groupTemplates:[{name:"wandering creature",threatLevel:3,isSentient:!1,archetypes:[],filter:new $([],[],"","",[]),minNumber:1,maxNumber:1}],tags:["wandering creature"],commonality:40},{name:"group of wandering creatures",threatLevel:4,groupTemplates:[{name:"wandering creatures",threatLevel:3,isSentient:!1,archetypes:[],filter:new $([],[],"","",[]),minNumber:2,maxNumber:4}],tags:["wandering creature"],commonality:30}]}function Vr(){let r=ke();return[{name:"archmage",threatLevel:5,groupTemplates:[{name:"archmage",threatLevel:5,isSentient:!0,archetypes:[S("archmage",r)],filter:new $([],[],"humanoid","",["undead"]),minNumber:1,maxNumber:1}],tags:["mage","magic"],commonality:1},{name:"mage",threatLevel:2,groupTemplates:[{name:"mage",threatLevel:2,isSentient:!0,archetypes:[S("mage",r)],filter:new $([],[],"humanoid","",["skeleton","zombie"]),minNumber:1,maxNumber:1}],tags:["mage","magic"],commonality:5}]}function Sr(){let r=ke();return[{name:"squad of soldiers",threatLevel:1,groupTemplates:[{name:"soldiers",threatLevel:1,isSentient:!0,archetypes:[S("soldier",r)],filter:new $(["martial"],[],"humanoid","",["undead"]),minNumber:2,maxNumber:4}],tags:["martial","soldiers"],commonality:10},{name:"squad of veterans",threatLevel:2,groupTemplates:[{name:"veteran soldiers",threatLevel:2,isSentient:!0,archetypes:[S("veteran soldier",r)],filter:new $(["martial"],[],"humanoid","",["undead"]),minNumber:2,maxNumber:4}],tags:["martial","soldiers"],commonality:5},{name:"captain",threatLevel:4,groupTemplates:[{name:"captain",threatLevel:2,isSentient:!0,archetypes:[S("captain",r)],filter:new $(["martial"],[],"humanoid","",["undead"]),minNumber:1,maxNumber:1},{name:"veteran soldiers",threatLevel:2,isSentient:!0,archetypes:[S("veteran soldier",r)],filter:new $(["martial"],[],"humanoid","",["undead"]),minNumber:2,maxNumber:4}],tags:["martial","soldiers"],commonality:3},{name:"general",threatLevel:5,groupTemplates:[{name:"general",threatLevel:3,isSentient:!0,archetypes:[S("general",r)],filter:new $(["martial"],[],"humanoid","",["undead"]),minNumber:1,maxNumber:1},{name:"captain",threatLevel:2,isSentient:!0,archetypes:[S("captain",r)],filter:new $(["martial"],[],"humanoid","",["undead"]),minNumber:1,maxNumber:2}],tags:["martial","soldiers"],commonality:2}]}function ba(){let r=ke();return[{name:"lich",threatLevel:5,groupTemplates:[{name:"lich",threatLevel:5,isSentient:!0,archetypes:[S("lich",r)],filter:new $([],[],"humanoid","",["undead"]),minNumber:1,maxNumber:1}],tags:["undead"],commonality:5},{name:"necromancer",threatLevel:7,groupTemplates:[{name:"necromancer",threatLevel:5,isSentient:!0,archetypes:[S("necromancer",r)],filter:new $([],[],"humanoid","",["undead"]),minNumber:1,maxNumber:1},{name:"skeletons",threatLevel:2,isSentient:!0,archetypes:[S("warrior",r),S("soldier",r),S("guard",r)],filter:new $(["skeleton"],[],"","",[]),minNumber:3,maxNumber:6}],tags:["mage","undead"],commonality:5},{name:"pack of ghouls",threatLevel:5,groupTemplates:[{name:"ghouls",threatLevel:3,isSentient:!1,archetypes:[],filter:new $(["ghoul"],[],"","",[]),minNumber:2,maxNumber:4}],tags:["undead"],commonality:5},{name:"pack of undead",threatLevel:5,groupTemplates:[{name:"undead",threatLevel:3,isSentient:!1,archetypes:[],filter:new $(["undead"],[],"","",["vampire"]),minNumber:2,maxNumber:4}],tags:["undead"],commonality:5},{name:"pack of skeletons",threatLevel:2,groupTemplates:[{name:"skeletons",threatLevel:2,isSentient:!0,archetypes:[S("warrior",r),S("soldier",r),S("guard",r)],filter:new $(["skeleton"],[],"","",[]),minNumber:3,maxNumber:6}],tags:["skeleton","undead"],commonality:10},{name:"pack of zombies",threatLevel:3,groupTemplates:[{name:"zombies",threatLevel:3,isSentient:!0,archetypes:[S("shambler",r),S("sprinter",r)],filter:new $(["zombie"],[],"","",[]),minNumber:3,maxNumber:6}],tags:["zombie","undead"],commonality:10},{name:"vampire",threatLevel:5,groupTemplates:[{name:"vampire",threatLevel:5,isSentient:!0,archetypes:[S("warrior",r)],filter:new $(["vampire"],[],"","",[]),minNumber:1,maxNumber:1}],tags:["vampire","undead"],commonality:2}]}function Hr(){let r=ke();return[{name:"group of hunters",threatLevel:3,groupTemplates:[{name:"hunters",threatLevel:3,isSentient:!0,archetypes:[S("hunter",r)],filter:new $(["martial"],[],"humanoid","",["undead"]),minNumber:3,maxNumber:6}],tags:["hunters"],commonality:5},{name:"lone hunter",threatLevel:1,groupTemplates:[{name:"hunter",threatLevel:1,isSentient:!0,archetypes:[S("hunter",r)],filter:new $(["martial"],[],"humanoid","",["undead"]),minNumber:1,maxNumber:1}],tags:["hunters"],commonality:1},{name:"swarming insects",threatLevel:3,groupTemplates:[{name:"swarming insects",threatLevel:3,isSentient:!1,archetypes:[],filter:new $(["swarm"],[],"","",[]),minNumber:3,maxNumber:8}],tags:["insect swarm"],commonality:5},{name:"wandering creature",threatLevel:3,groupTemplates:[{name:"wandering creature",threatLevel:3,isSentient:!1,archetypes:[],filter:new $([],[],"","",[]),minNumber:1,maxNumber:1}],tags:["wandering creature"],commonality:10},{name:"group of wandering creatures",threatLevel:5,groupTemplates:[{name:"wandering creatures",threatLevel:3,isSentient:!1,archetypes:[],filter:new $([],[],"","",[]),minNumber:2,maxNumber:4}],tags:["wandering creature"],commonality:10}]}function Lt(r){let e=[];return e=e.concat(Ir()),e=e.concat(Dr()),e=e.concat(_t()),e=e.concat(Vr()),e=e.concat(Sr()),e=e.concat(Hr()),r&&(e=e.concat(ba())),e}function Je(r,e){return Ce(0,r,e)}function Ce(r,e,a){let t=[];for(let n=0;n<a.length;n++)a[n].threatLevel>=r&&a[n].threatLevel<=e&&t.push(a[n]);return t}function Ze(r,e){return Ce(r,r,e)}function kt(r,e){let a=[];for(let t=0;t<e.length;t++)e[t].tags.includes(r)&&a.push(e[t]);return a}class ze{constructor(e,a,t,n,s,l,i,o,h,m){c(this,"name");c(this,"mainEnvironment");c(this,"nameGenerator");c(this,"weakEncounterTemplates");c(this,"strongEncounterTemplates");c(this,"bossEncounterTemplates");c(this,"sentientOptions");c(this,"flooringOptions");c(this,"roomThemes");c(this,"requiredRooms");this.name=e,this.mainEnvironment=a,this.nameGenerator=t,this.weakEncounterTemplates=n,this.strongEncounterTemplates=s,this.bossEncounterTemplates=l,this.sentientOptions=i,this.flooringOptions=o,this.roomThemes=h,this.requiredRooms=m}}class pt{constructor(e,a,t){c(this,"theme");c(this,"minCount");c(this,"maxCount");this.theme=e,this.minCount=a,this.maxCount=t}}function Yr(){let r=Lt(!1),e=Ge();e=We("humanoid",e);let a=H.int(1,3),t=kt("cult",r),n=Je(3,t),s=Ce(3,4,t),l=Ze(5,t),i=new Ue,o=["DEN","DOMAIN","LAIR"],h=["BALEFUL","VILE","DARK","DEMONIC"],m=["BROTHERHOOD","ORDER"];for(let w=0;w<o.length;w++)for(let G=0;G<h.length;G++)for(let j=0;j<m.length;j++)i.patterns.push(`THE ${o[w]} OF THE ${h[G]} ${m[j]}`);let u=wt("corruptible",e);u=Pe(u,a);const d=Ke();let b=dt("barracks",d),v=dt("altar room",d),g=de("cult",d),p=de("dungeon",d);return g=g.concat(p),new ze("cult","forest",i,n,s,l,u,["stone tile"],g,[new pt(v,1,1),new pt(b,1,1)])}function Br(){let r=Lt(!1),e=Ge();e=We("humanoid",e);let a=H.int(1,3),t=kt("martial",r),n=wt("martial",e);n=Pe(n,a);for(let w=0;w<t.length;w++)t[w].tags.includes("soldiers")&&(t[w].commonality+=20);let s=Je(3,t),l=Ce(3,4,t),i=Ze(5,t),o=new Ue,h=["FORTRESS","STRONGHOLD","DOMAIN","DOMINION","LAIR"],m=["DARK","DREAD","DIRE","IRON","BLOODY","CURSED"],u=["LEGION","ARMY"];for(let w=0;w<h.length;w++)for(let G=0;G<m.length;G++)for(let j=0;j<u.length;j++)o.patterns.push(`THE ${h[w]} OF THE ${m[G]} ${u[j]}`);const d=Ke();let b=dt("barracks",d),v=de("dungeon",d),p=de("military",d).concat(v);return new ze("fortress","hill",o,s,l,i,n,["stone tile"],p,[new pt(b,1,2)])}function qr(){let r=Lt(!1),e=Ge();e=We("humanoid",e);let a=H.int(1,2),t=e;t=Pe(t,a);let n=kt("magic",r);n=n.concat(_t());let s=Je(3,n),l=Ce(3,4,n),i=Ze(5,n),o=new Ue,h=["LABORATORY","LAIR","DOMAIN","DOMINION"],m=["MAD","DREAD","DARK","CRAZED","RECLUSIVE","DOOMED","CURSED"],u=["ARCHMAGE","SORCERER","WIZARD","WITCH","WARLOCK"];for(let g=0;g<h.length;g++)for(let p=0;p<m.length;p++)for(let w=0;w<u.length;w++)o.patterns.push(`THE ${h[g]} OF THE ${m[p]} ${u[w]}`);const d=Ke(),b=de("dungeon",d);let v=de("mage",d);return v=v.concat(b),new ze("mage lair","forest",o,s,l,i,t,["stone tile","marble"],v,[])}function Xr(){let r=Ge();r=We("humanoid",r);let e=H.int(1,2),a=wt("martial",r);a=Pe(a,e);let t=_t();t=t.concat(ba());let n=Je(2,t),s=Ce(3,4,t),l=Ze(5,t),i=new Ue,o=["TOMB","CRYPT","CATACOMBS","MAUSOLEUM","BARROWS"],h=["THE DAMNED","THE FORGOTTEN","THE LOST","WAKING NIGHTMARES","FORGOTTEN SOULS","LOST SOULS"];for(let b=0;b<o.length;b++)for(let v=0;v<h.length;v++)i.patterns.push(`THE ${o[b]} OF ${h[v]}`);const m=Ke(),u=de("dungeon",m);let d=de("tomb",m);return d=d.concat(u),new ze("tomb","hill",i,n,s,l,a,["stone tile"],d,[])}function Fr(){let r=[];return r.push(Yr()),r.push(Br()),r.push(qr()),r.push(Xr()),r}class F{constructor(e,a){c(this,"commonality");c(this,"generator");this.commonality=e,this.generator=a}}class fe{constructor(e){c(this,"entries");this.entries=e}}class wa{constructor(){c(this,"tables");this.tables=[]}}class ya{constructor(e){c(this,"config");this.config=e}generate(){let e=[];for(const a of this.config.tables){let t=a.entries,l=_e(t).generator.generate();e=e.concat(l)}return e}}class Wr{constructor(){c(this,"name");c(this,"description");c(this,"value");c(this,"lockId");c(this,"quality");c(this,"tags")}}class Pr{constructor(){c(this,"name");c(this,"description");c(this,"value");c(this,"quality");c(this,"tags");this.name="an art object",this.description="an art object",this.value=10,this.quality=2,this.tags=["art object"]}}class vt{constructor(e,a,t){c(this,"minValue");c(this,"maxValue");c(this,"count");this.minValue=e,this.maxValue=a,this.count=t}generate(){let e=[];for(let a=0;a<this.count;a++){let t=new Pr;t.value=H.int(this.minValue,this.maxValue),t.name=Ur(this.minValue,this.maxValue);let n=$e(t.value,!1,!1,!1);t.description=`${Le(t.name)} ${t.name} worth ${n}`,e.push(t)}return e}}function Ur(r,e){const a=Qr();let t=[];for(let n=0;n<a.length;n++)a[n].value>=r&&a[n].value<=e&&t.push(a[n].name);return T(t)}function Qr(){return[{name:"silver ewer",value:2500},{name:"carved bone statuette",value:2500},{name:"small gold bracelet",value:2500},{name:"cloth-of-gold vestments",value:2500},{name:"black velvet mask stitched with silver thread",value:2500},{name:"copper chalice with silver filigree",value:2500},{name:"pair of engraved bone dice",value:2500},{name:"small mirror set in a painted wood frame",value:2500},{name:"embroidered silk handkerchief",value:2500},{name:"gold locket with a painted portrait inside",value:2500},{name:"gold ring set with bloodstones",value:25e3},{name:"carved ivory statuette",value:25e3},{name:"large gold bracelet",value:25e3},{name:"silver necklace with a gemstone pendant",value:25e3},{name:"bronze crown",value:25e3},{name:"silk robe with gold embroidery",value:25e3},{name:"large well-made tapestry",value:25e3},{name:"brass mug with jade inlay",value:25e3},{name:"box of turquoise animal figurines",value:25e3},{name:"gold bird cage with electrum filigree",value:25e3},{name:"silver chalice set with moonstones",value:75e3},{name:"silver-plated steel longsword with jet set in hilt",value:75e3},{name:"carved harp of exotic wood with ivory inlay and zircon gems",value:75e3},{name:"small gold idol",value:75e3},{name:"gold dragon comb set with red garnets as eyes",value:75e3},{name:"bottle stopper cork embossed with gold leaf and set with amethysts",value:75e3},{name:"ceremonial electrum dagger with a black pearl in the pommel",value:75e3},{name:"silver and gold brooch",value:75e3},{name:"obsidian statuette with gold fittings and inlay",value:75e3},{name:"painted gold war mask",value:75e3},{name:"fine gold chain set with a fire opal",value:25e4},{name:"old masterpiece painting",value:25e4},{name:"embroidered silk and velvet mantle set with numerous moonstones",value:25e4},{name:"platinum bracelet set with a sapphire",value:25e4},{name:"embroidered glove set with jewel chips",value:25e4},{name:"jeweled anklet",value:25e4},{name:"gold music box",value:25e4},{name:"gold circlet set with four aquamarines",value:25e4},{name:"eye patch with a mock eye set in blue sapphire and moonstone",value:25e4},{name:"necklace string of small pink pearls",value:25e4},{name:"jeweled gold crown",value:75e4},{name:"jeweled platinum ring",value:75e4},{name:"small gold stattuete set with rubies",value:75e4},{name:"gold cup set with emeralds",value:75e4},{name:"painted gold child's sarcophagus",value:75e4},{name:"jade game board with solid gold playing pieces",value:75e4},{name:"bejeweled ivory drinking horn with gold filigree",value:75e4}]}class Kr{constructor(){c(this,"name");c(this,"description");c(this,"value");c(this,"quality");c(this,"tags");this.name="a bag of coins",this.description="a bag of coins",this.value=10,this.quality=1,this.tags=["bag of coins"]}}class J{constructor(e,a,t,n,s){c(this,"cp");c(this,"sp");c(this,"ep");c(this,"gp");c(this,"pp");this.cp=e,this.sp=a,this.ep=t,this.gp=n,this.pp=s}generate(){let e=new Kr,a=0,t=0,n=0,s=0,l=0;this.cp!=""&&(a=ae(this.cp)),this.sp!=""&&(t=ae(this.sp)),this.ep!=""&&(n=ae(this.ep)),this.gp!=""&&(s=ae(this.gp)),this.pp!=""&&(l=ae(this.pp)),e.value=a+t*10+n*50+s*100+l*1e3;let i=a+t+n+s+l,o=T(["bag","pouch","purse"]);i>1e3?o=T(["chest","large chest"]):i>250?o=T(["chest","satchel"]):i>100&&(o=T(["sack","box"])),e.name=`a ${o} of coins`,e.description="a "+o+" of coins "+T(["containing","holding","with"])+" ";let h=[];return a>0&&h.push(`${new Intl.NumberFormat().format(a)} cp`),t>0&&h.push(`${new Intl.NumberFormat().format(t)} sp`),n>0&&h.push(`${new Intl.NumberFormat().format(n)} ep`),s>0&&h.push(`${new Intl.NumberFormat().format(s)} gp`),l>0&&h.push(`${new Intl.NumberFormat().format(l)} pp`),e.description+=ma(h),[e]}}class Jr{constructor(){c(this,"name");c(this,"description");c(this,"value");c(this,"quality");c(this,"tags");this.name="a gem",this.description="a gem",this.value=10,this.quality=2,this.tags=["gem"]}}class Fe{constructor(e,a,t){c(this,"minValue");c(this,"maxValue");c(this,"gemCount");this.minValue=e,this.maxValue=a,this.gemCount=t}generate(){let e=[];for(let a=0;a<this.gemCount;a++){let t=new Jr;t.value=H.int(this.minValue,this.maxValue),t.value<1100?t.name=T(Zr()):t.value<8100?t.name=T(zr()):t.value<15100?t.name=T(en()):t.value<50100?t.name=T(tn()):t.value<100100?t.name=T(an()):t.name=T(rn());let n=$e(t.value,!1,!1,!1);t.description=`${Le(t.name)} ${t.name} worth ${n}`,e.push(t)}return e}}function Zr(){return["banded agate","eye agate","moss agate","azurite","blue quartz","hematite","lapis lazuli","malachite","obsidian","rhodochrosite","tiger eye","turquoise","irregular freshwater pearl"]}function zr(){return["bloodstone","carnelian","chalcedony","chrysoprase","citrine","jasper","moonstone","onyx","quartz","sardonyx","star rose quartz","zircon"]}function en(){return["amber","amethyst","chrysoberyl","coral","garnet","jade","jet","pearl","spinel","tourmaline"]}function tn(){return["alexandrite","aquamarine","black pearl","blue spinel","peridot","topaz"]}function an(){return["black opal","blue sapphire","emerald","fire opal","opal","star ruby","star sapphire","yellow sapphire"]}function rn(){return["black sapphire","diamond","jacinth","ruby"]}class nn{constructor(e,a,t){c(this,"minValue");c(this,"maxValue");c(this,"count");this.minValue=e,this.maxValue=a,this.count=t}generate(){let e=[],a=Pa();for(let t=0;t<this.count;t++){let n=new va;n.pattern=T(a),n.useMutator=!0,n.minQuality=2,n.maxQuality=5,n.minValue=this.minValue,n.maxValue=this.maxValue;let l=new pa(n).generate(),i=$e(l.value,!1,!1,!1);l.description=`${Le(l.name)} ${l.name} worth ${i}`,e.push(l)}return e}}function sn(){return[new fe([new F(30,new J("6d6x100","3d6x100","","2d6x10",""))]),new fe([new F(8,new Fe(900,1e3,ae("2d6"))),new F(12,new vt(1500,3500,ae("2d4"))),new F(8,new Fe(4500,5e3,ae("2d6")))])]}function ln(){return[new fe([new F(30,new J("5d6","","","","")),new F(30,new J("","4d6","","","")),new F(10,new J("","","3d6","","")),new F(25,new J("","","","3d6","")),new F(5,new J("","","","","1d6"))])]}function on(){return[new fe([new F(30,new J("","","","4d6x1000","5d6x100"))]),new fe([new F(20,new vt(2e4,3e4,ae("2d4"))),new F(30,new Fe(45e3,5e4,ae("3d6"))),new F(8,new Fe(95e3,1e5,ae("3d6"))),new F(10,new vt(7e4,8e4,ae("2d4")))]),new fe([new F(5,new nn(1e4,3e4,ae("1d6")))])]}function hn(){return[new fe([new F(20,new J("","4d6x100","","1d6x100","")),new F(15,new J("","","1d6x100","1d6x100","")),new F(40,new J("","","","2d6x100","1d6x10")),new F(25,new J("","","","2d6x100","2d6x10"))])]}function cn(){return[new fe([new F(30,new J("4d6x100","","1d6x10","","")),new F(30,new J("","6d6x10","","2d6x10","")),new F(10,new J("","","1d6x100","2d6x10","")),new F(25,new J("","","","4d6x10","")),new F(5,new J("","","","2d6x10","3d6"))])]}class Ct{constructor(){c(this,"minRoom");c(this,"maxRoom");c(this,"treasure");c(this,"behavior");c(this,"value");c(this,"isCarried");c(this,"isHidden");this.minRoom=-1,this.maxRoom=-1,this.value=1,this.treasure=[],this.isCarried=!1,this.isHidden=!1}}function Bt(r){let e=Fr(),t={environment:"",name:"",description:"",theme:T(e),rooms:[],doors:[],tiles:[],totalThreatLevel:0,averageThreatLevel:0};t.environment=T(["arctic","coastal","desert","forest","grassland","hill","mountain","urban","underdark"]),t.tiles=Tn(r.width,r.height),t.name=t.theme.nameGenerator.generate(1)[0],t=dn(t,r.width,r.height);let n=H.int(r.minRooms,r.maxRooms);t=bn(t,n,r.width,r.height);for(let h=0;h<2;h++)t=pr(t);t=un(t);let s=pn(t),l=[],i=0;for(let h=1;h<t.rooms.length;h++){let m=re(100),u="none";if(h==t.rooms.length-1?u="boss":m>90?u="strong":m>30&&(u="weak"),u!="none"){let d=gn(t,u,h);l.push(d),i++}}let o=yn(t);return t=fn(t,l),t=vn(t,s),t=wn(t,o),t.averageThreatLevel=Math.floor(t.totalThreatLevel/i),t}function mn(){let r=T(Vt()),e=Ha();e.climate=r;let a=[];for(let t=0;t<5;t++)e.climate=T(Vt()),a.push(Sa(e));return{width:40,height:50,maxRooms:30,minRooms:20,minThreatLevel:0,maxThreatLevel:5,possibleBiomes:a}}function un(r){let e=br(),a=wr("light",e);for(let t=0;t<r.rooms.length;t++)if(re(100)>60){let n=T(a);r.rooms[t]=n.mutate(r.rooms[t])}return r}function bt(r,e){for(let a=0;a<r.vertices.length;a++)e[r.vertices[a].y][r.vertices[a].x]=Tt;return e}function fn(r,e){for(let a=0;a<e.length;a++){let t=e[a].maxRoom;t==-1&&(t=r.rooms.length-1);let n=e[a].minRoom,s=H.int(n,t),l=e[a].encounterConfig,i=Ka(l);if(r.rooms[s].encounters.push(i),r.totalThreatLevel+=i.totalThreatLevel,e[a].treasureSpawns.length>0)for(let o=0;o<e[a].treasureSpawns.length;o++){let h=e[a].treasureSpawns[o];for(let m=0;m<i.groups.length;m++)for(let u=0;u<i.groups[m].mobs.length;u++)re(100)>50&&i.groups[m].mobs[u].carried.push(T(h.treasure))}}return r}function gn(r,e,a){let t=za();t.environment=r.environment,t.sentientOptions=r.theme.sentientOptions;let n=ln();e=="boss"?(t.template=_e(r.theme.bossEncounterTemplates),t.minThreatLevel=3,t.maxThreatLevel=10,n=hn()):e=="strong"?(t.template=_e(r.theme.strongEncounterTemplates),n=cn()):t.template=_e(r.theme.weakEncounterTemplates);let s={minRoom:a,maxRoom:a,encounterConfig:t,treasureSpawns:[]},l=!1;if(s.encounterConfig.template===null)throw new Error("Encounter template is null");for(let u=0;u<s.encounterConfig.template.groupTemplates.length;u++)s.encounterConfig.template.groupTemplates[u].isSentient&&(l=!0);let i=new wa;i.tables=n;let h=new ya(i).generate(),m=new Ct;return m.treasure=m.treasure.concat(h),l&&s.treasureSpawns.push(m),s}function dn(r,e,a){let t=Tr();t.flooringOptions=r.theme.flooringOptions;let n=new da(e,a,t),l=new ga(n).generate();return l.id=0,r.rooms.push(l),r.tiles=bt(l,r.tiles),r}function pn(r){let e=[];for(let a=0;a<r.doors.length;a++)if(r.doors[a].lock!==null){let t=new Ct;t.behavior=`This key unlocks the door between room ${r.doors[a].room1+1} and room ${r.doors[a].room2+1} in ${r.name}.`,t.minRoom=0,t.maxRoom=r.doors[a].room1;let n=new Wr;n.name="a key";let s=r.doors[a].lock;if(s===null)throw new Error("Door has no lock but expected one");n.lockId=s.id;let l=T([`a ${T(["simple","plain","rough"])} key`,`a ${T(["small","ornate","shiny","tarnished"])} key`]);n.description=`${l} that unlocks the door between room ${r.doors[a].room1+1} and room ${r.doors[a].room2+1}`,n.value=H.int(1,10),t.treasure.push(n),e.push(t)}return e}function vn(r,e){for(let a=0;a<e.length;a++){let t=H.int(e[a].minRoom,e[a].maxRoom);if(r.rooms[t].encounters.length>0){let n=T(r.rooms[t].encounters);T(n.groups[0].mobs).carried.push(e[a].treasure[0])}else r.rooms[t].treasureCaches.push(e[a].treasure[0].description)}return r}function bn(r,e,a,t){let n=0,s=!0,l=0,i=5;for(let o=0;o<r.theme.requiredRooms.length;o++){let h=r.theme.requiredRooms[o],m=H.int(h.minCount,h.maxCount);for(let u=0;u<m;u++){let d=St(a,t,h.theme,r.rooms);d===null?console.debug("Room broke",h,r.theme.name):(n+=1,d.id=n,r.rooms.push(d),r.tiles=bt(d,r.tiles))}}for(;s;)if(r.rooms.length>=e)s=!1;else{let o=_e(r.theme.roomThemes);o.environment==r.theme.mainEnvironment&&(o.flooringOptions=r.theme.flooringOptions);let h=St(a,t,o,r.rooms);h===null?l++:(n+=1,h.id=n,r.rooms.push(h),r.tiles=bt(h,r.tiles)),l>i&&(s=!1)}return r}function wn(r,e){for(let a=0;a<e.length;a++){let t=e[a].maxRoom;t==-1&&(t=r.rooms.length-1);let n=e[a].minRoom;n==-1&&(n=1);let s=H.int(n,t),l=[];for(const o of e[a].treasure)l.push(o.description);let i=ma(l);if(e[a].isHidden)i+=", hidden somewhere in the room",r.rooms[s].treasureCaches.push(i);else if(e[a].isCarried){let o=T(r.rooms[s].encounters);T(o.groups[0].mobs).carried.push(i)}else{let o=[];for(let h=0;h<r.rooms[s].features.length;h++)r.rooms[s].features[h].isContainer&&o.push(h);o.length>0&&re(100)>10&&(i+=", inside "+r.rooms[s].features[T(o)].name),r.rooms[s].treasureCaches.push(i)}}return r}function yn(r){let e=100,a=[],t=sn(),n=on();for(let s=1;s<r.rooms.length;s++)if(re(100)>e){let l=new wa;l.tables=t,s==r.rooms.length-1&&(l.tables=n);let o=new ya(l).generate(),h=new Ct;h.treasure=h.treasure.concat(o),a.push(h),e=100}else e-=2;return a}function Tn(r,e){let a=[];for(let t=0;t<e;t++){let n=[];a[t]=n;for(let s=0;s<r;s++)a[t][s]=ft}return a}class xn{constructor(e,a,t,n){c(this,"tileSize");c(this,"mapHeight");c(this,"mapWidth");c(this,"imageWidth");c(this,"imageHeight");this.imageWidth=e,this.imageHeight=a,this.mapHeight=t,this.mapWidth=n,this.tileSize=e/n}render(e,a){const t=a.getContext("2d");if(t==null)throw new Error("Could not get 2d context from canvas");t.fillStyle="white",t.fillRect(0,0,this.imageWidth,this.imageHeight);for(let n=0;n<this.mapHeight;n++)for(let s=0;s<this.mapWidth;s++){let l=e.tiles[n][s];l==gt?_n(t,s,n,this.tileSize):l==xt?Rn(t,s,n,this.tileSize):l==Tt?Cn(t,s,n,this.tileSize):l==fa?Ln(t,s,n,this.tileSize):l==ua?jn(t,s,n,this.tileSize):kn(t,s,n,this.tileSize)}for(let n=0;n<e.rooms.length;n++){let s=e.rooms[n].minX*this.tileSize+(e.rooms[n].maxX-e.rooms[n].minX)*this.tileSize/2+this.tileSize*.25,l=e.rooms[n].minY*this.tileSize+(e.rooms[n].maxY-e.rooms[n].minY)*this.tileSize/2+this.tileSize*.8;t.beginPath(),t.strokeStyle="#5698DA",t.fillStyle="#5698DA",t.font="20px Eczar",t.fillText(`${e.rooms[n].id+1}`,s,l),t.strokeText(`${e.rooms[n].id+1}`,s,l)}}}function Ae(r,e,a,t){let n=e*t,s=a*t;r.fillRect(n,s,t,t),r.strokeStyle="#85BBF1",r.strokeRect(n,s,t,t)}function _n(r,e,a,t){r.fillStyle="white",r.fillRect(e*t,a*t,t,t),Ae(r,e,a,t),r.beginPath(),r.strokeStyle="#85BBF1";let n={x:e*t+t/2,y:a*t},s={x:e*t+t/2,y:a*t+t};r.moveTo(n.x,n.y),r.lineTo(s.x,s.y),r.stroke(),r.fillRect(e*t+t*.35,a*t+t*.2,t*.3,t*.6),r.strokeRect(e*t+t*.35,a*t+t*.2,t*.3,t*.6)}function Ln(r,e,a,t){r.fillStyle="white",r.fillRect(e*t,a*t,t,t),Ae(r,e,a,t),r.beginPath(),r.strokeStyle="#85BBF1";let n={x:e*t+t/2,y:a*t},s={x:e*t+t/2,y:a*t+t};r.moveTo(n.x,n.y),r.lineTo(s.x,s.y),r.stroke(),r.fillStyle="#85BBF1",r.font="12px sans-serif",r.fillText("S",e*t+t/3.5,a*t+t/1.3)}function kn(r,e,a,t){r.fillStyle="#A4CFF9";let n=e*t,s=a*t;r.fillRect(n,s,t,t)}function Cn(r,e,a,t){r.fillStyle="white";let n=e*t,s=a*t;r.fillRect(n,s,t,t),Ae(r,e,a,t)}function Rn(r,e,a,t){r.fillStyle="white",r.fillRect(e*t,a*t,t,t),Ae(r,e,a,t),r.beginPath(),r.strokeStyle="#85BBF1";let n={x:e*t,y:a*t+t/2},s={x:e*t+t,y:a*t+t/2};r.moveTo(n.x,n.y),r.lineTo(s.x,s.y),r.stroke(),r.fillRect(e*t+t*.2,a*t+t*.35,t*.6,t*.3),r.strokeRect(e*t+t*.2,a*t+t*.35,t*.6,t*.3)}function jn(r,e,a,t){r.fillStyle="white",r.fillRect(e*t,a*t,t,t),Ae(r,e,a,t),r.beginPath(),r.strokeStyle="#85BBF1";let n={x:e*t,y:a*t+t/2},s={x:e*t+t,y:a*t+t/2};r.moveTo(n.x,n.y),r.lineTo(s.x,s.y),r.stroke(),r.save(),r.translate(e*t+t/2,a*t+t/2),r.rotate(90*Math.PI/180),r.fillStyle="#85BBF1",r.font="12px sans-serif",r.fillText("S",-r.measureText("S").width/2,4),r.restore()}const{document:qt}=Ea;function Xt(r,e,a){const t=r.slice();return t[12]=e[a],t}function Ft(r,e,a){const t=r.slice();return t[15]=e[a],t}function Wt(r,e,a){const t=r.slice();return t[18]=e[a],t}function Pt(r,e,a){const t=r.slice();return t[21]=e[a],t}function Ut(r,e,a){const t=r.slice();return t[24]=e[a],t}function Qt(r,e,a){const t=r.slice();return t[27]=e[a],t}function Kt(r,e,a){const t=r.slice();return t[30]=e[a],t}function Jt(r,e,a){const t=r.slice();return t[33]=e[a],t}function Zt(r){let e,a="This room is dark.";return{c(){e=C("p"),e.textContent=a,this.h()},l(t){e=R(t,"P",{class:!0,"data-svelte-h":!0}),ee(e)!=="svelte-94wbjp"&&(e.textContent=a),this.h()},h(){y(e,"class","svelte-jl2xcj")},m(t,n){X(t,e,n)},d(t){t&&x(e)}}}function zt(r){let e=r[33].description+" ",a;return{c(){a=I(e)},l(t){a=D(t,e)},m(t,n){X(t,a,n)},p(t,n){n[0]&8&&e!==(e=t[33].description+" ")&&U(a,e)},d(t){t&&x(a)}}}function ea(r){let e,a=r[12].secrets+"",t;return{c(){e=C("div"),t=I(a),this.h()},l(n){e=R(n,"DIV",{class:!0});var s=B(e);t=D(s,a),s.forEach(x),this.h()},h(){y(e,"class","room-secrets svelte-jl2xcj")},m(n,s){X(n,e,s),f(e,t)},p(n,s){s[0]&8&&a!==(a=n[12].secrets+"")&&U(t,a)},d(n){n&&x(e)}}}function En(r){let e,a=Le(r[21].name)+"",t;return{c(){e=I("is "),t=I(a)},l(n){e=D(n,"is "),t=D(n,a)},m(n,s){X(n,e,s),X(n,t,s)},p(n,s){s[0]&8&&a!==(a=Le(n[21].name)+"")&&U(t,a)},d(n){n&&(x(e),x(t))}}}function On(r){let e,a=r[21].mobs.length+"",t;return{c(){e=I("are "),t=I(a)},l(n){e=D(n,"are "),t=D(n,a)},m(n,s){X(n,e,s),X(n,t,s)},p(n,s){s[0]&8&&a!==(a=n[21].mobs.length+"")&&U(t,a)},d(n){n&&(x(e),x(t))}}}function ta(r){let e,a="Abilities:",t,n,s=Z(r[24].abilities),l=[];for(let i=0;i<s.length;i+=1)l[i]=aa(Kt(r,s,i));return{c(){e=C("p"),e.textContent=a,t=E(),n=C("ul");for(let i=0;i<l.length;i+=1)l[i].c();this.h()},l(i){e=R(i,"P",{class:!0,"data-svelte-h":!0}),ee(e)!=="svelte-rzkllc"&&(e.textContent=a),t=O(i),n=R(i,"UL",{class:!0});var o=B(n);for(let h=0;h<l.length;h+=1)l[h].l(o);o.forEach(x),this.h()},h(){y(e,"class","svelte-jl2xcj"),y(n,"class","svelte-jl2xcj")},m(i,o){X(i,e,o),X(i,t,o),X(i,n,o);for(let h=0;h<l.length;h+=1)l[h]&&l[h].m(n,null)},p(i,o){if(o[0]&8){s=Z(i[24].abilities);let h;for(h=0;h<s.length;h+=1){const m=Kt(i,s,h);l[h]?l[h].p(m,o):(l[h]=aa(m),l[h].c(),l[h].m(n,null))}for(;h<l.length;h+=1)l[h].d(1);l.length=s.length}},d(i){i&&(x(e),x(t),x(n)),ge(l,i)}}}function aa(r){let e,a,t=r[30].name+"",n,s,l,i=r[30].description+"",o;return{c(){e=C("li"),a=C("strong"),n=I(t),s=I(":"),l=E(),o=I(i),this.h()},l(h){e=R(h,"LI",{class:!0});var m=B(e);a=R(m,"STRONG",{class:!0});var u=B(a);n=D(u,t),s=D(u,":"),u.forEach(x),l=O(m),o=D(m,i),m.forEach(x),this.h()},h(){y(a,"class","svelte-jl2xcj"),y(e,"class","svelte-jl2xcj")},m(h,m){X(h,e,m),f(e,a),f(a,n),f(a,s),f(e,l),f(e,o)},p(h,m){m[0]&8&&t!==(t=h[30].name+"")&&U(n,t),m[0]&8&&i!==(i=h[30].description+"")&&U(o,i)},d(h){h&&x(e)}}}function ra(r){let e,a="Carrying the following:",t,n,s=Z(r[24].carried),l=[];for(let i=0;i<s.length;i+=1)l[i]=na(Qt(r,s,i));return{c(){e=C("p"),e.textContent=a,t=E(),n=C("ul");for(let i=0;i<l.length;i+=1)l[i].c();this.h()},l(i){e=R(i,"P",{class:!0,"data-svelte-h":!0}),ee(e)!=="svelte-z9itxp"&&(e.textContent=a),t=O(i),n=R(i,"UL",{class:!0});var o=B(n);for(let h=0;h<l.length;h+=1)l[h].l(o);o.forEach(x),this.h()},h(){y(e,"class","svelte-jl2xcj"),y(n,"class","svelte-jl2xcj")},m(i,o){X(i,e,o),X(i,t,o),X(i,n,o);for(let h=0;h<l.length;h+=1)l[h]&&l[h].m(n,null)},p(i,o){if(o[0]&8){s=Z(i[24].carried);let h;for(h=0;h<s.length;h+=1){const m=Qt(i,s,h);l[h]?l[h].p(m,o):(l[h]=na(m),l[h].c(),l[h].m(n,null))}for(;h<l.length;h+=1)l[h].d(1);l.length=s.length}},d(i){i&&(x(e),x(t),x(n)),ge(l,i)}}}function na(r){let e,a=r[27].description+"",t,n,s=$e(r[27].value,!1,!1,!1)+"",l;return{c(){e=C("li"),t=I(a),n=I(", worth "),l=I(s),this.h()},l(i){e=R(i,"LI",{class:!0});var o=B(e);t=D(o,a),n=D(o,", worth "),l=D(o,s),o.forEach(x),this.h()},h(){y(e,"class","svelte-jl2xcj")},m(i,o){X(i,e,o),f(e,t),f(e,n),f(e,l)},p(i,o){o[0]&8&&a!==(a=i[27].description+"")&&U(t,a),o[0]&8&&s!==(s=$e(i[27].value,!1,!1,!1)+"")&&U(l,s)},d(i){i&&x(e)}}}function sa(r){let e,a,t=r[24].name+"",n,s,l=r[24].summary+"",i,o,h=r[24].threatLevel+"",m,u,d,b,v=r[24].abilities.length>0&&ta(r),g=r[24].carried.length>0&&ra(r);return{c(){e=C("div"),a=C("h4"),n=I(t),s=I(", "),i=I(l),o=I(" (TL "),m=I(h),u=I(")"),d=E(),v&&v.c(),b=E(),g&&g.c(),this.h()},l(p){e=R(p,"DIV",{class:!0});var w=B(e);a=R(w,"H4",{class:!0});var G=B(a);n=D(G,t),s=D(G,", "),i=D(G,l),o=D(G," (TL "),m=D(G,h),u=D(G,")"),G.forEach(x),d=O(w),v&&v.l(w),b=O(w),g&&g.l(w),w.forEach(x),this.h()},h(){y(a,"class","svelte-jl2xcj"),y(e,"class","mob svelte-jl2xcj")},m(p,w){X(p,e,w),f(e,a),f(a,n),f(a,s),f(a,i),f(a,o),f(a,m),f(a,u),f(e,d),v&&v.m(e,null),f(e,b),g&&g.m(e,null)},p(p,w){w[0]&8&&t!==(t=p[24].name+"")&&U(n,t),w[0]&8&&l!==(l=p[24].summary+"")&&U(i,l),w[0]&8&&h!==(h=p[24].threatLevel+"")&&U(m,h),p[24].abilities.length>0?v?v.p(p,w):(v=ta(p),v.c(),v.m(e,b)):v&&(v.d(1),v=null),p[24].carried.length>0?g?g.p(p,w):(g=ra(p),g.c(),g.m(e,null)):g&&(g.d(1),g=null)},d(p){p&&x(e),v&&v.d(),g&&g.d()}}}function la(r){let e,a,t,n=r[21].name+"",s,l,i,o,h;function m(g,p){return g[21].mobs.length>1?On:En}let u=m(r),d=u(r),b=Z(r[21].mobs),v=[];for(let g=0;g<b.length;g+=1)v[g]=sa(Ut(r,b,g));return{c(){e=C("p"),a=I("There "),d.c(),t=E(),s=I(n),l=I(" here."),i=E(),o=C("div");for(let g=0;g<v.length;g+=1)v[g].c();h=E(),this.h()},l(g){e=R(g,"P",{class:!0});var p=B(e);a=D(p,"There "),d.l(p),t=O(p),s=D(p,n),l=D(p," here."),p.forEach(x),i=O(g),o=R(g,"DIV",{class:!0});var w=B(o);for(let G=0;G<v.length;G+=1)v[G].l(w);h=O(w),w.forEach(x),this.h()},h(){y(e,"class","svelte-jl2xcj"),y(o,"class","mobs svelte-jl2xcj")},m(g,p){X(g,e,p),f(e,a),d.m(e,null),f(e,t),f(e,s),f(e,l),X(g,i,p),X(g,o,p);for(let w=0;w<v.length;w+=1)v[w]&&v[w].m(o,null);f(o,h)},p(g,p){if(u===(u=m(g))&&d?d.p(g,p):(d.d(1),d=u(g),d&&(d.c(),d.m(e,t))),p[0]&8&&n!==(n=g[21].name+"")&&U(s,n),p[0]&8){b=Z(g[21].mobs);let w;for(w=0;w<b.length;w+=1){const G=Ut(g,b,w);v[w]?v[w].p(G,p):(v[w]=sa(G),v[w].c(),v[w].m(o,h))}for(;w<v.length;w+=1)v[w].d(1);v.length=b.length}},d(g){g&&(x(e),x(i),x(o)),d.d(),ge(v,g)}}}function ia(r){let e,a=Z(r[18].groups),t=[];for(let n=0;n<a.length;n+=1)t[n]=la(Pt(r,a,n));return{c(){for(let n=0;n<t.length;n+=1)t[n].c();e=Gt()},l(n){for(let s=0;s<t.length;s+=1)t[s].l(n);e=Gt()},m(n,s){for(let l=0;l<t.length;l+=1)t[l]&&t[l].m(n,s);X(n,e,s)},p(n,s){if(s[0]&8){a=Z(n[18].groups);let l;for(l=0;l<a.length;l+=1){const i=Pt(n,a,l);t[l]?t[l].p(i,s):(t[l]=la(i),t[l].c(),t[l].m(e.parentNode,e))}for(;l<t.length;l+=1)t[l].d(1);t.length=a.length}},d(n){n&&x(e),ge(t,n)}}}function oa(r){let e,a,t="Treasure",n,s,l=Z(r[12].treasureCaches),i=[];for(let o=0;o<l.length;o+=1)i[o]=ha(Ft(r,l,o));return{c(){e=C("div"),a=C("h4"),a.textContent=t,n=E(),s=C("ul");for(let o=0;o<i.length;o+=1)i[o].c();this.h()},l(o){e=R(o,"DIV",{class:!0});var h=B(e);a=R(h,"H4",{class:!0,"data-svelte-h":!0}),ee(a)!=="svelte-1y7msnj"&&(a.textContent=t),n=O(h),s=R(h,"UL",{class:!0});var m=B(s);for(let u=0;u<i.length;u+=1)i[u].l(m);m.forEach(x),h.forEach(x),this.h()},h(){y(a,"class","svelte-jl2xcj"),y(s,"class","svelte-jl2xcj"),y(e,"class","treasure svelte-jl2xcj")},m(o,h){X(o,e,h),f(e,a),f(e,n),f(e,s);for(let m=0;m<i.length;m+=1)i[m]&&i[m].m(s,null)},p(o,h){if(h[0]&8){l=Z(o[12].treasureCaches);let m;for(m=0;m<l.length;m+=1){const u=Ft(o,l,m);i[m]?i[m].p(u,h):(i[m]=ha(u),i[m].c(),i[m].m(s,null))}for(;m<i.length;m+=1)i[m].d(1);i.length=l.length}},d(o){o&&x(e),ge(i,o)}}}function ha(r){let e,a=r[15]+"",t;return{c(){e=C("li"),t=I(a),this.h()},l(n){e=R(n,"LI",{class:!0});var s=B(e);t=D(s,a),s.forEach(x),this.h()},h(){y(e,"class","svelte-jl2xcj")},m(n,s){X(n,e,s),f(e,t)},p(n,s){s[0]&8&&a!==(a=n[15]+"")&&U(t,a)},d(n){n&&x(e)}}}function ca(r){let e,a,t=r[12].id+1+"",n,s,l=At(r[12].name)+"",i,o,h,m,u=r[12].description+"",d,b,v,g,p,w,G,j=r[12].lightLevel==0&&Zt(),le=Z(r[12].features),Y=[];for(let _=0;_<le.length;_+=1)Y[_]=zt(Jt(r,le,_));let q=r[12].secrets!=""&&ea(r),oe=Z(r[12].encounters),W=[];for(let _=0;_<oe.length;_+=1)W[_]=ia(Wt(r,oe,_));let V=r[12].treasureCaches.length>0&&oa(r);return{c(){e=C("div"),a=C("h3"),n=I(t),s=I(". "),i=I(l),o=E(),j&&j.c(),h=E(),m=C("div"),d=I(u),b=E();for(let _=0;_<Y.length;_+=1)Y[_].c();v=E(),q&&q.c(),g=E(),p=C("div");for(let _=0;_<W.length;_+=1)W[_].c();w=E(),V&&V.c(),G=E(),this.h()},l(_){e=R(_,"DIV",{class:!0});var N=B(e);a=R(N,"H3",{class:!0});var k=B(a);n=D(k,t),s=D(k,". "),i=D(k,l),k.forEach(x),o=O(N),j&&j.l(N),h=O(N),m=R(N,"DIV",{class:!0});var z=B(m);d=D(z,u),b=O(z);for(let ie=0;ie<Y.length;ie+=1)Y[ie].l(z);z.forEach(x),v=O(N),q&&q.l(N),g=O(N),p=R(N,"DIV",{class:!0});var se=B(p);for(let ie=0;ie<W.length;ie+=1)W[ie].l(se);se.forEach(x),w=O(N),V&&V.l(N),G=O(N),N.forEach(x),this.h()},h(){y(a,"class","svelte-jl2xcj"),y(m,"class","room-description svelte-jl2xcj"),y(p,"class","encounter svelte-jl2xcj"),y(e,"class","room svelte-jl2xcj")},m(_,N){X(_,e,N),f(e,a),f(a,n),f(a,s),f(a,i),f(e,o),j&&j.m(e,null),f(e,h),f(e,m),f(m,d),f(m,b);for(let k=0;k<Y.length;k+=1)Y[k]&&Y[k].m(m,null);f(e,v),q&&q.m(e,null),f(e,g),f(e,p);for(let k=0;k<W.length;k+=1)W[k]&&W[k].m(p,null);f(e,w),V&&V.m(e,null),f(e,G)},p(_,N){if(N[0]&8&&t!==(t=_[12].id+1+"")&&U(n,t),N[0]&8&&l!==(l=At(_[12].name)+"")&&U(i,l),_[12].lightLevel==0?j||(j=Zt(),j.c(),j.m(e,h)):j&&(j.d(1),j=null),N[0]&8&&u!==(u=_[12].description+"")&&U(d,u),N[0]&8){le=Z(_[12].features);let k;for(k=0;k<le.length;k+=1){const z=Jt(_,le,k);Y[k]?Y[k].p(z,N):(Y[k]=zt(z),Y[k].c(),Y[k].m(m,null))}for(;k<Y.length;k+=1)Y[k].d(1);Y.length=le.length}if(_[12].secrets!=""?q?q.p(_,N):(q=ea(_),q.c(),q.m(e,g)):q&&(q.d(1),q=null),N[0]&8){oe=Z(_[12].encounters);let k;for(k=0;k<oe.length;k+=1){const z=Wt(_,oe,k);W[k]?W[k].p(z,N):(W[k]=ia(z),W[k].c(),W[k].m(p,null))}for(;k<W.length;k+=1)W[k].d(1);W.length=oe.length}_[12].treasureCaches.length>0?V?V.p(_,N):(V=oa(_),V.c(),V.m(e,G)):V&&(V.d(1),V=null)},d(_){_&&x(e),j&&j.d(),ge(Y,_),q&&q.d(),ge(W,_),V&&V.d()}}}function Nn(r){let e,a,t,n="Dungeon Generator",s,l,i="A dungeon generator.",o,h,m,u="Random Seed",d,b,v,g,p,w="Min. Rooms",G,j,le,Y,q,oe="Max. Rooms",W,V,_,N,k="Generate From Seed",z,se,ie="Random Seed (and Generate)",et,ye,Re=r[3].name+"",Me,tt,he,pe,Rt="Environment:",at,je=r[3].environment+"",Ie,rt,ce,ve,jt="Total Threat Level:",nt,Ee=r[3].totalThreatLevel+"",De,st,me,be,Et="Average Threat Level:",lt,Oe=r[3].averageThreatLevel+"",Ve,it,ue,ot,ht,Ot,Te=Z(r[3].rooms),Q=[];for(let A=0;A<Te.length;A+=1)Q[A]=ca(Xt(r,Te,A));return{c(){e=E(),a=C("section"),t=C("h1"),t.textContent=n,s=E(),l=C("p"),l.textContent=i,o=E(),h=C("div"),m=C("label"),m.textContent=u,d=E(),b=C("input"),v=E(),g=C("div"),p=C("label"),p.textContent=w,G=E(),j=C("input"),le=E(),Y=C("div"),q=C("label"),q.textContent=oe,W=E(),V=C("input"),_=E(),N=C("button"),N.textContent=k,z=E(),se=C("button"),se.textContent=ie,et=E(),ye=C("h2"),Me=I(Re),tt=E(),he=C("p"),pe=C("strong"),pe.textContent=Rt,at=E(),Ie=I(je),rt=E(),ce=C("p"),ve=C("strong"),ve.textContent=jt,nt=E(),De=I(Ee),st=E(),me=C("p"),be=C("strong"),be.textContent=Et,lt=E(),Ve=I(Oe),it=E(),ue=C("canvas"),ot=E();for(let A=0;A<Q.length;A+=1)Q[A].c();this.h()},l(A){ja("svelte-negoxg",qt.head).forEach(x),e=O(A),a=R(A,"SECTION",{class:!0});var L=B(a);t=R(L,"H1",{class:!0,"data-svelte-h":!0}),ee(t)!=="svelte-ouv5ej"&&(t.textContent=n),s=O(L),l=R(L,"P",{class:!0,"data-svelte-h":!0}),ee(l)!=="svelte-ma8c12"&&(l.textContent=i),o=O(L),h=R(L,"DIV",{class:!0});var we=B(h);m=R(we,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),ee(m)!=="svelte-1akft3f"&&(m.textContent=u),d=O(we),b=R(we,"INPUT",{type:!0,name:!0,id:!0,class:!0}),we.forEach(x),v=O(L),g=R(L,"DIV",{class:!0});var Se=B(g);p=R(Se,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),ee(p)!=="svelte-1oarxv4"&&(p.textContent=w),G=O(Se),j=R(Se,"INPUT",{type:!0,name:!0,id:!0,class:!0}),Se.forEach(x),le=O(L),Y=R(L,"DIV",{class:!0});var He=B(Y);q=R(He,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),ee(q)!=="svelte-fugdp8"&&(q.textContent=oe),W=O(He),V=R(He,"INPUT",{type:!0,name:!0,id:!0,class:!0}),He.forEach(x),_=O(L),N=R(L,"BUTTON",{class:!0,"data-svelte-h":!0}),ee(N)!=="svelte-1u7zbd5"&&(N.textContent=k),z=O(L),se=R(L,"BUTTON",{class:!0,"data-svelte-h":!0}),ee(se)!=="svelte-192mxrq"&&(se.textContent=ie),et=O(L),ye=R(L,"H2",{class:!0});var Nt=B(ye);Me=D(Nt,Re),Nt.forEach(x),tt=O(L),he=R(L,"P",{class:!0});var Ye=B(he);pe=R(Ye,"STRONG",{class:!0,"data-svelte-h":!0}),ee(pe)!=="svelte-1kamiyt"&&(pe.textContent=Rt),at=O(Ye),Ie=D(Ye,je),Ye.forEach(x),rt=O(L),ce=R(L,"P",{class:!0});var Be=B(ce);ve=R(Be,"STRONG",{class:!0,"data-svelte-h":!0}),ee(ve)!=="svelte-1cj036k"&&(ve.textContent=jt),nt=O(Be),De=D(Be,Ee),Be.forEach(x),st=O(L),me=R(L,"P",{class:!0});var qe=B(me);be=R(qe,"STRONG",{class:!0,"data-svelte-h":!0}),ee(be)!=="svelte-1ejia3j"&&(be.textContent=Et),lt=O(qe),Ve=D(qe,Oe),qe.forEach(x),it=O(L),ue=R(L,"CANVAS",{id:!0,width:!0,height:!0,class:!0}),B(ue).forEach(x),ot=O(L);for(let ct=0;ct<Q.length;ct+=1)Q[ct].l(L);L.forEach(x),this.h()},h(){qt.title="Dungeon Generator | Iron Arachne",y(t,"class","svelte-jl2xcj"),y(l,"class","svelte-jl2xcj"),y(m,"for","seed"),y(m,"class","svelte-jl2xcj"),y(b,"type","text"),y(b,"name","seed"),y(b,"id","seed"),y(b,"class","svelte-jl2xcj"),y(h,"class","input-group svelte-jl2xcj"),y(p,"for","minRooms"),y(p,"class","svelte-jl2xcj"),y(j,"type","number"),y(j,"name","minRooms"),y(j,"id","minRooms"),y(j,"class","svelte-jl2xcj"),y(g,"class","input-group svelte-jl2xcj"),y(q,"for","maxRooms"),y(q,"class","svelte-jl2xcj"),y(V,"type","number"),y(V,"name","maxRooms"),y(V,"id","maxRooms"),y(V,"class","svelte-jl2xcj"),y(Y,"class","input-group svelte-jl2xcj"),y(N,"class","svelte-jl2xcj"),y(se,"class","svelte-jl2xcj"),y(ye,"class","svelte-jl2xcj"),y(pe,"class","svelte-jl2xcj"),y(he,"class","svelte-jl2xcj"),y(ve,"class","svelte-jl2xcj"),y(ce,"class","svelte-jl2xcj"),y(be,"class","svelte-jl2xcj"),y(me,"class","svelte-jl2xcj"),y(ue,"id","mapCanvas"),y(ue,"width","800"),y(ue,"height","1000"),y(ue,"class","svelte-jl2xcj"),y(a,"class","fantasy main svelte-jl2xcj")},m(A,te){X(A,e,te),X(A,a,te),f(a,t),f(a,s),f(a,l),f(a,o),f(a,h),f(h,m),f(h,d),f(h,b),xe(b,r[0]),f(a,v),f(a,g),f(g,p),f(g,G),f(g,j),xe(j,r[1]),f(a,le),f(a,Y),f(Y,q),f(Y,W),f(Y,V),xe(V,r[2]),f(a,_),f(a,N),f(a,z),f(a,se),f(a,et),f(a,ye),f(ye,Me),f(a,tt),f(a,he),f(he,pe),f(he,at),f(he,Ie),f(a,rt),f(a,ce),f(ce,ve),f(ce,nt),f(ce,De),f(a,st),f(a,me),f(me,be),f(me,lt),f(me,Ve),f(a,it),f(a,ue),f(a,ot);for(let L=0;L<Q.length;L+=1)Q[L]&&Q[L].m(a,null);ht||(Ot=[Ne(b,"input",r[6]),Ne(j,"input",r[7]),Ne(V,"input",r[8]),Ne(N,"click",r[4]),Ne(se,"click",r[5])],ht=!0)},p(A,te){if(te[0]&1&&b.value!==A[0]&&xe(b,A[0]),te[0]&2&&Xe(j.value)!==A[1]&&xe(j,A[1]),te[0]&4&&Xe(V.value)!==A[2]&&xe(V,A[2]),te[0]&8&&Re!==(Re=A[3].name+"")&&U(Me,Re),te[0]&8&&je!==(je=A[3].environment+"")&&U(Ie,je),te[0]&8&&Ee!==(Ee=A[3].totalThreatLevel+"")&&U(De,Ee),te[0]&8&&Oe!==(Oe=A[3].averageThreatLevel+"")&&U(Ve,Oe),te[0]&8){Te=Z(A[3].rooms);let L;for(L=0;L<Te.length;L+=1){const we=Xt(A,Te,L);Q[L]?Q[L].p(we,te):(Q[L]=ca(we),Q[L].c(),Q[L].m(a,null))}for(;L<Q.length;L+=1)Q[L].d(1);Q.length=Te.length}},i:$t,o:$t,d(A){A&&(x(e),x(a)),ge(Q,A),ht=!1,La(Ot)}}}function $n(r,e,a){let t=mt(13),n,s=20,l=30,i=mn();i.minRooms=s,i.maxRooms=l;let o=Bt(i),h=new xn(800,1e3,i.height,i.width);function m(){H.use(Oa(t)),i.minRooms=s,i.maxRooms=l,a(3,o=Bt(i)),h.render(o,n)}function u(){a(0,t=mt(13)),m()}ka(()=>{n=document.getElementById("mapCanvas"),u()});function d(){t=this.value,a(0,t)}function b(){s=Xe(this.value),a(1,s)}function v(){l=Xe(this.value),a(2,l)}return[t,s,l,o,m,u,d,b,v]}class Un extends Ca{constructor(e){super(),Ra(this,e,$n,Nn,_a,{},null,[-1,-1])}}export{Un as component};
//# sourceMappingURL=10.83c9cda4.js.map

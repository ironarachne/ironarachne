import{s as ya,n as Nt,r as Ta,o as xa}from"../chunks/scheduler.5o8iMP-j.js";import{S as _a,i as La,s as j,e as k,t as M,l as ka,d as T,f as E,c as C,a as Y,g as z,b as I,m as w,h as B,j as u,p as Te,q as Oe,z as Be,k as P,n as fe,v as $t}from"../chunks/index.EoApDFme.js";import{g as Ca}from"../chunks/globals.0cDDIVm6.js";import{e as J}from"../chunks/each.-oqiv04n.js";import{v as Ne}from"../chunks/currency.yngSJRXp.js";import{w as xe,r as S,i as y,b as ae,a as ct,s as Ra}from"../chunks/index.BP-IY3w8.js";import{c as mt,a as _e,b as ca,t as Gt}from"../chunks/index.718X_Gn9.js";import{i as ja,j as At,k as Mt,l as It,e as Ea,m as Oa,s as $e,w as Na,a as $a,n as V,o as Fe,b as bt,p as We}from"../chunks/characters._BTRwP5J.js";import{g as Ga}from"../chunks/premade_configs.c6DHGnq2.js";import{r as Aa,e as Ma}from"../chunks/size_matrix.wHaD-wqf.js";import{a as Dt,g as Ia,b as Da}from"../chunks/climates.3jvB98a7.js";import{M as Va,w as Sa,c as Ha,b as Ya,d as qa,f as Ba,a as Xa}from"../chunks/patterns.hFWI38mc.js";import{G as Pe}from"../chunks/lodash.vCtjnWuh.js";import{r as te}from"../chunks/dice.xzO0DG26.js";function Fa(r){let e=xe(r.speciesOptions),a=Aa(r.ageCategoryNames,e.ageCategories),t=S.int(a.minAge,a.maxAge);const n=y(r.genderNames);let s=e.genders.find(d=>d.name===n);const l=Ma(s.name,a.name,e.sizeGeneratorConfigMatrix),i=S.int(l.minHeight,l.maxHeight),o=S.int(l.minWeight,l.maxWeight),h=S.int(l.minLength,l.maxLength);let c=ja(e),m=["cautious","hunting","lethargic","resting","sleeping","stalking"],g=y(m),v=e.abilities,p=e.baseThreatLevel;for(let d=0;d<v.length;d++)p+=v[d].threatLevel;return{name:e.name,description:e.description,summary:g,statBlock:null,species:e,abilities:v,behaviors:m,threatLevel:p,physicalTraits:c,gender:s,height:i,weight:o,length:h,age:t,ageCategory:a,carried:[],tags:e.tags,creatureTypes:e.creatureTypes}}function Wa(){return{ageCategoryNames:["adult"],genderNames:["female","male"],speciesOptions:[]}}function Pa(r){let e=[];if(r.template===null)throw new Error("EncounterGenerator requires a template.");for(let t=0;t<r.template.groupTemplates.length;t++){let n=[],s=r.template.groupTemplates[t],l=S.int(s.minNumber,s.maxNumber),i=[],o=[];s.isSentient?o=JSON.parse(JSON.stringify(r.sentientOptions)):o=JSON.parse(JSON.stringify(r.creatureOptions));let h=s.filter.withAllTags.concat(s.filter.withAnyTag);if(h.includes("undead")){let c=o.concat(At(o)),m=o.concat(Mt(o)),g=o.concat(It(o));o=o.concat(c),o=o.concat(m),o=o.concat(g)}else if(h.includes("skeleton")){let c=o.concat(At(o));o=o.concat(c)}else if(h.includes("vampire")){let c=o.concat(Mt(o));o=o.concat(c)}else if(h.includes("zombie")){let c=o.concat(It(o));o=o.concat(c)}i=s.filter.apply(o),i.length===0&&(console.error("No options for filter",s.filter),console.debug("Used options",o)),s.isSentient?n=Qa(i,s.archetypes,l):n=Ua(i,l),e.push({name:s.name,mobs:n})}let a=0;for(let t=0;t<e.length;t++){let n=e[t];for(let s=0;s<n.mobs.length;s++)a+=n.mobs[s].threatLevel}return{groups:e,totalThreatLevel:a}}function Ua(r,e){let a=y(r),t=[],n=Wa();for(let s=0;s<e;s++){n.speciesOptions=[a];let l=Fa(n);t.push(l)}return t}function Qa(r,e,a){let t=y(r),n=[],s=Ga();s.speciesOptions=[t];for(let l=0;l<a;l++){let i=Ea(s);i.archetype=y(e),i.abilities=i.abilities.concat(i.archetype.abilities),i.threatLevel=Oa(i),i.summary=`${i.gender.name} ${i.species.adjective} ${i.archetype.name}`;for(let o=0;o<i.archetype.itemGenerators.length;o++)i.carried.push(i.archetype.itemGenerators[o].generate());n.push(i)}return n}function Ka(){return{isHostile:!0,environment:"forest",template:null,sentientOptions:$e(),creatureOptions:Na("sentient",$a),minThreatLevel:1,maxThreatLevel:4}}function Ue(r,e){return Math.sqrt(Math.pow(e.x-r.x,2)+Math.pow(e.y-r.y,2))}function Ja(r){let e=[];for(let a=0;a<r.length;a++){let t=r[a],n=r[0];a<r.length-1&&(n=r[a+1]);let s={a:t,b:n};e.push(s)}return e}function Za(r){let e=(r.a.x+r.b.x)/2,a=(r.a.y+r.b.y)/2;return{x:e,y:a}}function za(r){return(r.b.y-r.a.y)/(r.b.x-r.a.x)}function wt(r,e){return r.x==e.x&&r.y==e.y}function er(r,e){for(let a=0;a<e.length;a++)if(wt(r,e[a]))return!0;return!1}class tr{id;name;description;objectId;strength;isLocked;constructor(){this.id="",this.name="a lock",this.description="a lock",this.objectId=-1,this.strength=1,this.isLocked=!0}}const ut=0,yt=1,Tt=2,ft=3,ma=4,ua=5;class re{name;allowedEnvironments;minWidth;maxWidth;minHeight;maxHeight;flooringOptions;dressingGenerators;featureGenerators;mutators;shapes;tags;commonality;constructor(e,a,t,n,s,l,i,o,h,c,m,g,v){this.name=e,this.allowedEnvironments=a,this.minWidth=t,this.maxWidth=s,this.minHeight=n,this.maxHeight=l,this.flooringOptions=i,this.dressingGenerators=o,this.featureGenerators=h,this.mutators=c,this.shapes=m,this.tags=g,this.commonality=v}}class ar{id;name;description;secrets;shape;tileMesh;tiles;vertices;minX;minY;maxX;maxY;center;lightLevel;features;treasureCaches;encounters;theme;doors;constructor(){this.id=-1,this.name="",this.tileMesh=[],this.encounters=[],this.features=[],this.doors=[],this.description="",this.minX=0,this.minY=0,this.maxX=0,this.maxY=0,this.center={x:0,y:0},this.shape={vertices:[],edges:[]},this.theme=new re("",[],0,0,0,0,[],[],[],[],[],[],0),this.secrets="",this.tiles=[],this.treasureCaches=[],this.vertices=[],this.lightLevel=0}calculateTileMesh(){let e=[],a=this.minY,t=this.maxY,n=this.minX,s=this.maxX;for(let l=a;l<t;l++)for(let i=n;i<s;i++){let o={vertices:[],edges:[]};o.vertices=[{x:i-.5,y:l-.5},{x:i+.5,y:l-.5},{x:i+.5,y:l+.5},{x:i-.5,y:l+.5}],o.edges=Ja(o.vertices),e.push(o)}this.tileMesh=e}calculateTiles(e,a){let t=[];for(let n=0;n<a;n++){let s=[];t[n]=s;for(let l=0;l<e;l++)t[n][l]=ut}for(let n=0;n<this.vertices.length;n++)this.vertices[n].y>t.length-1&&console.debug(`Vertices outside the bounds of the map: ${t.length} newTiles.length, ${this.vertices[n].y} this.vertices[i].y`,this.vertices),t[this.vertices[n].y][this.vertices[n].x]=yt;this.tiles=t}calculateVertices(){let e=[];for(let a=0;a<this.tiles.length;a++)for(let t=0;t<this.tiles[a].length;t++)this.tiles[a][t]!=ut&&e.push({x:t,y:a});this.vertices=e}getTileEdges(){let e=[];for(let a=0;a<this.tileMesh.length;a++)for(let t=0;t<this.tileMesh[a].edges.length;t++)e.push(this.tileMesh[a].edges[t]);return e}getCenter(){let e=this.minX+(this.maxX-this.minX)/2,a=this.minY+(this.maxY-this.minY)/2;return{x:e,y:a}}getMinX(){let e=this.vertices[0].x;for(let a=0;a<this.vertices.length;a++)this.vertices[a].x<e&&(e=this.vertices[a].x);return e}getMaxX(){let e=this.vertices[0].x;for(let a=0;a<this.vertices.length;a++)this.vertices[a].x>e&&(e=this.vertices[a].x);return e}getMinY(){let e=this.vertices[0].y;for(let a=0;a<this.vertices.length;a++)this.vertices[a].y<e&&(e=this.vertices[a].y);return e}getMaxY(){let e=this.vertices[0].y;for(let a=0;a<this.vertices.length;a++)this.vertices[a].y>e&&(e=this.vertices[a].y);return e}getHeight(){return this.maxY-this.minY}getWidth(){return this.maxX-this.minX}moveBy(e,a,t,n){for(let s=0;s<this.vertices.length;s++)this.vertices[s].x+=e,this.vertices[s].y+=a;this.calculateTiles(t,n),this.minX=this.getMinX(),this.maxX=this.getMaxX(),this.minY=this.getMinY(),this.maxY=this.getMaxY(),this.center=this.getCenter()}moveTo(e,a,t,n){const s=e-this.minX,l=a-this.minY;for(let i=0;i<this.vertices.length;i++)this.vertices[i].x+=s,this.vertices[i].y+=l;this.calculateTiles(t,n),this.minX=this.getMinX(),this.maxX=this.getMaxX(),this.minY=this.getMinY(),this.maxY=this.getMaxY(),this.center=this.getCenter()}}class fa{config;constructor(e){this.config=e}generate(){let e=S.int(this.config.theme.minWidth,this.config.theme.maxWidth),a=S.int(this.config.theme.minHeight,this.config.theme.maxHeight),t=S.int(2,this.config.mapWidth-e-3),n=S.int(2,this.config.mapHeight-a-3),s=new ar;s.name=this.config.theme.name,s.theme=this.config.theme;let l=y(this.config.theme.shapes);if(l=="rectangular"?(s=sr(t,n,e,a,s),s.description=y([`This rectangular room is ${e*5}' wide and ${a*5}' long.`,`This ${s.name} is ${e*5}' wide and ${a*5}' long.`])):l=="square"?(s=lr(t,n,e,s),s.description=y([`This square room is ${e*5}' wide and ${a*5}' long.`,`This room is a square ${e*5}' wide and ${a*5}' long.`,`This ${s.name} is ${e*5}' wide and ${a*5}' long.`])):l=="cavern"?(s=rr(t,n,e,a,s),s.description=y(["This is a cavern."])):l=="corridor"&&(s=nr(t,n,e,a,s),s.description=y(["This is a corridor."])),ae(100)>70){let i=y(s.theme.flooringOptions);s.description+=y([` The floor is ${i}.`,` ${mt(i)} flooring is cracked in places.`,` The ${i} flooring is cracked in places.`,` The ${i} flooring is broken in places.`])}for(let i=0;i<this.config.theme.featureGenerators.length;i++){let o=this.config.theme.featureGenerators[i].generate();s.features.push(o),o.secret!=""&&(s.secrets+=o.secret+" ")}if(this.config.theme.dressingGenerators.length>0&&ae(100)>70){let i=y(this.config.theme.dressingGenerators);s.features.push(i.generate())}return s.minX=t,s.maxX=s.getMaxX(),s.minY=n,s.maxY=s.getMaxY(),s.center=s.getCenter(),s.calculateTiles(this.config.mapWidth,this.config.mapHeight),s}}function rr(r,e,a,t,n){let s={x:Math.floor((r+a)/2),y:Math.floor((e+t)/2)},l=20;const i=r+a,o=e+t;n.vertices.push(s);let h={x:s.x,y:s.y};for(let c=0;c<l;c++){let m=h.x,g=h.y;if(ae(100)>50){let f=S.int(-1,1);m+=f,m>i?m=i:m<r&&(m=r)}else{let f=S.int(-1,1);g+=f,g>o?g=o:g<e&&(g=e)}let v={x:m,y:g},p=!1;for(let f=0;f<n.vertices.length;f++)if(wt(n.vertices[f],v)){p=!0;break}p||n.vertices.push(v),h.x=m,h.y=g}return n}function nr(r,e,a,t,n){let s=S.int(Math.max(3,Math.floor((a+t-2)/2)),a+t-2),l=S.int(r,r+a-1),i=S.int(e,e+t-1);n.vertices.push({x:l,y:i});let o=y([{x:-1,y:0},{x:1,y:0},{x:0,y:-1},{x:0,y:1}]);for(let h=0;h<s;h++){let c=l+o.x,m=i+o.y;if(c>=a+r||c<=r)o.x=0,o.y=y([-1,1]);else if(m>=t+e||m<=e)o.y=0,o.x=y([-1,1]);else{l=c,i=m;let g={x:l,y:i};if(er(g,n.vertices))continue;n.vertices.push(g),ae(100)>90&&(o.y!=0?(o.x=o.y,o.y=0):(o.y=o.x,o.x=0))}}return n}function sr(r,e,a,t,n){for(let s=e;s<e+t;s++)for(let l=r;l<r+a;l++)n.vertices.push({x:l,y:s});return n.description=`This room is ${(a+1)*5}' wide and ${(t+1)*5}' long.`,n}function lr(r,e,a,t){for(let n=e;n<e+a;n++)for(let s=r;s<r+a;s++)t.vertices.push({x:s,y:n});return t.description=`This square room is ${(a+1)*5}' wide and ${(a+1)*5}' long.`,t}class ga{mapHeight;mapWidth;theme;constructor(e,a,t){this.mapHeight=a,this.mapWidth=e,this.theme=t}}function ir(r,e){let a=1e7;for(let t=0;t<e.length;t++)for(let n=0;n<e[t].vertices.length;n++)for(let s=0;s<r.vertices.length;s++){let l=Ue(e[t].vertices[n],r.vertices[s]);l<=a&&(a=l)}return a}function or(r,e){for(let a=0;a<e.length;a++)for(let t=0;t<e[a].vertices.length;t++)for(let n=0;n<r.vertices.length;n++)if(wt(r.vertices[n],e[a].vertices[t]))return!0;return!1}function hr(r,e){for(let a=0;a<e.length;a++)for(let t=0;t<e[a].vertices.length;t++)for(let n=0;n<r.vertices.length;n++)if(Ue(r.vertices[n],e[a].vertices[t])==1)return!0;return!1}function cr(r,e){let a=[],t=[];for(let n=0;n<e.length;n++)for(let s=0;s<r.vertices.length;s++)for(let l=0;l<e[n].vertices.length;l++)if(Ue(e[n].vertices[l],r.vertices[s])<=2&&!t.includes(e[n].id)&&e[n].id!=r.id){t.push(e[n].id),a.push(e[n]);break}return a}function Vt(r,e,a,t){let n=!0,s=r-3,l=e-3,i=new ga(r,e,a),o=new fa(i),h=o.generate(),c=0,m=5,g=h.minX+1,v=h.minY;for(;n;)if(!or(h,t)&&!hr(h,t)&&mr(2,h,t))n=!1;else if(c<=m){if(g+=1,g>s-h.getWidth()&&(g=2,v++,v>l-h.getHeight())){c++,g=2,v=2;continue}h.moveTo(g,v,r,e)}else{if(c>m)return null;c++,h=o.generate(),g=h.minX+1,v=h.minY}return h}function mr(r,e,a){return ir(e,a)==r}function ur(r,e){let a={room1:-1,room2:-1,vertex:{x:0,y:0},tile:0,lock:null,isSecret:!1,description:""},t=[];for(let l=0;l<r.vertices.length;l++)for(let i=0;i<e.vertices.length;i++)if(Ue(r.vertices[l],e.vertices[i])==2){let h=r.vertices[l],c=e.vertices[i];t.push({a:h,b:c})}let n=y(t);a.vertex=Za(n),za(n)===0?a.tile=ft:a.tile=Tt,ae(100)>90?(a.lock=new tr,a.lock.id=ct(24)):ae(100)>90&&(a.isSecret=!0,a.tile==ft?a.tile=ua:a.tile=ma),a.room1=r.id,a.room2=e.id;let s=y([y(["rough","decaying","rotted"]),"simple","plain",y(["iron-trimmed","copper-trimmed","silver-trimmed","gold-trimmed","painted","carved","ornate"])]);return a.description=_e(s)+" "+s+" door",a}function fr(r){for(let e=0;e<r.rooms.length;e++){let a=cr(r.rooms[e],r.rooms),t=[];for(let v=0;v<a.length;v++){let p=!1;for(let f=0;f<r.rooms[e].doors.length;f++){let d=r.doors[r.rooms[e].doors[f]];(d.room1==r.rooms[e].id&&d.room2==a[v].id||d.room2==r.rooms[e].id&&d.room1==a[v].id)&&(p=!0)}p||t.push(a[v])}if(t.length==0)continue;let n=y(t),s=ur(r.rooms[e],n);n.id==0&&(s.isSecret=!1,r.rooms[0].doors.length<2&&(s.lock=null)),r.doors.push(s);let l=r.doors.length-1;r.rooms[e].doors.push(l);let i=St(s,r.rooms[e]),o=St(s,r.rooms[n.id]),h="",c="";if(s.isSecret){let v=y([`${y(["It is","It's"])} hidden behind a tapestry.`,`${y(["It is","It's"])} practically undetectable except for a thin seam visible only on close inspection.`,"A tapestry obscures it.","It cannot be opened from this side.",`A pile of ${y(["refuse","debris","trash"])} obscures it.`]);ae(100)>50?(c=`${o} ${v}`,o=""):(h=`${i} ${v}`,i=""),r.rooms[e].secrets+=h,r.rooms[n.id].secrets+=c}let m={name:"door",description:i,secret:h,isContainer:!1},g={name:"door",description:o,secret:c,isContainer:!1};r.rooms[e].features.push(m),r.rooms[n.id].doors.push(l),r.rooms[n.id].features.push(g),r.tiles=gr(s,r.tiles)}return r}function gr(r,e){return e[r.vertex.y][r.vertex.x]=r.tile,e}function St(r,e){let a="";r.tile==Tt?r.vertex.y>e.center.y?r.vertex.x<e.center.x?a="southwest":r.vertex.x>e.center.x?a="southeast":a="south":r.vertex.x<e.center.x?a="northwest":r.vertex.x>e.center.x?a="northeast":a="north":r.vertex.x<e.center.x?r.vertex.y>e.center.y?a="southwest":r.vertex.y<e.center.y?a="northwest":a="west":r.vertex.y>e.center.y?a="southeast":r.vertex.y<e.center.y?a="northeast":a="east";let t=y([`There's ${r.description} in the ${a}`,`There is ${r.description} in the ${a}`,mt(r.description)+` lies in the ${a}`,mt(r.description)+` is in the ${a}`]);return r.lock!=null?t+=". It is locked.":t+=".",t}class W{name;descriptionOptions;secretOptions;isContainer;constructor(e,a,t,n){this.name=e,this.descriptionOptions=a,this.secretOptions=t,this.isContainer=n}generate(){let e="";return ae(100)>70&&this.secretOptions.length>0&&(e=y(this.secretOptions)),{name:this.name,description:y(this.descriptionOptions),secret:e,isContainer:this.isContainer}}}class Ht{name;mutate;tags;constructor(e,a,t){this.name=e,this.mutate=a,this.tags=t}}function dr(){return[new Ht("brazier",r=>{let e=new W("brazier",["There is a large lit brazier in the middle of the room.","There are lit braziers around the room here."],[],!1);return r.features.push(e.generate()),r.lightLevel+=2,r},["light"]),new Ht("torches",r=>{let e=new W("torches",["Torches line the walls.","A few torches sit in sconces on the walls."],[],!1);return r.features.push(e.generate()),r.lightLevel+=1,r},["light"])]}function pr(r,e){let a=[];for(let t=0;t<e.length;t++)e[t].tags.includes(r)&&a.push(e[t]);return a}function vr(){let r=[new W("debris",["There is a pile of random debris here.","Much of the floor is covered in debris.","Debris of unknown origin is scattered about."],[],!1),new W("rags",["There is a pile of rags here.","One of the corners has a large pile of filthy rags.","Small piles of rags are scattered across the floor."],[],!1),new W("cobwebs",["There are a lot of cobwebs here.","The ceiling is partly covered in cobwebs.","Dense cobwebs hang down from the ceiling."],[],!1)];return[new re("altar room",[],3,3,10,10,["marble","stone tile"],r,[new W("altar",["There is an evil-looking altar here.","There is a blood-covered altar here.","On top of a stone dais is a long altar."],[],!1)],[],["rectangular"],["cult"],5),new re("armory",[],3,3,6,6,["stone tile"],r,[new W("weapon racks",["Weapon racks full of old spears, swords, and axes line the walls.","Each wall has at least one wooden rack full of weapons.","There are rows of weapon racks here."],[],!1),new W("armor displays",["Pieces of armor in various states of disrepair hang from pegs on the walls.","There are numerous pegs on the walls for armor to be hung.","Several pieces of armor are on armor stands here."],[],!1)],[],["rectangular","square"],["military"],5),new re("barracks",[],8,8,15,15,["stone tile"],r,[new W("beds",["There are many beds here.","There are many bunk beds here.","There are many cots here.","Beds line the walls.","Cots line the walls."],[],!1),new W("chests",["There are chests at the end of each bed.","Each bed has a chest at the foot."],[],!0)],[],["rectangular"],["military"],5),new re("burial chamber",[],5,5,10,10,["stone tile"],r,[new W("coffins",["There is a large stone sarcophagus here.","There is an ornate sarcophagus here.","There are several sarcophagi here.","There is a large, ornate coffin here.","There are many coffins here.","Coffins line the walls.","Along the walls are several long alcoves. Each one has a stone coffin."],[],!0)],[],["rectangular"],["tomb"],5),new re("chamber",[],2,2,6,6,["marble","stone tile"],r,[],[],["rectangular","square"],["dungeon"],40),new re("fountain chamber",[],2,2,5,5,["stone tile"],r,[new W("fountain",["There is a large fountain here.","There is an ornate fountain here.","There is a disused fountain here with brackish water.","There is an elegant fountain here.","Two fountains lie on either side of the room.","Small fountains sit in each corner of the room.","An old and disused fountain sits in the corner."],[],!0)],[],["rectangular","square"],["dungeon","nobility"],5),new re("kitchen",[],2,2,5,5,["stone tile"],r,[new W("oven",["There is a large wood-fired oven here.","There are several large ovens here.","Ovens line one of the walls.","A long-dormant oven sits against the back wall."],[],!1),new W("pantry cabinet",["There is a pantry cabinet here.","A pantry cabinet sits against one wall."],[],!0),new W("table",["There is a table here.","A table sits against one wall.","An assortment of kitchen utensils and tools sit on a large table here."],[],!1)],[],["rectangular"],["food","military"],5),new re("laboratory",[],4,4,6,6,["stone tile"],r,[new W("lab table",["There is a large table here with a wide array of alchemical devices on it.","There are several tables here with various devices on them.","Tables with alchemical devices, books, and other items are arranged around the room."],[],!1),new W("specimen cabinet",["There is a large cabinet here.","There is a simple cabinet here, and the door is ajar.","There is a cabinet here."],[],!0)],[],["rectangular"],["alchemy","mage"],5),new re("library",[],5,5,15,15,["stone tile"],r,[new W("bookcases",["There are many bookcases here.","There are a number of well-preserved bookcases here.","The walls are lined with bookcases."],[],!0),new W("table",["There are several tables here.","There is a table here with a large book open lying on it."],[],!1)],[],["rectangular","square"],["mage","nobility"],5),new re("storeroom",[],2,2,6,6,["stone tile"],r,[new W("stacked boxes",["Many boxes are stacked here.","Boxes are stacked in corners here.","Crates and large boxes line the walls.","A few broken crates and boxes are strewn about."],[],!0)],[],["rectangular","square"],["dungeon"],20)]}function Qe(){let r=[];return r=r.concat(vr()),r}function gt(r,e){for(let a=0;a<e.length;a++)if(e[a].name==r)return e[a];throw new Error(`Failed to find room theme with name ${r}.`)}function ge(r,e){let a=[];for(let t=0;t<e.length;t++)e[t].tags.includes(r)&&a.push(e[t]);return a}function br(){return new re("entrance",[],2,2,4,4,["stone tile"],[],[new W("entrance",["The entrance to the dungeon is here.","The stairs out of the dungeon are here.","There is a set of stairs here leading out of the dungeon.","The stairs leading out of the dungeon are here."],[],!1)],[],["rectangular","square"],["dungeon","entrance"],10)}class wr{name;mutate;requiredTag;tags;constructor(e,a,t,n){this.name=e,this.mutate=a,this.requiredTag=t,this.tags=n}}function yr(){let r=[{element:"fire",damage:"+1d6 fire",description:"The blade is wreathed in flame when wielded. Anything flammable struck with it immediately ignites."},{element:"ice",damage:"+1d6 cold",description:"The blade is surrounded by a layer of ice when wielded. Enemies struck with it are chilled to the bone and have difficulty moving."},{element:"lightning",damage:"+1d6 electricity",description:"The blade is surrounded by crackling lightning when wielded."},{element:"poison",damage:"+1d6 poison",description:"The blade is coated in a sickly green liquid when wielded. The liquid is highly poisonous, causing illness and eventually death if not cured."},{element:"acid",damage:"+1d6 acid",description:"The blade is coated in a thin yellow acid when wielded."},{element:"darkness",damage:"+1d6 darkness",description:"The blade is hidden in shadow when wielded. It is difficult for enemies to predict where attacks with this weapon will come from."},{element:"light",damage:"+1d6 light",description:"The blade glows faintly when wielded. On command, that light glows brightly enough to illuminate a large room."},{element:"earth",damage:"+1d6 earth",description:"The blade appears to be made of stone. Anything struck with it is turned to stone."}],e=[];for(let a of r)e.push(new wr(`${a.element}-enchanted melee weapon`,t=>(t.name=`${a.element}-enchanted ${t.name}`,t instanceof Va&&(t.damage+=` ${a.damage}`),t.description+=` ${a.description}`,t.value+=1e4,t),"bladed weapon",["weapon","melee weapon","bladed weapon","enchantment",a.element]));return e}function Tr(){let r=[];return r=r.concat(yr()),r}function xr(r,e){let a=[],t=[];for(let n=0;n<e.length;n++)for(let s=0;s<r.length;s++)if(e[n].tags.includes(r[s])&&!t.includes(e[n].name)){a.push(e[n]),t.push(e[n].name);continue}return a}class da{config;constructor(e){this.config=e}generate(){let e=S.int(this.config.minQuality,this.config.maxQuality),a=Sa(this.config.maxQuality,this.config.components);a=Ha(this.config.minQuality,a);let t=this.config.pattern.complete(this.config.components,e);if(this.config.useMutator){let n=xr(t.tags,this.config.mutators);n.length>0&&(t=y(n).mutate(t))}return t}}class pa{pattern;components;minValue;maxValue;minQuality;maxQuality;mutators;useMutator;constructor(){this.components=Ya(),this.minValue=0,this.maxValue=0,this.minQuality=0,this.maxQuality=1,this.mutators=Tr(),this.useMutator=!1}}function Q(r,e){let a=new pa;a.pattern=qa(r);let t=0,n=e,s=10,l=e;return e==1?s=20:e==2?(t=10,s=30):e==3?(t=30,s=50):e==3?(t=50,s=100):e==4&&(t=100,s=1e4),a.minValue=t,a.maxValue=s,a.minQuality=n,a.maxQuality=l,new da(a)}function A(r,e){let a=Ba(r);return Q(y(a).name,e)}function _r(){return[{name:"cleric",abilities:[{name:"turn undead",description:"turns undead creatures",category:"divine",threatLevel:1},{name:"divine spellcasting",description:"casts divine spells",category:"divine",threatLevel:1}],tags:["cleric"],threatLevel:2,itemGenerators:[A("mace",1),A("breastplate",1)]},{name:"priest",abilities:[{name:"turn undead",description:"turns undead creatures",category:"divine",threatLevel:1},{name:"divine spellcasting",description:"casts divine spells",category:"divine",threatLevel:2}],tags:["cleric"],threatLevel:1,itemGenerators:[A("staff",1),A("robe",1)]},{name:"high priest",abilities:[{name:"turn undead",description:"turns undead creatures",category:"divine",threatLevel:1},{name:"divine spellcasting",description:"casts divine spells",category:"divine",threatLevel:3}],tags:["cleric"],threatLevel:2,itemGenerators:[A("staff",2),A("robe",2)]}]}function Lr(){return[{name:"cult acolyte",abilities:[],tags:["cult"],threatLevel:1,itemGenerators:[A("staff",1),Q("robe",0)]},{name:"cult priest",abilities:[{name:"demonic spellcasting",description:"casts demonic spells",category:"demonic",threatLevel:2}],tags:["cult"],threatLevel:2,itemGenerators:[A("staff",1),Q("robe",1)]},{name:"cult high priest",abilities:[{name:"demonic spellcasting",description:"casts demonic spells",category:"demonic",threatLevel:3}],tags:["cult"],threatLevel:3,itemGenerators:[A("staff",3),A("knife",2),Q("robe",3)]}]}function kr(){return[{name:"apprentice mage",abilities:[{name:"arcane spellcasting",description:"casts arcane spells",category:"spellcaster",threatLevel:1}],tags:["magic user"],threatLevel:1,itemGenerators:[Q("staff",1),Q("robe",0)]},{name:"archmage",abilities:[{name:"arcane spellcasting",description:"casts arcane spells",category:"spellcaster",threatLevel:8}],tags:["magic user"],threatLevel:4,itemGenerators:[Q("staff",3),Q("robe",3)]},{name:"druid",abilities:[{name:"nature spellcasting",description:"casts nature spells",category:"spellcaster",threatLevel:1}],tags:["magic user"],threatLevel:2,itemGenerators:[Q("staff",1),Q("robe",0)]},{name:"mage",abilities:[{name:"arcane spellcasting",description:"casts arcane spells",category:"spellcaster",threatLevel:4}],tags:["magic user"],threatLevel:2,itemGenerators:[Q("staff",1),Q("robe",0)]},{name:"necromancer",abilities:[{name:"necromantic spellcasting",description:"casts necromantic spells",category:"spellcaster",threatLevel:2}],tags:["magic user"],threatLevel:4,itemGenerators:[Q("staff",3),Q("robe",3)]},{name:"sorcerer",abilities:[{name:"arcane spellcasting",description:"casts arcane spells",category:"spellcaster",threatLevel:1}],tags:["magic user"],threatLevel:2,itemGenerators:[]},{name:"warlock",abilities:[{name:"demonic spellcasting",description:"casts demonic spells",category:"spellcaster",threatLevel:1}],tags:["magic user"],threatLevel:2,itemGenerators:[]},{name:"witch",abilities:[{name:"arcane spellcasting",description:"casts arcane spells",category:"spellcaster",threatLevel:1}],tags:["magic user"],threatLevel:2,itemGenerators:[]},{name:"wizard",abilities:[{name:"arcane spellcasting",description:"casts arcane spells",category:"spellcaster",threatLevel:4}],tags:["magic user"],threatLevel:2,itemGenerators:[Q("staff",1),Q("robe",1)]}]}function Cr(){return[{name:"archer",abilities:[],tags:["martial","military"],threatLevel:1,itemGenerators:[A("bow",1)]},{name:"captain",abilities:[],tags:["martial","military"],threatLevel:1,itemGenerators:[A("sword",2),A("breastplate",2),A("helmet",2)]},{name:"general",abilities:[],tags:["martial","military"],threatLevel:1,itemGenerators:[A("sword",3),A("breastplate",3),A("helmet",3)]},{name:"guard",abilities:[],tags:["martial","military"],threatLevel:1,itemGenerators:[A("spear",1),A("body armor",1)]},{name:"hunter",abilities:[],tags:["martial","wilderness"],threatLevel:1,itemGenerators:[]},{name:"martial artist",abilities:[],tags:["martial"],threatLevel:1,itemGenerators:[]},{name:"martial arts master",abilities:[],tags:["martial"],threatLevel:2,itemGenerators:[]},{name:"raider captain",abilities:[],tags:["criminal","martial"],threatLevel:1,itemGenerators:[A("sword",1),A("breastplate",1)]},{name:"raider",abilities:[],tags:["criminal","martial"],threatLevel:1,itemGenerators:[A("weapon",1),A("body armor",1)]},{name:"ranger",abilities:[],tags:["martial","wilderness"],threatLevel:3,itemGenerators:[]},{name:"soldier",abilities:[],tags:["martial","military"],threatLevel:1,itemGenerators:[A("martial weapon",1),A("body armor",1)]},{name:"thug",abilities:[],tags:["criminal","martial"],threatLevel:1,itemGenerators:[A("club",1)]},{name:"veteran hunter",abilities:[],tags:["martial","wilderness"],threatLevel:2,itemGenerators:[A("bow",3)]},{name:"veteran soldier",abilities:[],tags:["martial","military"],threatLevel:2,itemGenerators:[A("sword",2),A("breastplate",2)]},{name:"warrior",abilities:[],tags:["martial","wilderness"],threatLevel:1,itemGenerators:[A("simple weapon",1)]}]}function Rr(){return[{name:"lich",abilities:[{name:"necromantic spellcasting",description:"casts necromantic spells",category:"spellcaster",threatLevel:8}],tags:["undead"],threatLevel:5,itemGenerators:[]},{name:"shambler",abilities:[],tags:["undead"],threatLevel:1,itemGenerators:[]},{name:"sprinter",abilities:[],tags:["undead"],threatLevel:2,itemGenerators:[]}]}function Le(){let r=[];return r=r.concat(_r()),r=r.concat(Lr()),r=r.concat(kr()),r=r.concat(Cr()),r=r.concat(Rr()),r}function jr(r,e){let a=[];for(let t=0;t<e.length;t++){let n=!0;for(let s=0;s<r.length;s++)if(!e[t].tags.includes(r[s])){n=!1;break}n===!0&&a.push(e[t])}return a}function Er(r,e){let a=[];for(let t=0;t<e.length;t++){let n=!1;for(let s=0;s<r.length;s++)if(e[t].tags.includes(r[s])){n=!0;break}n===!0&&a.push(e[t])}return a}function Or(r,e){let a=[];for(let t=0;t<e.length;t++)e[t].creatureTypes.includes(r)&&a.push(e[t]);return a}function Nr(r,e){let a=[];for(let t=0;t<e.length;t++)e[t].environments.includes(r)&&a.push(e[t]);return a}function $r(r,e){let a=[];for(let t=0;t<e.length;t++){let n=!0;for(let s=0;s<r.length;s++)if(e[t].tags.includes(r[s])){n=!1;break}n===!0&&a.push(e[t])}return a}class N{withAllTags;withAnyTag;withCreatureType;withEnvironment;withNoTags;constructor(e,a,t,n,s){this.withAllTags=e,this.withAnyTag=a,this.withCreatureType=t,this.withEnvironment=n,this.withNoTags=s}apply(e){let a=e;return this.withAllTags.length>0&&(a=jr(this.withAllTags,a)),this.withAnyTag.length>0&&(a=Er(this.withAnyTag,a)),this.withCreatureType!=""&&(a=Or(this.withCreatureType,a)),this.withEnvironment!=""&&(a=Nr(this.withEnvironment,a)),this.withNoTags.length>0&&(a=$r(this.withNoTags,a)),a}}function Gr(){let r=Le();return[{name:"group of raiders",threatLevel:3,groupTemplates:[{name:"raider captain",threatLevel:2,isSentient:!0,archetypes:[V("raider captain",r)],filter:new N(["martial"],[],"humanoid","",["undead"]),minNumber:1,maxNumber:1},{name:"raiders",threatLevel:3,isSentient:!0,archetypes:[V("raider",r)],filter:new N(["martial"],[],"humanoid","",["undead"]),minNumber:3,maxNumber:6}],tags:["bandits"],commonality:5},{name:"group of looters",threatLevel:3,groupTemplates:[{name:"looters",threatLevel:3,isSentient:!0,archetypes:[V("thug",r)],filter:new N(["martial"],[],"humanoid","",["undead"]),minNumber:3,maxNumber:6}],tags:["bandits"],commonality:5},{name:"group of thugs",threatLevel:2,groupTemplates:[{name:"thugs",threatLevel:2,isSentient:!0,archetypes:[V("thug",r)],filter:new N(["martial"],[],"humanoid","",["undead"]),minNumber:2,maxNumber:4}],tags:["bandits"],commonality:5}]}function Ar(){let r=Le();return[{name:"group of cult acolytes",threatLevel:1,groupTemplates:[{name:"cult acolytes",threatLevel:1,isSentient:!0,archetypes:[V("cult acolyte",r)],filter:new N([],["cult","corruptible"],"humanoid","",["undead"]),minNumber:2,maxNumber:4}],tags:["cult"],commonality:50},{name:"group of lesser demons",threatLevel:4,groupTemplates:[{name:"lesser demons",threatLevel:2,isSentient:!1,archetypes:[],filter:new N(["demon"],[],"","",[]),minNumber:2,maxNumber:4}],tags:["cult","demonic"],commonality:1},{name:"cult priest",threatLevel:2,groupTemplates:[{name:"cult priest",threatLevel:2,isSentient:!0,archetypes:[V("cult priest",r)],filter:new N([],["cult","corruptible"],"humanoid","",["undead"]),minNumber:1,maxNumber:1}],tags:["cult"],commonality:20},{name:"cult high priest",threatLevel:5,groupTemplates:[{name:"cult high priest",threatLevel:5,isSentient:!0,archetypes:[V("cult high priest",r)],filter:new N([],["cult","corruptible"],"humanoid","",["undead"]),minNumber:1,maxNumber:1}],tags:["cult"],commonality:15}]}function xt(){return[{name:"swarming insects",threatLevel:3,groupTemplates:[{name:"swarming insects",threatLevel:3,isSentient:!1,archetypes:[],filter:new N(["swarm"],[],"","",[]),minNumber:3,maxNumber:8}],tags:["insects"],commonality:5},{name:"wandering creature",threatLevel:2,groupTemplates:[{name:"wandering creature",threatLevel:3,isSentient:!1,archetypes:[],filter:new N([],[],"","",[]),minNumber:1,maxNumber:1}],tags:["wandering creature"],commonality:40},{name:"group of wandering creatures",threatLevel:4,groupTemplates:[{name:"wandering creatures",threatLevel:3,isSentient:!1,archetypes:[],filter:new N([],[],"","",[]),minNumber:2,maxNumber:4}],tags:["wandering creature"],commonality:30}]}function Mr(){let r=Le();return[{name:"archmage",threatLevel:5,groupTemplates:[{name:"archmage",threatLevel:5,isSentient:!0,archetypes:[V("archmage",r)],filter:new N([],[],"humanoid","",["undead"]),minNumber:1,maxNumber:1}],tags:["mage","magic"],commonality:1},{name:"mage",threatLevel:2,groupTemplates:[{name:"mage",threatLevel:2,isSentient:!0,archetypes:[V("mage",r)],filter:new N([],[],"humanoid","",["skeleton","zombie"]),minNumber:1,maxNumber:1}],tags:["mage","magic"],commonality:5}]}function Ir(){let r=Le();return[{name:"squad of soldiers",threatLevel:1,groupTemplates:[{name:"soldiers",threatLevel:1,isSentient:!0,archetypes:[V("soldier",r)],filter:new N(["martial"],[],"humanoid","",["undead"]),minNumber:2,maxNumber:4}],tags:["martial","soldiers"],commonality:10},{name:"squad of veterans",threatLevel:2,groupTemplates:[{name:"veteran soldiers",threatLevel:2,isSentient:!0,archetypes:[V("veteran soldier",r)],filter:new N(["martial"],[],"humanoid","",["undead"]),minNumber:2,maxNumber:4}],tags:["martial","soldiers"],commonality:5},{name:"captain",threatLevel:4,groupTemplates:[{name:"captain",threatLevel:2,isSentient:!0,archetypes:[V("captain",r)],filter:new N(["martial"],[],"humanoid","",["undead"]),minNumber:1,maxNumber:1},{name:"veteran soldiers",threatLevel:2,isSentient:!0,archetypes:[V("veteran soldier",r)],filter:new N(["martial"],[],"humanoid","",["undead"]),minNumber:2,maxNumber:4}],tags:["martial","soldiers"],commonality:3},{name:"general",threatLevel:5,groupTemplates:[{name:"general",threatLevel:3,isSentient:!0,archetypes:[V("general",r)],filter:new N(["martial"],[],"humanoid","",["undead"]),minNumber:1,maxNumber:1},{name:"captain",threatLevel:2,isSentient:!0,archetypes:[V("captain",r)],filter:new N(["martial"],[],"humanoid","",["undead"]),minNumber:1,maxNumber:2}],tags:["martial","soldiers"],commonality:2}]}function va(){let r=Le();return[{name:"lich",threatLevel:5,groupTemplates:[{name:"lich",threatLevel:5,isSentient:!0,archetypes:[V("lich",r)],filter:new N([],[],"humanoid","",["undead"]),minNumber:1,maxNumber:1}],tags:["undead"],commonality:5},{name:"necromancer",threatLevel:7,groupTemplates:[{name:"necromancer",threatLevel:5,isSentient:!0,archetypes:[V("necromancer",r)],filter:new N([],[],"humanoid","",["undead"]),minNumber:1,maxNumber:1},{name:"skeletons",threatLevel:2,isSentient:!0,archetypes:[V("warrior",r),V("soldier",r),V("guard",r)],filter:new N(["skeleton"],[],"","",[]),minNumber:3,maxNumber:6}],tags:["mage","undead"],commonality:5},{name:"pack of ghouls",threatLevel:5,groupTemplates:[{name:"ghouls",threatLevel:3,isSentient:!1,archetypes:[],filter:new N(["ghoul"],[],"","",[]),minNumber:2,maxNumber:4}],tags:["undead"],commonality:5},{name:"pack of undead",threatLevel:5,groupTemplates:[{name:"undead",threatLevel:3,isSentient:!1,archetypes:[],filter:new N(["undead"],[],"","",["vampire"]),minNumber:2,maxNumber:4}],tags:["undead"],commonality:5},{name:"pack of skeletons",threatLevel:2,groupTemplates:[{name:"skeletons",threatLevel:2,isSentient:!0,archetypes:[V("warrior",r),V("soldier",r),V("guard",r)],filter:new N(["skeleton"],[],"","",[]),minNumber:3,maxNumber:6}],tags:["skeleton","undead"],commonality:10},{name:"pack of zombies",threatLevel:3,groupTemplates:[{name:"zombies",threatLevel:3,isSentient:!0,archetypes:[V("shambler",r),V("sprinter",r)],filter:new N(["zombie"],[],"","",[]),minNumber:3,maxNumber:6}],tags:["zombie","undead"],commonality:10},{name:"vampire",threatLevel:5,groupTemplates:[{name:"vampire",threatLevel:5,isSentient:!0,archetypes:[V("warrior",r)],filter:new N(["vampire"],[],"","",[]),minNumber:1,maxNumber:1}],tags:["vampire","undead"],commonality:2}]}function Dr(){let r=Le();return[{name:"group of hunters",threatLevel:3,groupTemplates:[{name:"hunters",threatLevel:3,isSentient:!0,archetypes:[V("hunter",r)],filter:new N(["martial"],[],"humanoid","",["undead"]),minNumber:3,maxNumber:6}],tags:["hunters"],commonality:5},{name:"lone hunter",threatLevel:1,groupTemplates:[{name:"hunter",threatLevel:1,isSentient:!0,archetypes:[V("hunter",r)],filter:new N(["martial"],[],"humanoid","",["undead"]),minNumber:1,maxNumber:1}],tags:["hunters"],commonality:1},{name:"swarming insects",threatLevel:3,groupTemplates:[{name:"swarming insects",threatLevel:3,isSentient:!1,archetypes:[],filter:new N(["swarm"],[],"","",[]),minNumber:3,maxNumber:8}],tags:["insect swarm"],commonality:5},{name:"wandering creature",threatLevel:3,groupTemplates:[{name:"wandering creature",threatLevel:3,isSentient:!1,archetypes:[],filter:new N([],[],"","",[]),minNumber:1,maxNumber:1}],tags:["wandering creature"],commonality:10},{name:"group of wandering creatures",threatLevel:5,groupTemplates:[{name:"wandering creatures",threatLevel:3,isSentient:!1,archetypes:[],filter:new N([],[],"","",[]),minNumber:2,maxNumber:4}],tags:["wandering creature"],commonality:10}]}function _t(r){let e=[];return e=e.concat(Gr()),e=e.concat(Ar()),e=e.concat(xt()),e=e.concat(Mr()),e=e.concat(Ir()),e=e.concat(Dr()),r&&(e=e.concat(va())),e}function Ke(r,e){return ke(0,r,e)}function ke(r,e,a){let t=[];for(let n=0;n<a.length;n++)a[n].threatLevel>=r&&a[n].threatLevel<=e&&t.push(a[n]);return t}function Je(r,e){return ke(r,r,e)}function Lt(r,e){let a=[];for(let t=0;t<e.length;t++)e[t].tags.includes(r)&&a.push(e[t]);return a}class Ze{name;mainEnvironment;nameGenerator;weakEncounterTemplates;strongEncounterTemplates;bossEncounterTemplates;sentientOptions;flooringOptions;roomThemes;requiredRooms;constructor(e,a,t,n,s,l,i,o,h,c){this.name=e,this.mainEnvironment=a,this.nameGenerator=t,this.weakEncounterTemplates=n,this.strongEncounterTemplates=s,this.bossEncounterTemplates=l,this.sentientOptions=i,this.flooringOptions=o,this.roomThemes=h,this.requiredRooms=c}}class dt{theme;minCount;maxCount;constructor(e,a,t){this.theme=e,this.minCount=a,this.maxCount=t}}function Vr(){let r=_t(!1),e=$e();e=Fe("humanoid",e);let a=S.int(1,3),t=Lt("cult",r),n=Ke(3,t),s=ke(3,4,t),l=Je(5,t),i=new Pe,o=["DEN","DOMAIN","LAIR"],h=["BALEFUL","VILE","DARK","DEMONIC"],c=["BROTHERHOOD","ORDER"];for(let b=0;b<o.length;b++)for(let $=0;$<h.length;$++)for(let R=0;R<c.length;R++)i.patterns.push(`THE ${o[b]} OF THE ${h[$]} ${c[R]}`);let m=bt("corruptible",e);m=We(m,a);const g=Qe();let v=gt("barracks",g),p=gt("altar room",g),f=ge("cult",g),d=ge("dungeon",g);return f=f.concat(d),new Ze("cult","forest",i,n,s,l,m,["stone tile"],f,[new dt(p,1,1),new dt(v,1,1)])}function Sr(){let r=_t(!1),e=$e();e=Fe("humanoid",e);let a=S.int(1,3),t=Lt("martial",r),n=bt("martial",e);n=We(n,a);for(let b=0;b<t.length;b++)t[b].tags.includes("soldiers")&&(t[b].commonality+=20);let s=Ke(3,t),l=ke(3,4,t),i=Je(5,t),o=new Pe,h=["FORTRESS","STRONGHOLD","DOMAIN","DOMINION","LAIR"],c=["DARK","DREAD","DIRE","IRON","BLOODY","CURSED"],m=["LEGION","ARMY"];for(let b=0;b<h.length;b++)for(let $=0;$<c.length;$++)for(let R=0;R<m.length;R++)o.patterns.push(`THE ${h[b]} OF THE ${c[$]} ${m[R]}`);const g=Qe();let v=gt("barracks",g),p=ge("dungeon",g),d=ge("military",g).concat(p);return new Ze("fortress","hill",o,s,l,i,n,["stone tile"],d,[new dt(v,1,2)])}function Hr(){let r=_t(!1),e=$e();e=Fe("humanoid",e);let a=S.int(1,2),t=e;t=We(t,a);let n=Lt("magic",r);n=n.concat(xt());let s=Ke(3,n),l=ke(3,4,n),i=Je(5,n),o=new Pe,h=["LABORATORY","LAIR","DOMAIN","DOMINION"],c=["MAD","DREAD","DARK","CRAZED","RECLUSIVE","DOOMED","CURSED"],m=["ARCHMAGE","SORCERER","WIZARD","WITCH","WARLOCK"];for(let f=0;f<h.length;f++)for(let d=0;d<c.length;d++)for(let b=0;b<m.length;b++)o.patterns.push(`THE ${h[f]} OF THE ${c[d]} ${m[b]}`);const g=Qe(),v=ge("dungeon",g);let p=ge("mage",g);return p=p.concat(v),new Ze("mage lair","forest",o,s,l,i,t,["stone tile","marble"],p,[])}function Yr(){let r=$e();r=Fe("humanoid",r);let e=S.int(1,2),a=bt("martial",r);a=We(a,e);let t=xt();t=t.concat(va());let n=Ke(2,t),s=ke(3,4,t),l=Je(5,t),i=new Pe,o=["TOMB","CRYPT","CATACOMBS","MAUSOLEUM","BARROWS"],h=["THE DAMNED","THE FORGOTTEN","THE LOST","WAKING NIGHTMARES","FORGOTTEN SOULS","LOST SOULS"];for(let v=0;v<o.length;v++)for(let p=0;p<h.length;p++)i.patterns.push(`THE ${o[v]} OF ${h[p]}`);const c=Qe(),m=ge("dungeon",c);let g=ge("tomb",c);return g=g.concat(m),new Ze("tomb","hill",i,n,s,l,a,["stone tile"],g,[])}function qr(){let r=[];return r.push(Vr()),r.push(Sr()),r.push(Hr()),r.push(Yr()),r}class X{commonality;generator;constructor(e,a){this.commonality=e,this.generator=a}}class ue{entries;constructor(e){this.entries=e}}class ba{tables;constructor(){this.tables=[]}}class wa{config;constructor(e){this.config=e}generate(){let e=[];for(const a of this.config.tables){let t=a.entries,l=xe(t).generator.generate();e=e.concat(l)}return e}}class Br{name;description;value;lockId;quality;tags}class Xr{name;description;value;quality;tags;constructor(){this.name="an art object",this.description="an art object",this.value=10,this.quality=2,this.tags=["art object"]}}class pt{minValue;maxValue;count;constructor(e,a,t){this.minValue=e,this.maxValue=a,this.count=t}generate(){let e=[];for(let a=0;a<this.count;a++){let t=new Xr;t.value=S.int(this.minValue,this.maxValue),t.name=Fr(this.minValue,this.maxValue);let n=Ne(t.value,!1,!1,!1);t.description=`${_e(t.name)} ${t.name} worth ${n}`,e.push(t)}return e}}function Fr(r,e){const a=Wr();let t=[];for(let n=0;n<a.length;n++)a[n].value>=r&&a[n].value<=e&&t.push(a[n].name);return y(t)}function Wr(){return[{name:"silver ewer",value:2500},{name:"carved bone statuette",value:2500},{name:"small gold bracelet",value:2500},{name:"cloth-of-gold vestments",value:2500},{name:"black velvet mask stitched with silver thread",value:2500},{name:"copper chalice with silver filigree",value:2500},{name:"pair of engraved bone dice",value:2500},{name:"small mirror set in a painted wood frame",value:2500},{name:"embroidered silk handkerchief",value:2500},{name:"gold locket with a painted portrait inside",value:2500},{name:"gold ring set with bloodstones",value:25e3},{name:"carved ivory statuette",value:25e3},{name:"large gold bracelet",value:25e3},{name:"silver necklace with a gemstone pendant",value:25e3},{name:"bronze crown",value:25e3},{name:"silk robe with gold embroidery",value:25e3},{name:"large well-made tapestry",value:25e3},{name:"brass mug with jade inlay",value:25e3},{name:"box of turquoise animal figurines",value:25e3},{name:"gold bird cage with electrum filigree",value:25e3},{name:"silver chalice set with moonstones",value:75e3},{name:"silver-plated steel longsword with jet set in hilt",value:75e3},{name:"carved harp of exotic wood with ivory inlay and zircon gems",value:75e3},{name:"small gold idol",value:75e3},{name:"gold dragon comb set with red garnets as eyes",value:75e3},{name:"bottle stopper cork embossed with gold leaf and set with amethysts",value:75e3},{name:"ceremonial electrum dagger with a black pearl in the pommel",value:75e3},{name:"silver and gold brooch",value:75e3},{name:"obsidian statuette with gold fittings and inlay",value:75e3},{name:"painted gold war mask",value:75e3},{name:"fine gold chain set with a fire opal",value:25e4},{name:"old masterpiece painting",value:25e4},{name:"embroidered silk and velvet mantle set with numerous moonstones",value:25e4},{name:"platinum bracelet set with a sapphire",value:25e4},{name:"embroidered glove set with jewel chips",value:25e4},{name:"jeweled anklet",value:25e4},{name:"gold music box",value:25e4},{name:"gold circlet set with four aquamarines",value:25e4},{name:"eye patch with a mock eye set in blue sapphire and moonstone",value:25e4},{name:"necklace string of small pink pearls",value:25e4},{name:"jeweled gold crown",value:75e4},{name:"jeweled platinum ring",value:75e4},{name:"small gold stattuete set with rubies",value:75e4},{name:"gold cup set with emeralds",value:75e4},{name:"painted gold child's sarcophagus",value:75e4},{name:"jade game board with solid gold playing pieces",value:75e4},{name:"bejeweled ivory drinking horn with gold filigree",value:75e4}]}class Pr{name;description;value;quality;tags;constructor(){this.name="a bag of coins",this.description="a bag of coins",this.value=10,this.quality=1,this.tags=["bag of coins"]}}class K{cp;sp;ep;gp;pp;constructor(e,a,t,n,s){this.cp=e,this.sp=a,this.ep=t,this.gp=n,this.pp=s}generate(){let e=new Pr,a=0,t=0,n=0,s=0,l=0;this.cp!=""&&(a=te(this.cp)),this.sp!=""&&(t=te(this.sp)),this.ep!=""&&(n=te(this.ep)),this.gp!=""&&(s=te(this.gp)),this.pp!=""&&(l=te(this.pp)),e.value=a+t*10+n*50+s*100+l*1e3;let i=a+t+n+s+l,o=y(["bag","pouch","purse"]);i>1e3?o=y(["chest","large chest"]):i>250?o=y(["chest","satchel"]):i>100&&(o=y(["sack","box"])),e.name=`a ${o} of coins`,e.description="a "+o+" of coins "+y(["containing","holding","with"])+" ";let h=[];return a>0&&h.push(`${new Intl.NumberFormat().format(a)} cp`),t>0&&h.push(`${new Intl.NumberFormat().format(t)} sp`),n>0&&h.push(`${new Intl.NumberFormat().format(n)} ep`),s>0&&h.push(`${new Intl.NumberFormat().format(s)} gp`),l>0&&h.push(`${new Intl.NumberFormat().format(l)} pp`),e.description+=ca(h),[e]}}class Ur{name;description;value;quality;tags;constructor(){this.name="a gem",this.description="a gem",this.value=10,this.quality=2,this.tags=["gem"]}}class Xe{minValue;maxValue;gemCount;constructor(e,a,t){this.minValue=e,this.maxValue=a,this.gemCount=t}generate(){let e=[];for(let a=0;a<this.gemCount;a++){let t=new Ur;t.value=S.int(this.minValue,this.maxValue),t.value<1100?t.name=y(Qr()):t.value<8100?t.name=y(Kr()):t.value<15100?t.name=y(Jr()):t.value<50100?t.name=y(Zr()):t.value<100100?t.name=y(zr()):t.name=y(en());let n=Ne(t.value,!1,!1,!1);t.description=`${_e(t.name)} ${t.name} worth ${n}`,e.push(t)}return e}}function Qr(){return["banded agate","eye agate","moss agate","azurite","blue quartz","hematite","lapis lazuli","malachite","obsidian","rhodochrosite","tiger eye","turquoise","irregular freshwater pearl"]}function Kr(){return["bloodstone","carnelian","chalcedony","chrysoprase","citrine","jasper","moonstone","onyx","quartz","sardonyx","star rose quartz","zircon"]}function Jr(){return["amber","amethyst","chrysoberyl","coral","garnet","jade","jet","pearl","spinel","tourmaline"]}function Zr(){return["alexandrite","aquamarine","black pearl","blue spinel","peridot","topaz"]}function zr(){return["black opal","blue sapphire","emerald","fire opal","opal","star ruby","star sapphire","yellow sapphire"]}function en(){return["black sapphire","diamond","jacinth","ruby"]}class tn{minValue;maxValue;count;constructor(e,a,t){this.minValue=e,this.maxValue=a,this.count=t}generate(){let e=[],a=Xa();for(let t=0;t<this.count;t++){let n=new pa;n.pattern=y(a),n.useMutator=!0,n.minQuality=2,n.maxQuality=5,n.minValue=this.minValue,n.maxValue=this.maxValue;let l=new da(n).generate(),i=Ne(l.value,!1,!1,!1);l.description=`${_e(l.name)} ${l.name} worth ${i}`,e.push(l)}return e}}function an(){return[new ue([new X(30,new K("6d6x100","3d6x100","","2d6x10",""))]),new ue([new X(8,new Xe(900,1e3,te("2d6"))),new X(12,new pt(1500,3500,te("2d4"))),new X(8,new Xe(4500,5e3,te("2d6")))])]}function rn(){return[new ue([new X(30,new K("5d6","","","","")),new X(30,new K("","4d6","","","")),new X(10,new K("","","3d6","","")),new X(25,new K("","","","3d6","")),new X(5,new K("","","","","1d6"))])]}function nn(){return[new ue([new X(30,new K("","","","4d6x1000","5d6x100"))]),new ue([new X(20,new pt(2e4,3e4,te("2d4"))),new X(30,new Xe(45e3,5e4,te("3d6"))),new X(8,new Xe(95e3,1e5,te("3d6"))),new X(10,new pt(7e4,8e4,te("2d4")))]),new ue([new X(5,new tn(1e4,3e4,te("1d6")))])]}function sn(){return[new ue([new X(20,new K("","4d6x100","","1d6x100","")),new X(15,new K("","","1d6x100","1d6x100","")),new X(40,new K("","","","2d6x100","1d6x10")),new X(25,new K("","","","2d6x100","2d6x10"))])]}function ln(){return[new ue([new X(30,new K("4d6x100","","1d6x10","","")),new X(30,new K("","6d6x10","","2d6x10","")),new X(10,new K("","","1d6x100","2d6x10","")),new X(25,new K("","","","4d6x10","")),new X(5,new K("","","","2d6x10","3d6"))])]}class kt{minRoom;maxRoom;treasure;behavior;value;isCarried;isHidden;constructor(){this.minRoom=-1,this.maxRoom=-1,this.value=1,this.treasure=[],this.isCarried=!1,this.isHidden=!1}}function Yt(r){let e=qr(),t={environment:"",name:"",description:"",theme:y(e),rooms:[],doors:[],tiles:[],totalThreatLevel:0,averageThreatLevel:0};t.environment=y(["arctic","coastal","desert","forest","grassland","hill","mountain","urban","underdark"]),t.tiles=bn(r.width,r.height),t.name=t.theme.nameGenerator.generate(1)[0],t=un(t,r.width,r.height);let n=S.int(r.minRooms,r.maxRooms);t=dn(t,n,r.width,r.height);for(let h=0;h<2;h++)t=fr(t);t=hn(t);let s=fn(t),l=[],i=0;for(let h=1;h<t.rooms.length;h++){let c=ae(100),m="none";if(h==t.rooms.length-1?m="boss":c>90?m="strong":c>30&&(m="weak"),m!="none"){let g=mn(t,m,h);l.push(g),i++}}let o=vn(t);return t=cn(t,l),t=gn(t,s),t=pn(t,o),t.averageThreatLevel=Math.floor(t.totalThreatLevel/i),t}function on(){let r=y(Dt()),e=Da();e.climate=r;let a=[];for(let t=0;t<5;t++)e.climate=y(Dt()),a.push(Ia(e));return{width:40,height:50,maxRooms:30,minRooms:20,minThreatLevel:0,maxThreatLevel:5,possibleBiomes:a}}function hn(r){let e=dr(),a=pr("light",e);for(let t=0;t<r.rooms.length;t++)if(ae(100)>60){let n=y(a);r.rooms[t]=n.mutate(r.rooms[t])}return r}function vt(r,e){for(let a=0;a<r.vertices.length;a++)e[r.vertices[a].y][r.vertices[a].x]=yt;return e}function cn(r,e){for(let a=0;a<e.length;a++){let t=e[a].maxRoom;t==-1&&(t=r.rooms.length-1);let n=e[a].minRoom,s=S.int(n,t),l=e[a].encounterConfig,i=Pa(l);if(r.rooms[s].encounters.push(i),r.totalThreatLevel+=i.totalThreatLevel,e[a].treasureSpawns.length>0)for(let o=0;o<e[a].treasureSpawns.length;o++){let h=e[a].treasureSpawns[o];for(let c=0;c<i.groups.length;c++)for(let m=0;m<i.groups[c].mobs.length;m++)ae(100)>50&&i.groups[c].mobs[m].carried.push(y(h.treasure))}}return r}function mn(r,e,a){let t=Ka();t.environment=r.environment,t.sentientOptions=r.theme.sentientOptions;let n=rn();e=="boss"?(t.template=xe(r.theme.bossEncounterTemplates),t.minThreatLevel=3,t.maxThreatLevel=10,n=sn()):e=="strong"?(t.template=xe(r.theme.strongEncounterTemplates),n=ln()):t.template=xe(r.theme.weakEncounterTemplates);let s={minRoom:a,maxRoom:a,encounterConfig:t,treasureSpawns:[]},l=!1;if(s.encounterConfig.template===null)throw new Error("Encounter template is null");for(let m=0;m<s.encounterConfig.template.groupTemplates.length;m++)s.encounterConfig.template.groupTemplates[m].isSentient&&(l=!0);let i=new ba;i.tables=n;let h=new wa(i).generate(),c=new kt;return c.treasure=c.treasure.concat(h),l&&s.treasureSpawns.push(c),s}function un(r,e,a){let t=br();t.flooringOptions=r.theme.flooringOptions;let n=new ga(e,a,t),l=new fa(n).generate();return l.id=0,r.rooms.push(l),r.tiles=vt(l,r.tiles),r}function fn(r){let e=[];for(let a=0;a<r.doors.length;a++)if(r.doors[a].lock!==null){let t=new kt;t.behavior=`This key unlocks the door between room ${r.doors[a].room1+1} and room ${r.doors[a].room2+1} in ${r.name}.`,t.minRoom=0,t.maxRoom=r.doors[a].room1;let n=new Br;n.name="a key";let s=r.doors[a].lock;if(s===null)throw new Error("Door has no lock but expected one");n.lockId=s.id;let l=y([`a ${y(["simple","plain","rough"])} key`,`a ${y(["small","ornate","shiny","tarnished"])} key`]);n.description=`${l} that unlocks the door between room ${r.doors[a].room1+1} and room ${r.doors[a].room2+1}`,n.value=S.int(1,10),t.treasure.push(n),e.push(t)}return e}function gn(r,e){for(let a=0;a<e.length;a++){let t=S.int(e[a].minRoom,e[a].maxRoom);if(r.rooms[t].encounters.length>0){let n=y(r.rooms[t].encounters);y(n.groups[0].mobs).carried.push(e[a].treasure[0])}else r.rooms[t].treasureCaches.push(e[a].treasure[0].description)}return r}function dn(r,e,a,t){let n=0,s=!0,l=0,i=5;for(let o=0;o<r.theme.requiredRooms.length;o++){let h=r.theme.requiredRooms[o],c=S.int(h.minCount,h.maxCount);for(let m=0;m<c;m++){let g=Vt(a,t,h.theme,r.rooms);g===null?console.debug("Room broke",h,r.theme.name):(n+=1,g.id=n,r.rooms.push(g),r.tiles=vt(g,r.tiles))}}for(;s;)if(r.rooms.length>=e)s=!1;else{let o=xe(r.theme.roomThemes);o.environment==r.theme.mainEnvironment&&(o.flooringOptions=r.theme.flooringOptions);let h=Vt(a,t,o,r.rooms);h===null?l++:(n+=1,h.id=n,r.rooms.push(h),r.tiles=vt(h,r.tiles)),l>i&&(s=!1)}return r}function pn(r,e){for(let a=0;a<e.length;a++){let t=e[a].maxRoom;t==-1&&(t=r.rooms.length-1);let n=e[a].minRoom;n==-1&&(n=1);let s=S.int(n,t),l=[];for(const o of e[a].treasure)l.push(o.description);let i=ca(l);if(e[a].isHidden)i+=", hidden somewhere in the room",r.rooms[s].treasureCaches.push(i);else if(e[a].isCarried){let o=y(r.rooms[s].encounters);y(o.groups[0].mobs).carried.push(i)}else{let o=[];for(let h=0;h<r.rooms[s].features.length;h++)r.rooms[s].features[h].isContainer&&o.push(h);o.length>0&&ae(100)>10&&(i+=", inside "+r.rooms[s].features[y(o)].name),r.rooms[s].treasureCaches.push(i)}}return r}function vn(r){let e=100,a=[],t=an(),n=nn();for(let s=1;s<r.rooms.length;s++)if(ae(100)>e){let l=new ba;l.tables=t,s==r.rooms.length-1&&(l.tables=n);let o=new wa(l).generate(),h=new kt;h.treasure=h.treasure.concat(o),a.push(h),e=100}else e-=2;return a}function bn(r,e){let a=[];for(let t=0;t<e;t++){let n=[];a[t]=n;for(let s=0;s<r;s++)a[t][s]=ut}return a}class wn{tileSize;mapHeight;mapWidth;imageWidth;imageHeight;constructor(e,a,t,n){this.imageWidth=e,this.imageHeight=a,this.mapHeight=t,this.mapWidth=n,this.tileSize=e/n}render(e,a){const t=a.getContext("2d");if(t==null)throw new Error("Could not get 2d context from canvas");t.fillStyle="white",t.fillRect(0,0,this.imageWidth,this.imageHeight);for(let n=0;n<this.mapHeight;n++)for(let s=0;s<this.mapWidth;s++){let l=e.tiles[n][s];l==ft?yn(t,s,n,this.tileSize):l==Tt?Ln(t,s,n,this.tileSize):l==yt?_n(t,s,n,this.tileSize):l==ua?Tn(t,s,n,this.tileSize):l==ma?kn(t,s,n,this.tileSize):xn(t,s,n,this.tileSize)}for(let n=0;n<e.rooms.length;n++){let s=e.rooms[n].minX*this.tileSize+(e.rooms[n].maxX-e.rooms[n].minX)*this.tileSize/2+this.tileSize*.25,l=e.rooms[n].minY*this.tileSize+(e.rooms[n].maxY-e.rooms[n].minY)*this.tileSize/2+this.tileSize*.8;t.beginPath(),t.strokeStyle="#5698DA",t.fillStyle="#5698DA",t.font="20px Eczar",t.fillText(`${e.rooms[n].id+1}`,s,l),t.strokeText(`${e.rooms[n].id+1}`,s,l)}}}function Ge(r,e,a,t){let n=e*t,s=a*t;r.fillRect(n,s,t,t),r.strokeStyle="#85BBF1",r.strokeRect(n,s,t,t)}function yn(r,e,a,t){r.fillStyle="white",r.fillRect(e*t,a*t,t,t),Ge(r,e,a,t),r.beginPath(),r.strokeStyle="#85BBF1";let n={x:e*t+t/2,y:a*t},s={x:e*t+t/2,y:a*t+t};r.moveTo(n.x,n.y),r.lineTo(s.x,s.y),r.stroke(),r.fillRect(e*t+t*.35,a*t+t*.2,t*.3,t*.6),r.strokeRect(e*t+t*.35,a*t+t*.2,t*.3,t*.6)}function Tn(r,e,a,t){r.fillStyle="white",r.fillRect(e*t,a*t,t,t),Ge(r,e,a,t),r.beginPath(),r.strokeStyle="#85BBF1";let n={x:e*t+t/2,y:a*t},s={x:e*t+t/2,y:a*t+t};r.moveTo(n.x,n.y),r.lineTo(s.x,s.y),r.stroke(),r.fillStyle="#85BBF1",r.font="12px sans-serif",r.fillText("S",e*t+t/3.5,a*t+t/1.3)}function xn(r,e,a,t){r.fillStyle="#A4CFF9";let n=e*t,s=a*t;r.fillRect(n,s,t,t)}function _n(r,e,a,t){r.fillStyle="white";let n=e*t,s=a*t;r.fillRect(n,s,t,t),Ge(r,e,a,t)}function Ln(r,e,a,t){r.fillStyle="white",r.fillRect(e*t,a*t,t,t),Ge(r,e,a,t),r.beginPath(),r.strokeStyle="#85BBF1";let n={x:e*t,y:a*t+t/2},s={x:e*t+t,y:a*t+t/2};r.moveTo(n.x,n.y),r.lineTo(s.x,s.y),r.stroke(),r.fillRect(e*t+t*.2,a*t+t*.35,t*.6,t*.3),r.strokeRect(e*t+t*.2,a*t+t*.35,t*.6,t*.3)}function kn(r,e,a,t){r.fillStyle="white",r.fillRect(e*t,a*t,t,t),Ge(r,e,a,t),r.beginPath(),r.strokeStyle="#85BBF1";let n={x:e*t,y:a*t+t/2},s={x:e*t+t,y:a*t+t/2};r.moveTo(n.x,n.y),r.lineTo(s.x,s.y),r.stroke(),r.save(),r.translate(e*t+t/2,a*t+t/2),r.rotate(90*Math.PI/180),r.fillStyle="#85BBF1",r.font="12px sans-serif",r.fillText("S",-r.measureText("S").width/2,4),r.restore()}const{document:qt}=Ca;function Bt(r,e,a){const t=r.slice();return t[12]=e[a],t}function Xt(r,e,a){const t=r.slice();return t[15]=e[a],t}function Ft(r,e,a){const t=r.slice();return t[18]=e[a],t}function Wt(r,e,a){const t=r.slice();return t[21]=e[a],t}function Pt(r,e,a){const t=r.slice();return t[24]=e[a],t}function Ut(r,e,a){const t=r.slice();return t[27]=e[a],t}function Qt(r,e,a){const t=r.slice();return t[30]=e[a],t}function Kt(r,e,a){const t=r.slice();return t[33]=e[a],t}function Jt(r){let e,a="This room is dark.";return{c(){e=k("p"),e.textContent=a,this.h()},l(t){e=C(t,"P",{class:!0,"data-svelte-h":!0}),z(e)!=="svelte-94wbjp"&&(e.textContent=a),this.h()},h(){w(e,"class","svelte-jl2xcj")},m(t,n){B(t,e,n)},d(t){t&&T(e)}}}function Zt(r){let e=r[33].description+" ",a;return{c(){a=M(e)},l(t){a=I(t,e)},m(t,n){B(t,a,n)},p(t,n){n[0]&8&&e!==(e=t[33].description+" ")&&P(a,e)},d(t){t&&T(a)}}}function zt(r){let e,a=r[12].secrets+"",t;return{c(){e=k("div"),t=M(a),this.h()},l(n){e=C(n,"DIV",{class:!0});var s=Y(e);t=I(s,a),s.forEach(T),this.h()},h(){w(e,"class","room-secrets svelte-jl2xcj")},m(n,s){B(n,e,s),u(e,t)},p(n,s){s[0]&8&&a!==(a=n[12].secrets+"")&&P(t,a)},d(n){n&&T(e)}}}function Cn(r){let e,a=_e(r[21].name)+"",t;return{c(){e=M("is "),t=M(a)},l(n){e=I(n,"is "),t=I(n,a)},m(n,s){B(n,e,s),B(n,t,s)},p(n,s){s[0]&8&&a!==(a=_e(n[21].name)+"")&&P(t,a)},d(n){n&&(T(e),T(t))}}}function Rn(r){let e,a=r[21].mobs.length+"",t;return{c(){e=M("are "),t=M(a)},l(n){e=I(n,"are "),t=I(n,a)},m(n,s){B(n,e,s),B(n,t,s)},p(n,s){s[0]&8&&a!==(a=n[21].mobs.length+"")&&P(t,a)},d(n){n&&(T(e),T(t))}}}function ea(r){let e,a="Abilities:",t,n,s=J(r[24].abilities),l=[];for(let i=0;i<s.length;i+=1)l[i]=ta(Qt(r,s,i));return{c(){e=k("p"),e.textContent=a,t=j(),n=k("ul");for(let i=0;i<l.length;i+=1)l[i].c();this.h()},l(i){e=C(i,"P",{class:!0,"data-svelte-h":!0}),z(e)!=="svelte-rzkllc"&&(e.textContent=a),t=E(i),n=C(i,"UL",{class:!0});var o=Y(n);for(let h=0;h<l.length;h+=1)l[h].l(o);o.forEach(T),this.h()},h(){w(e,"class","svelte-jl2xcj"),w(n,"class","svelte-jl2xcj")},m(i,o){B(i,e,o),B(i,t,o),B(i,n,o);for(let h=0;h<l.length;h+=1)l[h]&&l[h].m(n,null)},p(i,o){if(o[0]&8){s=J(i[24].abilities);let h;for(h=0;h<s.length;h+=1){const c=Qt(i,s,h);l[h]?l[h].p(c,o):(l[h]=ta(c),l[h].c(),l[h].m(n,null))}for(;h<l.length;h+=1)l[h].d(1);l.length=s.length}},d(i){i&&(T(e),T(t),T(n)),fe(l,i)}}}function ta(r){let e,a,t=r[30].name+"",n,s,l,i=r[30].description+"",o;return{c(){e=k("li"),a=k("strong"),n=M(t),s=M(":"),l=j(),o=M(i),this.h()},l(h){e=C(h,"LI",{class:!0});var c=Y(e);a=C(c,"STRONG",{class:!0});var m=Y(a);n=I(m,t),s=I(m,":"),m.forEach(T),l=E(c),o=I(c,i),c.forEach(T),this.h()},h(){w(a,"class","svelte-jl2xcj"),w(e,"class","svelte-jl2xcj")},m(h,c){B(h,e,c),u(e,a),u(a,n),u(a,s),u(e,l),u(e,o)},p(h,c){c[0]&8&&t!==(t=h[30].name+"")&&P(n,t),c[0]&8&&i!==(i=h[30].description+"")&&P(o,i)},d(h){h&&T(e)}}}function aa(r){let e,a="Carrying the following:",t,n,s=J(r[24].carried),l=[];for(let i=0;i<s.length;i+=1)l[i]=ra(Ut(r,s,i));return{c(){e=k("p"),e.textContent=a,t=j(),n=k("ul");for(let i=0;i<l.length;i+=1)l[i].c();this.h()},l(i){e=C(i,"P",{class:!0,"data-svelte-h":!0}),z(e)!=="svelte-z9itxp"&&(e.textContent=a),t=E(i),n=C(i,"UL",{class:!0});var o=Y(n);for(let h=0;h<l.length;h+=1)l[h].l(o);o.forEach(T),this.h()},h(){w(e,"class","svelte-jl2xcj"),w(n,"class","svelte-jl2xcj")},m(i,o){B(i,e,o),B(i,t,o),B(i,n,o);for(let h=0;h<l.length;h+=1)l[h]&&l[h].m(n,null)},p(i,o){if(o[0]&8){s=J(i[24].carried);let h;for(h=0;h<s.length;h+=1){const c=Ut(i,s,h);l[h]?l[h].p(c,o):(l[h]=ra(c),l[h].c(),l[h].m(n,null))}for(;h<l.length;h+=1)l[h].d(1);l.length=s.length}},d(i){i&&(T(e),T(t),T(n)),fe(l,i)}}}function ra(r){let e,a=r[27].description+"",t,n,s=Ne(r[27].value,!1,!1,!1)+"",l;return{c(){e=k("li"),t=M(a),n=M(", worth "),l=M(s),this.h()},l(i){e=C(i,"LI",{class:!0});var o=Y(e);t=I(o,a),n=I(o,", worth "),l=I(o,s),o.forEach(T),this.h()},h(){w(e,"class","svelte-jl2xcj")},m(i,o){B(i,e,o),u(e,t),u(e,n),u(e,l)},p(i,o){o[0]&8&&a!==(a=i[27].description+"")&&P(t,a),o[0]&8&&s!==(s=Ne(i[27].value,!1,!1,!1)+"")&&P(l,s)},d(i){i&&T(e)}}}function na(r){let e,a,t=r[24].name+"",n,s,l=r[24].summary+"",i,o,h=r[24].threatLevel+"",c,m,g,v,p=r[24].abilities.length>0&&ea(r),f=r[24].carried.length>0&&aa(r);return{c(){e=k("div"),a=k("h4"),n=M(t),s=M(", "),i=M(l),o=M(" (TL "),c=M(h),m=M(")"),g=j(),p&&p.c(),v=j(),f&&f.c(),this.h()},l(d){e=C(d,"DIV",{class:!0});var b=Y(e);a=C(b,"H4",{class:!0});var $=Y(a);n=I($,t),s=I($,", "),i=I($,l),o=I($," (TL "),c=I($,h),m=I($,")"),$.forEach(T),g=E(b),p&&p.l(b),v=E(b),f&&f.l(b),b.forEach(T),this.h()},h(){w(a,"class","svelte-jl2xcj"),w(e,"class","mob svelte-jl2xcj")},m(d,b){B(d,e,b),u(e,a),u(a,n),u(a,s),u(a,i),u(a,o),u(a,c),u(a,m),u(e,g),p&&p.m(e,null),u(e,v),f&&f.m(e,null)},p(d,b){b[0]&8&&t!==(t=d[24].name+"")&&P(n,t),b[0]&8&&l!==(l=d[24].summary+"")&&P(i,l),b[0]&8&&h!==(h=d[24].threatLevel+"")&&P(c,h),d[24].abilities.length>0?p?p.p(d,b):(p=ea(d),p.c(),p.m(e,v)):p&&(p.d(1),p=null),d[24].carried.length>0?f?f.p(d,b):(f=aa(d),f.c(),f.m(e,null)):f&&(f.d(1),f=null)},d(d){d&&T(e),p&&p.d(),f&&f.d()}}}function sa(r){let e,a,t,n=r[21].name+"",s,l,i,o,h;function c(f,d){return f[21].mobs.length>1?Rn:Cn}let m=c(r),g=m(r),v=J(r[21].mobs),p=[];for(let f=0;f<v.length;f+=1)p[f]=na(Pt(r,v,f));return{c(){e=k("p"),a=M("There "),g.c(),t=j(),s=M(n),l=M(" here."),i=j(),o=k("div");for(let f=0;f<p.length;f+=1)p[f].c();h=j(),this.h()},l(f){e=C(f,"P",{class:!0});var d=Y(e);a=I(d,"There "),g.l(d),t=E(d),s=I(d,n),l=I(d," here."),d.forEach(T),i=E(f),o=C(f,"DIV",{class:!0});var b=Y(o);for(let $=0;$<p.length;$+=1)p[$].l(b);h=E(b),b.forEach(T),this.h()},h(){w(e,"class","svelte-jl2xcj"),w(o,"class","mobs svelte-jl2xcj")},m(f,d){B(f,e,d),u(e,a),g.m(e,null),u(e,t),u(e,s),u(e,l),B(f,i,d),B(f,o,d);for(let b=0;b<p.length;b+=1)p[b]&&p[b].m(o,null);u(o,h)},p(f,d){if(m===(m=c(f))&&g?g.p(f,d):(g.d(1),g=m(f),g&&(g.c(),g.m(e,t))),d[0]&8&&n!==(n=f[21].name+"")&&P(s,n),d[0]&8){v=J(f[21].mobs);let b;for(b=0;b<v.length;b+=1){const $=Pt(f,v,b);p[b]?p[b].p($,d):(p[b]=na($),p[b].c(),p[b].m(o,h))}for(;b<p.length;b+=1)p[b].d(1);p.length=v.length}},d(f){f&&(T(e),T(i),T(o)),g.d(),fe(p,f)}}}function la(r){let e,a=J(r[18].groups),t=[];for(let n=0;n<a.length;n+=1)t[n]=sa(Wt(r,a,n));return{c(){for(let n=0;n<t.length;n+=1)t[n].c();e=$t()},l(n){for(let s=0;s<t.length;s+=1)t[s].l(n);e=$t()},m(n,s){for(let l=0;l<t.length;l+=1)t[l]&&t[l].m(n,s);B(n,e,s)},p(n,s){if(s[0]&8){a=J(n[18].groups);let l;for(l=0;l<a.length;l+=1){const i=Wt(n,a,l);t[l]?t[l].p(i,s):(t[l]=sa(i),t[l].c(),t[l].m(e.parentNode,e))}for(;l<t.length;l+=1)t[l].d(1);t.length=a.length}},d(n){n&&T(e),fe(t,n)}}}function ia(r){let e,a,t="Treasure",n,s,l=J(r[12].treasureCaches),i=[];for(let o=0;o<l.length;o+=1)i[o]=oa(Xt(r,l,o));return{c(){e=k("div"),a=k("h4"),a.textContent=t,n=j(),s=k("ul");for(let o=0;o<i.length;o+=1)i[o].c();this.h()},l(o){e=C(o,"DIV",{class:!0});var h=Y(e);a=C(h,"H4",{class:!0,"data-svelte-h":!0}),z(a)!=="svelte-1y7msnj"&&(a.textContent=t),n=E(h),s=C(h,"UL",{class:!0});var c=Y(s);for(let m=0;m<i.length;m+=1)i[m].l(c);c.forEach(T),h.forEach(T),this.h()},h(){w(a,"class","svelte-jl2xcj"),w(s,"class","svelte-jl2xcj"),w(e,"class","treasure svelte-jl2xcj")},m(o,h){B(o,e,h),u(e,a),u(e,n),u(e,s);for(let c=0;c<i.length;c+=1)i[c]&&i[c].m(s,null)},p(o,h){if(h[0]&8){l=J(o[12].treasureCaches);let c;for(c=0;c<l.length;c+=1){const m=Xt(o,l,c);i[c]?i[c].p(m,h):(i[c]=oa(m),i[c].c(),i[c].m(s,null))}for(;c<i.length;c+=1)i[c].d(1);i.length=l.length}},d(o){o&&T(e),fe(i,o)}}}function oa(r){let e,a=r[15]+"",t;return{c(){e=k("li"),t=M(a),this.h()},l(n){e=C(n,"LI",{class:!0});var s=Y(e);t=I(s,a),s.forEach(T),this.h()},h(){w(e,"class","svelte-jl2xcj")},m(n,s){B(n,e,s),u(e,t)},p(n,s){s[0]&8&&a!==(a=n[15]+"")&&P(t,a)},d(n){n&&T(e)}}}function ha(r){let e,a,t=r[12].id+1+"",n,s,l=Gt(r[12].name)+"",i,o,h,c,m=r[12].description+"",g,v,p,f,d,b,$,R=r[12].lightLevel==0&&Jt(),se=J(r[12].features),H=[];for(let x=0;x<se.length;x+=1)H[x]=Zt(Kt(r,se,x));let q=r[12].secrets!=""&&zt(r),ie=J(r[12].encounters),F=[];for(let x=0;x<ie.length;x+=1)F[x]=la(Ft(r,ie,x));let D=r[12].treasureCaches.length>0&&ia(r);return{c(){e=k("div"),a=k("h3"),n=M(t),s=M(". "),i=M(l),o=j(),R&&R.c(),h=j(),c=k("div"),g=M(m),v=j();for(let x=0;x<H.length;x+=1)H[x].c();p=j(),q&&q.c(),f=j(),d=k("div");for(let x=0;x<F.length;x+=1)F[x].c();b=j(),D&&D.c(),$=j(),this.h()},l(x){e=C(x,"DIV",{class:!0});var O=Y(e);a=C(O,"H3",{class:!0});var L=Y(a);n=I(L,t),s=I(L,". "),i=I(L,l),L.forEach(T),o=E(O),R&&R.l(O),h=E(O),c=C(O,"DIV",{class:!0});var Z=Y(c);g=I(Z,m),v=E(Z);for(let le=0;le<H.length;le+=1)H[le].l(Z);Z.forEach(T),p=E(O),q&&q.l(O),f=E(O),d=C(O,"DIV",{class:!0});var ne=Y(d);for(let le=0;le<F.length;le+=1)F[le].l(ne);ne.forEach(T),b=E(O),D&&D.l(O),$=E(O),O.forEach(T),this.h()},h(){w(a,"class","svelte-jl2xcj"),w(c,"class","room-description svelte-jl2xcj"),w(d,"class","encounter svelte-jl2xcj"),w(e,"class","room svelte-jl2xcj")},m(x,O){B(x,e,O),u(e,a),u(a,n),u(a,s),u(a,i),u(e,o),R&&R.m(e,null),u(e,h),u(e,c),u(c,g),u(c,v);for(let L=0;L<H.length;L+=1)H[L]&&H[L].m(c,null);u(e,p),q&&q.m(e,null),u(e,f),u(e,d);for(let L=0;L<F.length;L+=1)F[L]&&F[L].m(d,null);u(e,b),D&&D.m(e,null),u(e,$)},p(x,O){if(O[0]&8&&t!==(t=x[12].id+1+"")&&P(n,t),O[0]&8&&l!==(l=Gt(x[12].name)+"")&&P(i,l),x[12].lightLevel==0?R||(R=Jt(),R.c(),R.m(e,h)):R&&(R.d(1),R=null),O[0]&8&&m!==(m=x[12].description+"")&&P(g,m),O[0]&8){se=J(x[12].features);let L;for(L=0;L<se.length;L+=1){const Z=Kt(x,se,L);H[L]?H[L].p(Z,O):(H[L]=Zt(Z),H[L].c(),H[L].m(c,null))}for(;L<H.length;L+=1)H[L].d(1);H.length=se.length}if(x[12].secrets!=""?q?q.p(x,O):(q=zt(x),q.c(),q.m(e,f)):q&&(q.d(1),q=null),O[0]&8){ie=J(x[12].encounters);let L;for(L=0;L<ie.length;L+=1){const Z=Ft(x,ie,L);F[L]?F[L].p(Z,O):(F[L]=la(Z),F[L].c(),F[L].m(d,null))}for(;L<F.length;L+=1)F[L].d(1);F.length=ie.length}x[12].treasureCaches.length>0?D?D.p(x,O):(D=ia(x),D.c(),D.m(e,$)):D&&(D.d(1),D=null)},d(x){x&&T(e),R&&R.d(),fe(H,x),q&&q.d(),fe(F,x),D&&D.d()}}}function jn(r){let e,a,t,n="Dungeon Generator",s,l,i="A dungeon generator.",o,h,c,m="Random Seed",g,v,p,f,d,b="Min. Rooms",$,R,se,H,q,ie="Max. Rooms",F,D,x,O,L="Generate From Seed",Z,ne,le="Random Seed (and Generate)",ze,we,Ce=r[3].name+"",Ae,et,oe,de,Ct="Environment:",tt,Re=r[3].environment+"",Me,at,he,pe,Rt="Total Threat Level:",rt,je=r[3].totalThreatLevel+"",Ie,nt,ce,ve,jt="Average Threat Level:",st,Ee=r[3].averageThreatLevel+"",De,lt,me,it,ot,Et,ye=J(r[3].rooms),U=[];for(let G=0;G<ye.length;G+=1)U[G]=ha(Bt(r,ye,G));return{c(){e=j(),a=k("section"),t=k("h1"),t.textContent=n,s=j(),l=k("p"),l.textContent=i,o=j(),h=k("div"),c=k("label"),c.textContent=m,g=j(),v=k("input"),p=j(),f=k("div"),d=k("label"),d.textContent=b,$=j(),R=k("input"),se=j(),H=k("div"),q=k("label"),q.textContent=ie,F=j(),D=k("input"),x=j(),O=k("button"),O.textContent=L,Z=j(),ne=k("button"),ne.textContent=le,ze=j(),we=k("h2"),Ae=M(Ce),et=j(),oe=k("p"),de=k("strong"),de.textContent=Ct,tt=j(),Me=M(Re),at=j(),he=k("p"),pe=k("strong"),pe.textContent=Rt,rt=j(),Ie=M(je),nt=j(),ce=k("p"),ve=k("strong"),ve.textContent=jt,st=j(),De=M(Ee),lt=j(),me=k("canvas"),it=j();for(let G=0;G<U.length;G+=1)U[G].c();this.h()},l(G){ka("svelte-negoxg",qt.head).forEach(T),e=E(G),a=C(G,"SECTION",{class:!0});var _=Y(a);t=C(_,"H1",{class:!0,"data-svelte-h":!0}),z(t)!=="svelte-ouv5ej"&&(t.textContent=n),s=E(_),l=C(_,"P",{class:!0,"data-svelte-h":!0}),z(l)!=="svelte-ma8c12"&&(l.textContent=i),o=E(_),h=C(_,"DIV",{class:!0});var be=Y(h);c=C(be,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),z(c)!=="svelte-1akft3f"&&(c.textContent=m),g=E(be),v=C(be,"INPUT",{type:!0,name:!0,id:!0,class:!0}),be.forEach(T),p=E(_),f=C(_,"DIV",{class:!0});var Ve=Y(f);d=C(Ve,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),z(d)!=="svelte-1oarxv4"&&(d.textContent=b),$=E(Ve),R=C(Ve,"INPUT",{type:!0,name:!0,id:!0,class:!0}),Ve.forEach(T),se=E(_),H=C(_,"DIV",{class:!0});var Se=Y(H);q=C(Se,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),z(q)!=="svelte-fugdp8"&&(q.textContent=ie),F=E(Se),D=C(Se,"INPUT",{type:!0,name:!0,id:!0,class:!0}),Se.forEach(T),x=E(_),O=C(_,"BUTTON",{class:!0,"data-svelte-h":!0}),z(O)!=="svelte-1u7zbd5"&&(O.textContent=L),Z=E(_),ne=C(_,"BUTTON",{class:!0,"data-svelte-h":!0}),z(ne)!=="svelte-192mxrq"&&(ne.textContent=le),ze=E(_),we=C(_,"H2",{class:!0});var Ot=Y(we);Ae=I(Ot,Ce),Ot.forEach(T),et=E(_),oe=C(_,"P",{class:!0});var He=Y(oe);de=C(He,"STRONG",{class:!0,"data-svelte-h":!0}),z(de)!=="svelte-1kamiyt"&&(de.textContent=Ct),tt=E(He),Me=I(He,Re),He.forEach(T),at=E(_),he=C(_,"P",{class:!0});var Ye=Y(he);pe=C(Ye,"STRONG",{class:!0,"data-svelte-h":!0}),z(pe)!=="svelte-1cj036k"&&(pe.textContent=Rt),rt=E(Ye),Ie=I(Ye,je),Ye.forEach(T),nt=E(_),ce=C(_,"P",{class:!0});var qe=Y(ce);ve=C(qe,"STRONG",{class:!0,"data-svelte-h":!0}),z(ve)!=="svelte-1ejia3j"&&(ve.textContent=jt),st=E(qe),De=I(qe,Ee),qe.forEach(T),lt=E(_),me=C(_,"CANVAS",{id:!0,width:!0,height:!0,class:!0}),Y(me).forEach(T),it=E(_);for(let ht=0;ht<U.length;ht+=1)U[ht].l(_);_.forEach(T),this.h()},h(){qt.title="Dungeon Generator | Iron Arachne",w(t,"class","svelte-jl2xcj"),w(l,"class","svelte-jl2xcj"),w(c,"for","seed"),w(c,"class","svelte-jl2xcj"),w(v,"type","text"),w(v,"name","seed"),w(v,"id","seed"),w(v,"class","svelte-jl2xcj"),w(h,"class","input-group svelte-jl2xcj"),w(d,"for","minRooms"),w(d,"class","svelte-jl2xcj"),w(R,"type","number"),w(R,"name","minRooms"),w(R,"id","minRooms"),w(R,"class","svelte-jl2xcj"),w(f,"class","input-group svelte-jl2xcj"),w(q,"for","maxRooms"),w(q,"class","svelte-jl2xcj"),w(D,"type","number"),w(D,"name","maxRooms"),w(D,"id","maxRooms"),w(D,"class","svelte-jl2xcj"),w(H,"class","input-group svelte-jl2xcj"),w(O,"class","svelte-jl2xcj"),w(ne,"class","svelte-jl2xcj"),w(we,"class","svelte-jl2xcj"),w(de,"class","svelte-jl2xcj"),w(oe,"class","svelte-jl2xcj"),w(pe,"class","svelte-jl2xcj"),w(he,"class","svelte-jl2xcj"),w(ve,"class","svelte-jl2xcj"),w(ce,"class","svelte-jl2xcj"),w(me,"id","mapCanvas"),w(me,"width","800"),w(me,"height","1000"),w(me,"class","svelte-jl2xcj"),w(a,"class","fantasy main svelte-jl2xcj")},m(G,ee){B(G,e,ee),B(G,a,ee),u(a,t),u(a,s),u(a,l),u(a,o),u(a,h),u(h,c),u(h,g),u(h,v),Te(v,r[0]),u(a,p),u(a,f),u(f,d),u(f,$),u(f,R),Te(R,r[1]),u(a,se),u(a,H),u(H,q),u(H,F),u(H,D),Te(D,r[2]),u(a,x),u(a,O),u(a,Z),u(a,ne),u(a,ze),u(a,we),u(we,Ae),u(a,et),u(a,oe),u(oe,de),u(oe,tt),u(oe,Me),u(a,at),u(a,he),u(he,pe),u(he,rt),u(he,Ie),u(a,nt),u(a,ce),u(ce,ve),u(ce,st),u(ce,De),u(a,lt),u(a,me),u(a,it);for(let _=0;_<U.length;_+=1)U[_]&&U[_].m(a,null);ot||(Et=[Oe(v,"input",r[6]),Oe(R,"input",r[7]),Oe(D,"input",r[8]),Oe(O,"click",r[4]),Oe(ne,"click",r[5])],ot=!0)},p(G,ee){if(ee[0]&1&&v.value!==G[0]&&Te(v,G[0]),ee[0]&2&&Be(R.value)!==G[1]&&Te(R,G[1]),ee[0]&4&&Be(D.value)!==G[2]&&Te(D,G[2]),ee[0]&8&&Ce!==(Ce=G[3].name+"")&&P(Ae,Ce),ee[0]&8&&Re!==(Re=G[3].environment+"")&&P(Me,Re),ee[0]&8&&je!==(je=G[3].totalThreatLevel+"")&&P(Ie,je),ee[0]&8&&Ee!==(Ee=G[3].averageThreatLevel+"")&&P(De,Ee),ee[0]&8){ye=J(G[3].rooms);let _;for(_=0;_<ye.length;_+=1){const be=Bt(G,ye,_);U[_]?U[_].p(be,ee):(U[_]=ha(be),U[_].c(),U[_].m(a,null))}for(;_<U.length;_+=1)U[_].d(1);U.length=ye.length}},i:Nt,o:Nt,d(G){G&&(T(e),T(a)),fe(U,G),ot=!1,Ta(Et)}}}function En(r,e,a){let t=ct(13),n,s=20,l=30,i=on();i.minRooms=s,i.maxRooms=l;let o=Yt(i),h=new wn(800,1e3,i.height,i.width);function c(){S.use(Ra(t)),i.minRooms=s,i.maxRooms=l,a(3,o=Yt(i)),h.render(o,n)}function m(){a(0,t=ct(13)),c()}xa(()=>{n=document.getElementById("mapCanvas"),m()});function g(){t=this.value,a(0,t)}function v(){s=Be(this.value),a(1,s)}function p(){l=Be(this.value),a(2,l)}return[t,s,l,o,c,m,g,v,p]}class Xn extends _a{constructor(e){super(),La(this,e,En,jn,ya,{},null,[-1,-1])}}export{Xn as component};
//# sourceMappingURL=10.smDMShj6.js.map

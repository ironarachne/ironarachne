var En=Object.defineProperty;var $n=(t,e,n)=>e in t?En(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var o=(t,e,n)=>($n(t,typeof e!="symbol"?e+"":e,n),n);import{s as On,n as Vt,r as Gn,o as Ln}from"../chunks/scheduler.db8c6f43.js";import{S as An,i as Dn,s as G,g as C,m as Y,z as Mn,f as _,c as L,h as E,j as U,x as ae,n as F,k as y,a as Q,y as f,D as Ce,C as Ie,G as Ke,o as z,A as ve,e as Ht}from"../chunks/index.776ff577.js";import{g as In}from"../chunks/globals.7f7f1b26.js";import{e as se}from"../chunks/each.e59479a4.js";import{v as Ve}from"../chunks/currency.57f82600.js";import{i as k,a as oe,r as wt,w as Ne}from"../chunks/index.c74e36a8.js";import{c as bt,b as Ee,a as wn,t as qt}from"../chunks/index.8e2b09a8.js";import{r as K}from"../chunks/random.5c9619ef.js";import{s as Nn}from"../chunks/index.d820e4cb.js";import{r as Bt,B as Vn,a as Hn}from"../chunks/climates.96c9ab4f.js";import{l as $e}from"../chunks/lodash.bdb9e94d.js";import{a as He,C as qn}from"../chunks/fantasy.215bf1b8.js";import{g as Bn}from"../chunks/premadeconfigs.98ffdca2.js";import{g as Yt,a as Ft,b as Xt,w as Je,c as jt,r as ze}from"../chunks/common.522ae1dc.js";import{G as et}from"../chunks/generic.55332f48.js";import{M as Yn,w as Fn,a as Xn,b as Wn,c as Pn,f as Un,d as Qn}from"../chunks/patterns.b5805ddf.js";import{r as ie}from"../chunks/dice.e9c7ebe7.js";class Sn{constructor(e,n,s,r){o(this,"name");o(this,"mutate");o(this,"requiredTag");o(this,"tags");this.name=e,this.mutate=n,this.requiredTag=s,this.tags=r}}function Kn(){let t=[{element:"fire",damage:"+1d6 fire",description:"The blade is wreathed in flame when wielded. Anything flammable struck with it immediately ignites."},{element:"ice",damage:"+1d6 cold",description:"The blade is surrounded by a layer of ice when wielded. Enemies struck with it are chilled to the bone and have difficulty moving."},{element:"lightning",damage:"+1d6 electricity",description:"The blade is surrounded by crackling lightning when wielded."},{element:"poison",damage:"+1d6 poison",description:"The blade is coated in a sickly green liquid when wielded. The liquid is highly poisonous, causing illness and eventually death if not cured."},{element:"acid",damage:"+1d6 acid",description:"The blade is coated in a thin yellow acid when wielded."},{element:"darkness",damage:"+1d6 darkness",description:"The blade is hidden in shadow when wielded. It is difficult for enemies to predict where attacks with this weapon will come from."},{element:"light",damage:"+1d6 light",description:"The blade glows faintly when wielded. On command, that light glows brightly enough to illuminate a large room."},{element:"earth",damage:"+1d6 earth",description:"The blade appears to be made of stone. Anything struck with it is turned to stone."}],e=[];for(let n of t)e.push(new Sn(`${n.element}-enchanted melee weapon`,s=>(s.name=`${n.element}-enchanted ${s.name}`,s instanceof Yn&&(s.damage+=` ${n.damage}`),s.description+=` ${n.description}`,s.value+=1e4,s),"bladed weapon",["weapon","melee weapon","bladed weapon","enchantment",n.element]));return e}function Zn(){let t=[];return t=t.concat(Kn()),t}function Jn(t,e){let n=[],s=[];for(let r=0;r<e.length;r++)for(let a=0;a<t.length;a++)if(e[r].tags.includes(t[a])&&!s.includes(e[r].name)){n.push(e[r]),s.push(e[r].name);continue}return n}class bn{constructor(e){o(this,"config");this.config=e}generate(){let e=K.int(this.config.minQuality,this.config.maxQuality),n=Fn(this.config.maxQuality,this.config.components);n=Xn(this.config.minQuality,n);let s=this.config.pattern.complete(this.config.components,e);if(this.config.useMutator){let r=Jn(s.tags,this.config.mutators);r.length>0&&(s=k(r).mutate(s))}return s}}class M{constructor(e,n,s,r,a){o(this,"name");o(this,"abilities");o(this,"tags");o(this,"threatLevel");o(this,"itemGenerators");this.name=e,this.abilities=n,this.tags=s,this.threatLevel=r,this.itemGenerators=a}}class zn{constructor(){o(this,"possibleBiomes");o(this,"width");o(this,"height");o(this,"maxRooms");o(this,"minRooms");o(this,"minThreatLevel");o(this,"maxThreatLevel");this.width=40,this.height=50,this.maxRooms=30,this.minRooms=20,this.minThreatLevel=0,this.maxThreatLevel=5;let e=Bt(),n=new Hn(e),s=new Vn(n),r=[];for(let a=0;a<5;a++)s.config.climate=Bt(),r.push(s.generate());this.possibleBiomes=r}}class es{constructor(e,n){o(this,"name");o(this,"mobs");this.name=e,this.mobs=n}}class ts{constructor(e){o(this,"groups");o(this,"totalThreatLevel");this.groups=e,this.totalThreatLevel=0;for(let n=0;n<this.groups.length;n++)for(let s=0;s<this.groups[n].mobs.length;s++)this.totalThreatLevel+=this.groups[n].mobs[s].threatLevel}}class d{constructor(e,n,s,r,a,i,l,c,h){o(this,"name");o(this,"pluralName");o(this,"description");o(this,"summary");o(this,"abilities");o(this,"statBlock");o(this,"environments");o(this,"behaviors");o(this,"carried");o(this,"creatureTypes");o(this,"tags");o(this,"threatLevel");this.name=e,this.pluralName=n,this.description=s,this.summary="",this.abilities=r,this.environments=a,this.behaviors=i,this.creatureTypes=l,this.carried=[],this.tags=c,this.threatLevel=h}}function ns(t){let e=$e.cloneDeep(t),n="skeletal";return e.name=`${n} ${e.name}`,e.pluralName=`${n} ${e.pluralName}`,e.abilities.push("unharmed by piercing damage"),e.tags.push("skeleton"),e.tags.push("undead"),e.threatLevel+=1,e}function ss(t){let e=$e.cloneDeep(t),n="vampire";return e.name=`${n} ${e.name}`,e.pluralName=`${n} ${e.pluralName}`,e.abilities.push("drain blood to gain life"),e.abilities.push("transform into a bat"),e.abilities.push("transform into a wolf"),e.abilities.push("transform into mist"),e.abilities.push("see in the dark"),e.abilities.push("can only be killed by a stake through the heart or by direct sunlight"),e.tags.push("vampire"),e.tags.push("undead"),e.threatLevel+=5,e}function rs(t){let e=$e.cloneDeep(t),n="zombie";e.name=`${n} ${e.name}`,e.pluralName=`${n} ${e.pluralName}`,e.abilities.push("can only be killed by removing the head");let s=[];for(let r=0;r<e.tags.length;r++)e.tags[r]!="sentient"&&s.push(e.tags[r]);return e.tags=s,e.abilities.push("can bite others to transform them into zombies"),e.tags.push("zombie"),e.tags.push("undead"),e.threatLevel+=1,e}function as(){let t=["cautious","hunting","lethargic","resting","sleeping","stalking"],e=[new d("ape","apes","",[],["forest"],t,["beast"],["simian"],1),new d("axe beak","axe beaks","",[],["grassland","hill"],t,["beast"],[],1),new d("baboon","baboons","",[],["forest","hill"],t,["beast"],["monkey"],1),new d("badger","badgers","",[],["forest"],t,["beast"],[],1),new d("bat","bats","",[],["cave"],t,["beast"],["flying"],1),new d("black bear","black bears","",[],["forest"],t,["beast"],["bear"],1),new d("blink dog","blink dogs","",[],["forest"],t,["fey"],["canine"],1),new d("boar","boars","",[],["forest","grassland","hill"],t,["beast"],["boar"],1),new d("brown bear","brown bears","",[],["arctic","forest","hill"],t,["beast"],["bear"],1),new d("camel","camels","",[],["desert"],t,["beast"],["camel"],1),new d("cat","cats","",[],["desert","forest","grassland","hill"],t,["beast"],["cat"],1),new d("cave bear","cave bears","",[],["forest","hill"],t,["beast"],["bear"],3),new d("constrictor snake","constrictor snakes","",[],["desert","forest","swamp","underwater"],t,["beast"],["snake"],1),new d("crocodile","crocodiles","",[],["swamp"],t,["beast"],["reptile"],1),new d("dire bat","dire bats","",[],["forest"],t,["beast"],["bat","flying"],2),new d("dire bear","dire bears","",[],["forest","hill"],t,["beast"],["bear"],2),new d("dire wolf","dire wolves","",[],["forest"],t,["beast"],["canine","wolf"],2),new d("elk","elks","",[],["forest","grassland","hill"],t,["beast"],[],1),new d("flying snake","flying snakes","",[],["forest","grassland","hill","urban"],t,["beast"],["snake"],1),new d("giant bat","giant bats","",[],["forest","underdark"],t,["beast"],["bat","flying"],2),new d("giant rat","giant rats","",[],["forest","urban","underdark"],t,["beast"],["rat"],1),new d("goat","goats","",[],["forest","grassland","hill","mountain"],t,["beast"],["goat"],1),new d("great eagle","great eagles","",[],["forest","hill","mountain"],t,["beast"],["eagle","bird","flying"],3),new d("horse","horses","",[],["grassland"],t,["beast"],["horse"],1),new d("jaguar","jaguars","",[],["forest"],t,["beast"],["feline"],1),new d("lion","lions","",[],["desert","forest"],t,["beast"],["feline"],1),new d("stirge","stirges","",["drain blood"],["coastal","desert","forest","grassland","hill","mountain","swamp","underdark","urban"],t,["beast"],[],1),new d("tiger","tigers","",[],["forest"],t,["beast"],["feline"],2),new d("war dog","war dogs","",[],["forest","grassland","hill","mountain","underdark","urban"],t,["beast"],["canine","dog","martial"],1),new d("wild pig","wild pigs","",[],["forest"],t,["beast"],["pig"],1),new d("wolf","wolves","",[],["forest"],t,["beast"],["canine","wolf"],1)];for(let n=0;n<e.length;n++)e[n].tags.push(e[n].name),e[n].tags.push("animal");return e}function ls(){let t=["gibbering","chittering","chattering","raging","resting"],e=[new d("dretch","dretches","",["emit fetid cloud"],[],t,["fiend"],["demon"],3),new d("hell hound","hell hounds","",["immune to fire damage","breathe fire once an hour"],[],["resting","sleeping","hunting","stalking"],["fiend"],["canine"],3),new d("imp","imps","",["shapeshift into animal","see in darkness","resistant to magic"],[],t,["fiend"],["demon"],3),new d("lemure","lemures","",["immune to fire","immune to poison"],[],t,["fiend"],["demon"],1),new d("quasit","quasits","",["shapeshift into insect","invisible at will, unless attacking","resistant to magic"],[],t,["fiend"],["demon"],4)];for(let n=0;n<e.length;n++)e[n].tags.push(e[n].name),e[n].tags.push("demonic");return e}function is(){let t=["resting","hunting","wandering"],e=[new d("dust mephit","dust mephits","",["explodes on death","blinding dust breath"],["desert"],t,["elemental"],["elemental"],1),new d("ice mephit","ice mephits","",["cast fog cloud","ice explosion on death","frost breath","immune to cold"],["arctic"],t,["elemental"],["elemental"],1),new d("magma mephit","magma mephits","",["cast heat metal","lava explosion on death","fire breath","immune to fire"],["underdark"],t,["elemental"],["elemental"],1),new d("steam mephit","steam mephits","",["cast blur","steam explosion on death","scalding steam breath","immune to fire","immune to poison"],["underwater"],t,["elemental"],["elemental"],1)];for(let n=0;n<e.length;n++)e[n].tags.push(e[n].name),e[n].tags.push("elemental");return e}function os(){let t=["resting","hunting","exploring","wandering"],e=[new d("fire beetle","fire beetles","",["glows with soft orange light"],["forest","underdark"],t,["beast"],["beetle"],1),new d("giant ant","giant ants","",[],["forest","grassland","hill"],t,["beast"],["ant","swarm"],1),new d("giant bee","giant bees","",["venomous sting"],["forest","grassland","hill"],t,["beast"],["bee","flying","swarm"],2),new d("giant beetle","giant beetles","",[],["forest","grassland","hill","mountain","urban","underdark"],t,["beast"],["beetle","swarm"],1),new d("giant centipede","giant centipedes","",["venomous bite"],["forest","grassland","hill","mountain","underdark"],t,["beast"],["centipede"],2),new d("giant dragonfly","giant dragonflies","",[],["forest","grassland","hill"],t,["beast"],["flying"],1),new d("giant scorpion","giant scorpions","",["deadly venomous sting"],["desert"],t,["beast"],["scorpion","arachnid"],3),new d("giant spider","giant spiders","",["deadly venomous bite"],["coastal","forest","grassland","hill","mountain","underdark","urban"],t,["beast"],["spider","arachnid"],3)];for(let n=0;n<e.length;n++)e[n].tags.push(e[n].name),e[n].tags.push("insect");return e}function hs(){let t=["immobile","inert","guarding","watching","wandering"],e=[new d("amber golem","amber golems","",["resistant to magic","cannot be polymorphed"],[],t,["construct"],["enchanted","golem"],5),new d("clay golem","clay golems","",["immune to acid","cannot be polymorphed"],[],t,["construct"],["enchanted","golem"],3),new d("stone golem","stone golems","",["resistant to fire","cannot be polymorphed"],[],t,["construct"],["enchanted","golem"],3),new d("iron golem","iron golems","",["resistant to fire","cannot be polymorphed"],[],t,["construct"],["enchanted","golem"],3),new d("wood golem","wood golems","",["cannot be polymorphed"],[],t,["construct"],["enchanted","golem"],2),new d("enchanted suit of armor","enchanted suits of armor","",[],[],t,["construct"],["enchanted"],2),new d("enchanted book","enchanted books","",["cast a single minor spell"],[],t,["construct"],["enchanted","flying"],1),new d("flying sword","flying swords","",[],[],t,["construct"],["enchanted","flying"],1),new d("lesser gargoyle","lesser gargoyles","",["turn to stone at will"],[],t,["monstrosity"],["enchanted","gargoyle"],2),new d("mimic","mimics","",["resemble a chest or other large container at will"],[],t,["monstrosity"],["enchanted"],2)];for(let n=0;n<e.length;n++)e[n].tags.push(e[n].name),e[n].tags.push("magic");return e}function cs(){let t=["cautious","hunting","lethargic","resting","sleeping","stalking"],e=[new d("cockatrice","cockatrices","",[],["grassland"],t,["monstrosity"],["cockatrice"],1),new d("darkmantle","darkmantles","",["disguise as stalactite"],["underdark"],t,["monstrosity"],[],1),new d("death dog","death dogs","",[],["desert"],t,["monstrosity"],["canine","martial"],1),new d("gryfalcon","gryfalcons","",[],["grassland","hill","mountain"],t,["monstrosity"],["flying"],4),new d("gryphon","gryphons","",[],["grassland","hill","mountain"],t,["monstrosity"],["flying"],4),new d("harpy","harpies","",[],["coastal","forest","hill","mountain"],t,["monstrosity"],["flying"],3),new d("hippogriff","hippogriffs","",[],["grassland","hill","mountain"],t,["monstrosity"],["flying"],4),new d("owlbear","owlbears","",[],["forest"],t,["monstrosity"],[],4),new d("rust monster","rust monsters","",["rusts nonmagical metal it touches"],["underdark"],t,["monstrosity"],[],3),new d("worg","worgs","",["see in the dark"],["forest","grassland","hill"],t,["monstrosity"],["canine","martial","wolf"],3)];for(let n=0;n<e.length;n++)e[n].tags.push(e[n].name),e[n].tags.push("monstrosity");return e}function us(){let t=["waiting","hunting","wandering","clinging to the ceiling"],e=[new d("black pudding","black puddings","",["dissolve nonmagical metal things","amorphous","climb walls and ceilings"],["forest","grassland","hill","underdark"],t,["ooze"],[],2),new d("blue jelly","blue jellies","",["amorphous","climb walls and ceilings"],["forest","grassland","hill"],t,["ooze"],[],1),new d("blue slime","blue slimes","",["amorphous","climb walls and ceilings"],["coastal","forest","grassland","hill"],t,["ooze"],[],1),new d("brown pudding","brown puddings","",["amorphous","climb walls and ceilings"],["forest","grassland","hill"],t,["ooze"],[],2),new d("gelatinous cube","gelatinous cubes","",["dissolve nonmetal things"],["forest","grassland","hill"],["waiting","wandering"],["ooze"],[],3),new d("gray ooze","gray oozes","",["amorphous","corrode metal","imitate oily pool","climb walls and ceilings"],["underdark"],t,["ooze"],[],2),new d("green slime","green slimes","",["amorphous","climb walls and ceilings"],["forest","grassland","hill"],t,["ooze"],[],1),new d("ochre jelly","ochre jellies","",["amorphous","climb walls and ceilings","split in half when hit with lightning"],["forest","grassland","hill"],["ooze"],t,[],3)];for(let n=0;n<e.length;n++)e[n].tags.push(e[n].name),e[n].tags.push("ooze");return e}function ms(){let t=["hunting"],e=[new d("ghoul","ghouls","",[],["swamp","underdark","urban"],t,["undead"],[],2),new d("shadow","shadows","",["amorphous","immune to necrotic magic","immune to poison","see in the dark","drain strength"],["swamp","underdark","urban"],t,["undead"],[],2),new d("will o' the wisp","will o' the wisps","",["glow with a bright light","become invisible"],["forest"],t,["undead"],[],1)];for(let n=0;n<e.length;n++)e[n].tags.push(e[n].name),e[n].tags.push("undead");return e}function fs(){let t=[];t=t.concat(as());let e=[];for(let n=0;n<t.length;n++)e.push(ns(t[n])),e.push(ss(t[n])),e.push(rs(t[n]));return t=t.concat(e),t=t.concat(ls()),t=t.concat(is()),t=t.concat(os()),t=t.concat(hs()),t=t.concat(cs()),t=t.concat(us()),t=t.concat(ms()),t}function ds(t,e){let n=[];for(let s=0;s<e.length;s++){let r=!0;for(let a=0;a<t.length;a++)if(!e[s].tags.includes(t[a])){r=!1;break}r===!0&&n.push(e[s])}return n}function gs(t,e){let n=[];for(let s=0;s<e.length;s++){let r=!1;for(let a=0;a<t.length;a++)if(e[s].tags.includes(t[a])){r=!0;break}r===!0&&n.push(e[s])}return n}function ps(t,e){let n=[];for(let s=0;s<e.length;s++)e[s].creatureTypes.includes(t)&&n.push(e[s]);return n}function ws(t,e){let n=[];for(let s=0;s<e.length;s++)e[s].environments.includes(t)&&n.push(e[s]);return n}function bs(t,e){let n=[];for(let s=0;s<e.length;s++){let r=!0;for(let a=0;a<t.length;a++)if(e[s].tags.includes(t[a])){r=!1;break}r===!0&&n.push(e[s])}return n}class A{constructor(e,n,s,r,a){o(this,"withAllTags");o(this,"withAnyTag");o(this,"withCreatureType");o(this,"withEnvironment");o(this,"withNoTags");this.withAllTags=e,this.withAnyTag=n,this.withCreatureType=s,this.withEnvironment=r,this.withNoTags=a}apply(e){let n=e;return this.withAllTags.length>0&&(n=ds(this.withAllTags,n)),this.withAnyTag.length>0&&(n=gs(this.withAnyTag,n)),this.withCreatureType!=""&&(n=ps(this.withCreatureType,n)),this.withEnvironment!=""&&(n=ws(this.withEnvironment,n)),this.withNoTags.length>0&&(n=bs(this.withNoTags,n)),n}}class D{constructor(e,n,s,r,a,i,l){o(this,"name");o(this,"threatLevel");o(this,"isSentient");o(this,"archetypes");o(this,"filter");o(this,"minNumber");o(this,"maxNumber");this.name=e,this.threatLevel=n,this.isSentient=s,this.archetypes=r,this.filter=a,this.minNumber=i,this.maxNumber=l}}class V{constructor(e,n,s,r,a){o(this,"name");o(this,"threatLevel");o(this,"groupTemplates");o(this,"tags");o(this,"commonality");this.name=e,this.threatLevel=n,this.groupTemplates=s,this.tags=r,this.commonality=a}}class vs{constructor(){o(this,"isHostile");o(this,"template");o(this,"environment");o(this,"sentientOptions");o(this,"creatureOptions");o(this,"minThreatLevel");o(this,"maxThreatLevel");this.isHostile=!0,this.environment="forest",this.template=null,this.sentientOptions=He(),this.creatureOptions=fs(),this.minThreatLevel=1,this.maxThreatLevel=4}}class ys{constructor(){o(this,"config")}generate(){let e=[];if(this.config.template===null)throw new Error("EncounterGenerator requires a template.");for(let n=0;n<this.config.template.groupTemplates.length;n++){let s=[],r=this.config.template.groupTemplates[n],a=K.int(r.minNumber,r.maxNumber),i=[],l=[];r.isSentient?l=$e.cloneDeep(this.config.sentientOptions):l=$e.cloneDeep(this.config.creatureOptions);let c=r.filter.withAllTags.concat(r.filter.withAnyTag);if(c.includes("undead")){let h=l.concat(Yt(l)),u=l.concat(Ft(l)),m=l.concat(Xt(l));l=l.concat(h),l=l.concat(u),l=l.concat(m)}else if(c.includes("skeleton")){let h=l.concat(Yt(l));l=l.concat(h)}else if(c.includes("vampire")){let h=l.concat(Ft(l));l=l.concat(h)}else if(c.includes("zombie")){let h=l.concat(Xt(l));l=l.concat(h)}i=r.filter.apply(l),i.length===0&&(console.error("No options for filter",r.filter),console.debug("Used options",l)),r.isSentient?s=ks(i,r.archetypes,a):s=Ts(i,a),e.push(new es(r.name,s))}return new ts(e)}}function Ts(t,e){let n=k(t),s=[];for(let r=0;r<e;r++){let a=$e.cloneDeep(n),i=k(n.behaviors);a.summary=i,s.push(a)}return s}function ks(t,e,n){let s=k(t),r=[],a=Bn();a.speciesOptions=[s];let i=new qn(a);for(let l=0;l<n;l++){let c=k(e),h=i.generate();h.archetype=c,h.abilities=h.abilities.concat(c.abilities),h.threatLevel+=c.threatLevel,h.summary=`${h.gender.name} ${h.species.adjective} ${h.archetype.name}`;for(let u=0;u<h.archetype.itemGenerators.length;u++)h.carried.push(h.archetype.itemGenerators[u].generate());r.push(h)}return r}class W{constructor(e,n){o(this,"x");o(this,"y");this.x=e,this.y=n}equals(e){return this.x==e.x&&this.y==e.y}in(e){for(let n=0;n<e.length;n++)if(this.equals(e[n]))return!0;return!1}}class vn{constructor(){o(this,"a");o(this,"b")}equals(e){return this.a.x==e.a.x&&this.a.y==e.a.y&&this.b.x==e.b.x&&this.b.y==e.b.y?!0:this.a.x==e.b.x&&this.a.y==e.b.y&&this.b.x==e.a.x&&this.b.y==e.a.y}getMidpoint(){let e=(this.a.x+this.b.x)/2,n=(this.a.y+this.b.y)/2;return new W(e,n)}getSlope(){return(this.b.y-this.a.y)/(this.b.x-this.a.x)}}function tt(t,e){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}class _s{constructor(){o(this,"id");o(this,"name");o(this,"description");o(this,"objectId");o(this,"strength");o(this,"isLocked");this.id="",this.name="a lock",this.description="a lock",this.objectId=-1,this.strength=1,this.isLocked=!0}}class xs{constructor(){o(this,"room1");o(this,"room2");o(this,"tile");o(this,"vertex");o(this,"description");o(this,"lock");o(this,"isSecret");this.lock=null,this.isSecret=!1}}class vt{constructor(e,n,s,r){o(this,"name");o(this,"description");o(this,"secret");o(this,"isContainer");this.name=e,this.description=n,this.secret=s,this.isContainer=r}}class J{constructor(e,n,s,r){o(this,"name");o(this,"descriptionOptions");o(this,"secretOptions");o(this,"isContainer");this.name=e,this.descriptionOptions=n,this.secretOptions=s,this.isContainer=r}generate(){let e="";return oe(100)>70&&this.secretOptions.length>0&&(e=k(this.secretOptions)),new vt(this.name,k(this.descriptionOptions),e,this.isContainer)}}class Rs{constructor(){o(this,"vertices");o(this,"edges")}edgesFromVertices(){let e=[];for(let n=0;n<this.vertices.length;n++){let s=new vn;s.a=this.vertices[n],n<this.vertices.length-1?s.b=this.vertices[n+1]:s.b=this.vertices[0],e.push(s)}return e}}const yt=0,Ct=1,Et=2,Tt=3,yn=4,Tn=5;class js{constructor(){o(this,"id");o(this,"name");o(this,"description");o(this,"secrets");o(this,"shape");o(this,"tileMesh");o(this,"tiles");o(this,"vertices");o(this,"minX");o(this,"minY");o(this,"maxX");o(this,"maxY");o(this,"center");o(this,"lightLevel");o(this,"features");o(this,"treasureCaches");o(this,"encounters");o(this,"theme");o(this,"doors");this.tileMesh=[],this.encounters=[],this.features=[],this.doors=[],this.description="",this.secrets="",this.tiles=[],this.treasureCaches=[],this.vertices=[],this.lightLevel=0}calculateTileMesh(){let e=[],n=this.minY,s=this.maxY,r=this.minX,a=this.maxX;for(let i=n;i<s;i++)for(let l=r;l<a;l++){let c=new Rs;c.vertices=[new W(l-.5,i-.5),new W(l+.5,i-.5),new W(l+.5,i+.5),new W(l-.5,i+.5)],c.edges=c.edgesFromVertices(),e.push(c)}this.tileMesh=e}calculateTiles(e,n){let s=[];for(let r=0;r<n;r++){let a=[];s[r]=a;for(let i=0;i<e;i++)s[r][i]=yt}for(let r=0;r<this.vertices.length;r++)this.vertices[r].y>s.length-1&&console.debug(`Vertices outside the bounds of the map: ${s.length} newTiles.length, ${this.vertices[r].y} this.vertices[i].y`,this.vertices),s[this.vertices[r].y][this.vertices[r].x]=Ct;this.tiles=s}calculateVertices(){let e=[];for(let n=0;n<this.tiles.length;n++)for(let s=0;s<this.tiles[n].length;s++)this.tiles[n][s]!=yt&&e.push(new W(s,n));this.vertices=e}getTileEdges(){let e=[];for(let n=0;n<this.tileMesh.length;n++)for(let s=0;s<this.tileMesh[n].edges.length;s++)e.push(this.tileMesh[n].edges[s]);return e}getCenter(){let e=this.minX+(this.maxX-this.minX)/2,n=this.minY+(this.maxY-this.minY)/2;return new W(e,n)}getMinX(){let e=this.vertices[0].x;for(let n=0;n<this.vertices.length;n++)this.vertices[n].x<e&&(e=this.vertices[n].x);return e}getMaxX(){let e=this.vertices[0].x;for(let n=0;n<this.vertices.length;n++)this.vertices[n].x>e&&(e=this.vertices[n].x);return e}getMinY(){let e=this.vertices[0].y;for(let n=0;n<this.vertices.length;n++)this.vertices[n].y<e&&(e=this.vertices[n].y);return e}getMaxY(){let e=this.vertices[0].y;for(let n=0;n<this.vertices.length;n++)this.vertices[n].y>e&&(e=this.vertices[n].y);return e}getHeight(){return this.maxY-this.minY}getWidth(){return this.maxX-this.minX}moveBy(e,n,s,r){for(let a=0;a<this.vertices.length;a++)this.vertices[a].x+=e,this.vertices[a].y+=n;this.calculateTiles(s,r),this.minX=this.getMinX(),this.maxX=this.getMaxX(),this.minY=this.getMinY(),this.maxY=this.getMaxY(),this.center=this.getCenter()}moveTo(e,n,s,r){const a=e-this.minX,i=n-this.minY;for(let l=0;l<this.vertices.length;l++)this.vertices[l].x+=a,this.vertices[l].y+=i;this.calculateTiles(s,r),this.minX=this.getMinX(),this.maxX=this.getMaxX(),this.minY=this.getMinY(),this.maxY=this.getMaxY(),this.center=this.getCenter()}}class Wt{constructor(e,n,s){o(this,"name");o(this,"mutate");o(this,"tags");this.name=e,this.mutate=n,this.tags=s}}class ce{constructor(e,n,s,r,a,i,l,c,h,u,m,p,T){o(this,"name");o(this,"allowedEnvironments");o(this,"minWidth");o(this,"maxWidth");o(this,"minHeight");o(this,"maxHeight");o(this,"flooringOptions");o(this,"dressingGenerators");o(this,"featureGenerators");o(this,"mutators");o(this,"shapes");o(this,"tags");o(this,"commonality");this.name=e,this.allowedEnvironments=n,this.minWidth=s,this.maxWidth=a,this.minHeight=r,this.maxHeight=i,this.flooringOptions=l,this.dressingGenerators=c,this.featureGenerators=h,this.mutators=u,this.shapes=m,this.tags=p,this.commonality=T}}class kt{constructor(e,n,s){o(this,"theme");o(this,"minCount");o(this,"maxCount");this.theme=e,this.minCount=n,this.maxCount=s}}class nt{constructor(e,n,s,r,a,i,l,c,h,u){o(this,"name");o(this,"mainEnvironment");o(this,"nameGenerator");o(this,"weakEncounterTemplates");o(this,"strongEncounterTemplates");o(this,"bossEncounterTemplates");o(this,"sentientOptions");o(this,"flooringOptions");o(this,"roomThemes");o(this,"requiredRooms");this.name=e,this.mainEnvironment=n,this.nameGenerator=s,this.weakEncounterTemplates=r,this.strongEncounterTemplates=a,this.bossEncounterTemplates=i,this.sentientOptions=l,this.flooringOptions=c,this.roomThemes=h,this.requiredRooms=u}}class Cs{constructor(){o(this,"name");o(this,"description");o(this,"theme");o(this,"environment");o(this,"totalThreatLevel");o(this,"averageThreatLevel");o(this,"rooms");o(this,"doors");o(this,"tiles");this.doors=[],this.rooms=[],this.totalThreatLevel=0}}class kn{constructor(e,n,s){o(this,"mapHeight");o(this,"mapWidth");o(this,"theme");this.mapHeight=n,this.mapWidth=e,this.theme=s}}class _n{constructor(e){o(this,"config");this.config=e}generate(){let e=K.int(this.config.theme.minWidth,this.config.theme.maxWidth),n=K.int(this.config.theme.minHeight,this.config.theme.maxHeight),s=K.int(2,this.config.mapWidth-e-3),r=K.int(2,this.config.mapHeight-n-3),a=new js;a.name=this.config.theme.name,a.theme=this.config.theme;let i=k(this.config.theme.shapes);if(i=="rectangular"?(a=Os(s,r,e,n,a),a.description=k([`This rectangular room is ${e*5}' wide and ${n*5}' long.`,`This ${a.name} is ${e*5}' wide and ${n*5}' long.`])):i=="square"?(a=Gs(s,r,e,a),a.description=k([`This square room is ${e*5}' wide and ${n*5}' long.`,`This room is a square ${e*5}' wide and ${n*5}' long.`,`This ${a.name} is ${e*5}' wide and ${n*5}' long.`])):i=="cavern"?(a=Es(s,r,e,n,a),a.description=k(["This is a cavern."])):i=="corridor"&&(a=$s(s,r,e,n,a),a.description=k(["This is a corridor."])),oe(100)>70){let l=k(a.theme.flooringOptions);a.description+=k([` The floor is ${l}.`,` ${bt(l)} flooring is cracked in places.`,` The ${l} flooring is cracked in places.`,` The ${l} flooring is broken in places.`])}for(let l=0;l<this.config.theme.featureGenerators.length;l++){let c=this.config.theme.featureGenerators[l].generate();a.features.push(c),c.secret!=""&&(a.secrets+=c.secret+" ")}if(this.config.theme.dressingGenerators.length>0&&oe(100)>70){let l=k(this.config.theme.dressingGenerators);a.features.push(l.generate())}return a.minX=s,a.maxX=a.getMaxX(),a.minY=r,a.maxY=a.getMaxY(),a.center=a.getCenter(),a.calculateTiles(this.config.mapWidth,this.config.mapHeight),a}}function Es(t,e,n,s,r){let a=new W(Math.floor((t+n)/2),Math.floor((e+s)/2)),i=20;const l=t+n,c=e+s;r.vertices.push(a);let h=new W(a.x,a.y);for(let u=0;u<i;u++){let m=h.x,p=h.y;if(oe(100)>50){let g=K.int(-1,1);m+=g,m>l?m=l:m<t&&(m=t)}else{let g=K.int(-1,1);p+=g,p>c?p=c:p<e&&(p=e)}let T=new W(m,p),w=!1;for(let g=0;g<r.vertices.length;g++)if(r.vertices[g].equals(T)){w=!0;break}w||r.vertices.push(T),h.x=m,h.y=p}return r}function $s(t,e,n,s,r){let a=K.int(Math.max(3,Math.floor((n+s-2)/2)),n+s-2),i=K.int(t,t+n-1),l=K.int(e,e+s-1);r.vertices.push(new W(i,l));let c=k([new W(-1,0),new W(1,0),new W(0,-1),new W(0,1)]);for(let h=0;h<a;h++){let u=i+c.x,m=l+c.y;if(u>=n+t||u<=t)c.x=0,c.y=k([-1,1]);else if(m>=s+e||m<=e)c.y=0,c.x=k([-1,1]);else{i=u,l=m;let p=new W(i,l);if(p.in(r.vertices))continue;r.vertices.push(p),oe(100)>90&&(c.y!=0?(c.x=c.y,c.y=0):(c.y=c.x,c.x=0))}}return r}function Os(t,e,n,s,r){for(let a=e;a<e+s;a++)for(let i=t;i<t+n;i++)r.vertices.push(new W(i,a));return r.description=`This room is ${(n+1)*5}' wide and ${(s+1)*5}' long.`,r}function Gs(t,e,n,s){for(let r=e;r<e+n;r++)for(let a=t;a<t+n;a++)s.vertices.push(new W(a,r));return s.description=`This square room is ${(n+1)*5}' wide and ${(n+1)*5}' long.`,s}function Ls(t,e){let n=1e7;for(let s=0;s<e.length;s++)for(let r=0;r<e[s].vertices.length;r++)for(let a=0;a<t.vertices.length;a++){let i=tt(e[s].vertices[r],t.vertices[a]);i<=n&&(n=i)}return n}function As(t,e){for(let n=0;n<e.length;n++)for(let s=0;s<e[n].vertices.length;s++)for(let r=0;r<t.vertices.length;r++)if(t.vertices[r].equals(e[n].vertices[s]))return!0;return!1}function Ds(t,e){for(let n=0;n<e.length;n++)for(let s=0;s<e[n].vertices.length;s++)for(let r=0;r<t.vertices.length;r++)if(tt(t.vertices[r],e[n].vertices[s])==1)return!0;return!1}function Ms(t,e){let n=[],s=[];for(let r=0;r<e.length;r++)for(let a=0;a<t.vertices.length;a++)for(let i=0;i<e[r].vertices.length;i++)if(tt(e[r].vertices[i],t.vertices[a])<=2&&!s.includes(e[r].id)&&e[r].id!=t.id){s.push(e[r].id),n.push(e[r]);break}return n}function Pt(t,e,n,s){let r=!0,a=t-3,i=e-3,l=new kn(t,e,n),c=new _n(l),h=c.generate(),u=0,m=5,p=h.minX+1,T=h.minY;for(;r;)if(!As(h,s)&&!Ds(h,s)&&Is(2,h,s))r=!1;else if(u<=m){if(p+=1,p>a-h.getWidth()&&(p=2,T++,T>i-h.getHeight())){u++,p=2,T=2;continue}h.moveTo(p,T,t,e)}else{if(u>m)return null;u++,h=c.generate(),p=h.minX+1,T=h.minY}return h}function Is(t,e,n){return Ls(e,n)==t}function Ns(t,e){let n=new xs,s=[];for(let i=0;i<t.vertices.length;i++)for(let l=0;l<e.vertices.length;l++)if(tt(t.vertices[i],e.vertices[l])==2){let h=new vn;h.a=t.vertices[i],h.b=e.vertices[l],s.push(h)}let r=k(s);n.vertex=r.getMidpoint(),r.getSlope()===0?n.tile=Tt:n.tile=Et,oe(100)>90?(n.lock=new _s,n.lock.id=wt(24)):oe(100)>90&&(n.isSecret=!0,n.tile==Tt?n.tile=Tn:n.tile=yn),n.room1=t.id,n.room2=e.id;let a=k([k(["rough","decaying","rotted"]),"simple","plain",k(["iron-trimmed","copper-trimmed","silver-trimmed","gold-trimmed","painted","carved","ornate"])]);return n.description=Ee(a)+" "+a+" door",n}function Vs(t){for(let e=0;e<t.rooms.length;e++){let n=Ms(t.rooms[e],t.rooms),s=[];for(let m=0;m<n.length;m++){let p=!1;for(let T=0;T<t.rooms[e].doors.length;T++){let w=t.doors[t.rooms[e].doors[T]];(w.room1==t.rooms[e].id&&w.room2==n[m].id||w.room2==t.rooms[e].id&&w.room1==n[m].id)&&(p=!0)}p||s.push(n[m])}if(s.length==0)continue;let r=k(s),a=Ns(t.rooms[e],r);r.id==0&&(a.isSecret=!1,t.rooms[0].doors.length<2&&(a.lock=null)),t.doors.push(a);let i=t.doors.length-1;t.rooms[e].doors.push(i);let l=Ut(a,t.rooms[e]),c=Ut(a,t.rooms[r.id]),h="",u="";if(a.isSecret){let m=k([`${k(["It is","It's"])} hidden behind a tapestry.`,`${k(["It is","It's"])} practically undetectable except for a thin seam visible only on close inspection.`,"A tapestry obscures it.","It cannot be opened from this side.",`A pile of ${k(["refuse","debris","trash"])} obscures it.`]);oe(100)>50?(u=`${c} ${m}`,c=""):(h=`${l} ${m}`,l=""),t.rooms[e].secrets+=h,t.rooms[r.id].secrets+=u}t.rooms[e].features.push(new vt("door",l,h,!1)),t.rooms[r.id].doors.push(i),t.rooms[r.id].features.push(new vt("door",c,u,!1)),t.tiles=Hs(a,t.tiles)}return t}function Hs(t,e){return e[t.vertex.y][t.vertex.x]=t.tile,e}function Ut(t,e){let n="";t.tile==Et?t.vertex.y>e.center.y?t.vertex.x<e.center.x?n="southwest":t.vertex.x>e.center.x?n="southeast":n="south":t.vertex.x<e.center.x?n="northwest":t.vertex.x>e.center.x?n="northeast":n="north":t.vertex.x<e.center.x?t.vertex.y>e.center.y?n="southwest":t.vertex.y<e.center.y?n="northwest":n="west":t.vertex.y>e.center.y?n="southeast":t.vertex.y<e.center.y?n="northeast":n="east";let s=k([`There's ${t.description} in the ${n}`,`There is ${t.description} in the ${n}`,bt(t.description)+` lies in the ${n}`,bt(t.description)+` is in the ${n}`]);return t.lock!=null?s+=". It is locked.":s+=".",s}function B(t,e){for(let n=0;n<e.length;n++)if(e[n].name==t)return e[n];throw new Error(`Failed to find archetype "${t}"`)}class xn{constructor(){o(this,"pattern");o(this,"components");o(this,"minValue");o(this,"maxValue");o(this,"minQuality");o(this,"maxQuality");o(this,"mutators");o(this,"useMutator");this.components=Wn(),this.minValue=0,this.maxValue=0,this.minQuality=0,this.maxQuality=1,this.mutators=Zn(),this.useMutator=!1}}function ee(t,e){let n=new xn;n.pattern=Pn(t);let s=0,r=e,a=10,i=e;return e==1?a=20:e==2?(s=10,a=30):e==3?(s=30,a=50):e==3?(s=50,a=100):e==4&&(s=100,a=1e4),n.minValue=s,n.maxValue=a,n.minQuality=r,n.maxQuality=i,new bn(n)}function q(t,e){let n=Un(t);return ee(k(n).name,e)}function qs(){return[new M("cleric",["casts divine spells"],["cleric"],2,[q("mace",1),q("breastplate",1)]),new M("priest",["casts divine spells"],["cleric"],1,[q("staff",1),ee("robe",1)]),new M("high priest",["casts divine spells"],["cleric"],2,[q("staff",2),ee("robe",2)])]}function Bs(){return[new M("cult acolyte",[],["cult"],1,[q("staff",1),ee("robe",0)]),new M("cult priest",["casts minor demonic spells"],["cult"],2,[q("staff",1),ee("robe",1)]),new M("cult high priest",["casts demonic spells"],["cult"],3,[q("staff",3),q("knife",2),ee("robe",3)])]}function Ys(){return[new M("apprentice mage",["casts minor spells"],["magic user"],1,[ee("staff",1),ee("robe",0)]),new M("archmage",["casts spells"],["magic user"],4,[ee("staff",3),ee("robe",3)]),new M("druid",["casts nature spells"],["magic user"],2,[ee("staff",1),ee("robe",0)]),new M("mage",["casts spells"],["magic user"],2,[ee("staff",1),ee("robe",0)]),new M("necromancer",["casts necromantic spells"],["magic user"],4,[ee("staff",3),ee("robe",3)]),new M("sorcerer",["casts innate spells"],["magic user"],2,[]),new M("warlock",["casts demonic spells"],["magic user"],2,[]),new M("witch",["casts curses","casts charms"],["magic user"],2,[]),new M("wizard",["casts spells"],["magic user"],2,[ee("staff",1),ee("robe",1)])]}function Fs(){return[new M("archer",[],["martial","military"],1,[q("bow",1)]),new M("captain",[],["martial","military"],1,[q("sword",2),q("breastplate",2),q("helmet",2)]),new M("general",[],["martial","military"],1,[q("sword",3),q("breastplate",3),q("helmet",3)]),new M("guard",[],["martial","military"],1,[q("spear",1),q("body armor",1)]),new M("hunter",[],["martial","wilderness"],1,[]),new M("martial artist",[],["martial"],1,[]),new M("martial arts master",[],["martial"],2,[]),new M("raider captain",[],["criminal","martial"],1,[q("sword",1),q("breastplate",1)]),new M("raider",[],["criminal","martial"],1,[q("weapon",1),q("body armor",1)]),new M("ranger",[],["martial","wilderness"],3,[]),new M("soldier",[],["martial","military"],1,[q("martial weapon",1),q("body armor",1)]),new M("thug",[],["criminal","martial"],1,[q("club",1)]),new M("veteran hunter",[],["martial","wilderness"],2,[q("bow",3)]),new M("veteran soldier",[],["martial","military"],2,[q("sword",2),q("breastplate",2)]),new M("warrior",[],["martial","wilderness"],1,[q("simple weapon",1)])]}function Xs(){return[new M("lich",["casts necromancy spells"],["undead"],5,[]),new M("shambler",[],["undead"],1,[]),new M("sprinter",[],["undead"],2,[])]}function Oe(){let t=[];return t=t.concat(qs()),t=t.concat(Bs()),t=t.concat(Ys()),t=t.concat(Fs()),t=t.concat(Xs()),t}function Ws(){let t=Oe();return[new V("group of raiders",3,[new D("raider captain",2,!0,[B("raider captain",t)],new A(["martial"],[],"humanoid","",["undead"]),1,1),new D("raiders",3,!0,[B("raider",t)],new A(["martial"],[],"humanoid","",["undead"]),3,6)],["bandits"],5),new V("group of looters",3,[new D("looters",3,!0,[B("thug",t)],new A(["martial"],[],"humanoid","",["undead"]),3,6)],["bandits"],5),new V("group of thugs",2,[new D("thugs",2,!0,[B("thug",t)],new A(["martial"],[],"humanoid","",["undead"]),2,4)],["bandits"],5)]}function Ps(){let t=Oe();return[new V("group of cult acolytes",1,[new D("cult acolytes",1,!0,[B("cult acolyte",t)],new A([],["cult","corruptible"],"humanoid","",["undead"]),2,4)],["cult"],50),new V("group of lesser demons",4,[new D("lesser demons",2,!1,[],new A(["demon"],[],"","",[]),2,4)],["cult","demonic"],1),new V("cult priest",2,[new D("cult priest",2,!0,[B("cult priest",t)],new A([],["cult","corruptible"],"humanoid","",["undead"]),1,1)],["cult"],20),new V("cult high priest",5,[new D("cult high priest",5,!0,[B("cult high priest",t)],new A([],["cult","corruptible"],"humanoid","",["undead"]),1,1)],["cult"],15)]}function $t(){return[new V("swarming insects",3,[new D("swarming insects",3,!1,[],new A(["swarm"],[],"","",[]),3,8)],["insects"],5),new V("wandering creature",2,[new D("wandering creature",3,!1,[],new A([],[],"","",[]),1,1)],["wandering creature"],40),new V("group of wandering creatures",4,[new D("wandering creatures",3,!1,[],new A([],[],"","",[]),2,4)],["wandering creature"],30)]}function Us(){let t=Oe();return[new V("archmage",5,[new D("archmage",5,!0,[B("archmage",t)],new A([],[],"humanoid","",["undead"]),1,1)],["mage","magic"],1),new V("enchanted object",2,[new D("enchanted object",2,!1,[],new A(["enchanted"],[],"construct","",["undead"]),1,1)],["magic"],3),new V("enchanted objects",4,[new D("group of enchanted objects",4,!1,[],new A(["enchanted"],[],"construct","",["undead"]),2,4)],["magic"],2),new V("mage",2,[new D("mage",2,!0,[B("mage",t)],new A([],[],"humanoid","",["skeleton","zombie"]),1,1)],["mage","magic"],5)]}function Qs(){let t=Oe();return[new V("squad of soldiers",1,[new D("soldiers",1,!0,[B("soldier",t)],new A(["martial"],[],"humanoid","",["undead"]),2,4)],["martial","soldiers"],10),new V("squad of veterans",2,[new D("veteran soldiers",2,!0,[B("veteran soldier",t)],new A(["martial"],[],"humanoid","",["undead"]),2,4)],["martial","soldiers"],5),new V("captain",4,[new D("captain",2,!0,[B("captain",t)],new A(["martial"],[],"humanoid","",["undead"]),1,1),new D("veteran soldiers",2,!0,[B("veteran soldier",t)],new A(["martial"],[],"humanoid","",["undead"]),2,4)],["martial","soldiers"],3),new V("general",5,[new D("general",3,!0,[B("general",t)],new A(["martial"],[],"humanoid","",["undead"]),1,1),new D("captain",2,!0,[B("captain",t)],new A(["martial"],[],"humanoid","",["undead"]),1,2)],["martial","soldiers"],2)]}function Rn(){let t=Oe();return[new V("lich",5,[new D("lich",5,!0,[B("lich",t)],new A([],[],"humanoid","",["undead"]),1,1)],["undead"],5),new V("necromancer",7,[new D("necromancer",5,!0,[B("necromancer",t)],new A([],[],"humanoid","",["undead"]),1,1),new D("skeletons",2,!0,[B("warrior",t),B("soldier",t),B("guard",t)],new A(["skeleton"],[],"","",[]),3,6)],["mage","undead"],5),new V("pack of ghouls",5,[new D("ghouls",3,!1,[],new A(["ghoul"],[],"","",[]),2,4)],["undead"],5),new V("pack of undead",5,[new D("undead",3,!1,[],new A(["undead"],[],"","",["vampire"]),2,4)],["undead"],5),new V("pack of skeletons",2,[new D("skeletons",2,!0,[B("warrior",t),B("soldier",t),B("guard",t)],new A(["skeleton"],[],"","",[]),3,6)],["skeleton","undead"],10),new V("pack of zombies",3,[new D("zombies",3,!0,[B("shambler",t),B("sprinter",t)],new A(["zombie"],[],"","",[]),3,6)],["zombie","undead"],10),new V("vampire",5,[new D("vampire",5,!0,[B("warrior",t)],new A(["vampire"],[],"","",[]),1,1)],["vampire","undead"],2)]}function Ss(){let t=Oe();return[new V("group of hunters",3,[new D("hunters",3,!0,[B("hunter",t)],new A(["martial"],[],"humanoid","",["undead"]),3,6)],["hunters"],5),new V("lone hunter",1,[new D("hunter",1,!0,[B("hunter",t)],new A(["martial"],[],"humanoid","",["undead"]),1,1)],["hunters"],1),new V("swarming insects",3,[new D("swarming insects",3,!1,[],new A(["swarm"],[],"","",[]),3,8)],["insect swarm"],5),new V("wandering creature",3,[new D("wandering creature",3,!1,[],new A([],[],"","",[]),1,1)],["wandering creature"],10),new V("group of wandering creatures",5,[new D("wandering creatures",3,!1,[],new A([],[],"","",[]),2,4)],["wandering creature"],10)]}function Ot(t){let e=[];return e=e.concat(Ws()),e=e.concat(Ps()),e=e.concat($t()),e=e.concat(Us()),e=e.concat(Qs()),e=e.concat(Ss()),t&&(e=e.concat(Rn())),e}function st(t,e){return Ge(0,t,e)}function Ge(t,e,n){let s=[];for(let r=0;r<n.length;r++)n[r].threatLevel>=t&&n[r].threatLevel<=e&&s.push(n[r]);return s}function rt(t,e){return Ge(t,t,e)}function Gt(t,e){let n=[];for(let s=0;s<e.length;s++)e[s].tags.includes(t)&&n.push(e[s]);return n}function Ks(){let t=[new J("debris",["There is a pile of random debris here.","Much of the floor is covered in debris.","Debris of unknown origin is scattered about."],[],!1),new J("rags",["There is a pile of rags here.","One of the corners has a large pile of filthy rags.","Small piles of rags are scattered across the floor."],[],!1),new J("cobwebs",["There are a lot of cobwebs here.","The ceiling is partly covered in cobwebs.","Dense cobwebs hang down from the ceiling."],[],!1)];return[new ce("altar room",[],3,3,10,10,["marble","stone tile"],t,[new J("altar",["There is an evil-looking altar here.","There is a blood-covered altar here.","On top of a stone dais is a long altar."],[],!1)],[],["rectangular"],["cult"],5),new ce("armory",[],3,3,6,6,["stone tile"],t,[new J("weapon racks",["Weapon racks full of old spears, swords, and axes line the walls.","Each wall has at least one wooden rack full of weapons.","There are rows of weapon racks here."],[],!1),new J("armor displays",["Pieces of armor in various states of disrepair hang from pegs on the walls.","There are numerous pegs on the walls for armor to be hung.","Several pieces of armor are on armor stands here."],[],!1)],[],["rectangular","square"],["military"],5),new ce("barracks",[],8,8,15,15,["stone tile"],t,[new J("beds",["There are many beds here.","There are many bunk beds here.","There are many cots here.","Beds line the walls.","Cots line the walls."],[],!1),new J("chests",["There are chests at the end of each bed.","Each bed has a chest at the foot."],[],!0)],[],["rectangular"],["military"],5),new ce("burial chamber",[],5,5,10,10,["stone tile"],t,[new J("coffins",["There is a large stone sarcophagus here.","There is an ornate sarcophagus here.","There are several sarcophagi here.","There is a large, ornate coffin here.","There are many coffins here.","Coffins line the walls.","Along the walls are several long alcoves. Each one has a stone coffin."],[],!0)],[],["rectangular"],["tomb"],5),new ce("chamber",[],2,2,6,6,["marble","stone tile"],t,[],[],["rectangular","square"],["dungeon"],40),new ce("fountain chamber",[],2,2,5,5,["stone tile"],t,[new J("fountain",["There is a large fountain here.","There is an ornate fountain here.","There is a disused fountain here with brackish water.","There is an elegant fountain here.","Two fountains lie on either side of the room.","Small fountains sit in each corner of the room.","An old and disused fountain sits in the corner."],[],!0)],[],["rectangular","square"],["dungeon","nobility"],5),new ce("kitchen",[],2,2,5,5,["stone tile"],t,[new J("oven",["There is a large wood-fired oven here.","There are several large ovens here.","Ovens line one of the walls.","A long-dormant oven sits against the back wall."],[],!1),new J("pantry cabinet",["There is a pantry cabinet here.","A pantry cabinet sits against one wall."],[],!0),new J("table",["There is a table here.","A table sits against one wall.","An assortment of kitchen utensils and tools sit on a large table here."],[],!1)],[],["rectangular"],["food","military"],5),new ce("laboratory",[],4,4,6,6,["stone tile"],t,[new J("lab table",["There is a large table here with a wide array of alchemical devices on it.","There are several tables here with various devices on them.","Tables with alchemical devices, books, and other items are arranged around the room."],[],!1),new J("specimen cabinet",["There is a large cabinet here.","There is a simple cabinet here, and the door is ajar.","There is a cabinet here."],[],!0)],[],["rectangular"],["alchemy","mage"],5),new ce("library",[],5,5,15,15,["stone tile"],t,[new J("bookcases",["There are many bookcases here.","There are a number of well-preserved bookcases here.","The walls are lined with bookcases."],[],!0),new J("table",["There are several tables here.","There is a table here with a large book open lying on it."],[],!1)],[],["rectangular","square"],["mage","nobility"],5),new ce("storeroom",[],2,2,6,6,["stone tile"],t,[new J("stacked boxes",["Many boxes are stacked here.","Boxes are stacked in corners here.","Crates and large boxes line the walls.","A few broken crates and boxes are strewn about."],[],!0)],[],["rectangular","square"],["dungeon"],20)]}function at(){let t=[];return t=t.concat(Ks()),t}function _t(t,e){for(let n=0;n<e.length;n++)if(e[n].name==t)return e[n];throw new Error(`Failed to find room theme with name ${t}.`)}function ye(t,e){let n=[];for(let s=0;s<e.length;s++)e[s].tags.includes(t)&&n.push(e[s]);return n}function Zs(){return new ce("entrance",[],2,2,4,4,["stone tile"],[],[new J("entrance",["The entrance to the dungeon is here.","The stairs out of the dungeon are here.","There is a set of stairs here leading out of the dungeon.","The stairs leading out of the dungeon are here."],[],!1)],[],["rectangular","square"],["dungeon","entrance"],10)}function Js(){let t=Ot(!1),e=He();e=Je("humanoid",e);let n=K.int(1,3),s=Gt("cult",t),r=st(3,s),a=Ge(3,4,s),i=rt(5,s),l=new et,c=["DEN","DOMAIN","LAIR"],h=["BALEFUL","VILE","DARK","DEMONIC"],u=["BROTHERHOOD","ORDER"];for(let b=0;b<c.length;b++)for(let I=0;I<h.length;I++)for(let $=0;$<u.length;$++)l.patterns.push(`THE ${c[b]} OF THE ${h[I]} ${u[$]}`);let m=jt("corruptible",e);m=ze(m,n);const p=at();let T=_t("barracks",p),w=_t("altar room",p),g=ye("cult",p),v=ye("dungeon",p);return g=g.concat(v),new nt("cult","forest",l,r,a,i,m,["stone tile"],g,[new kt(w,1,1),new kt(T,1,1)])}function zs(){let t=Ot(!1),e=He();e=Je("humanoid",e);let n=K.int(1,3),s=Gt("martial",t),r=jt("martial",e);r=ze(r,n);for(let b=0;b<s.length;b++)s[b].tags.includes("soldiers")&&(s[b].commonality+=20);let a=st(3,s),i=Ge(3,4,s),l=rt(5,s),c=new et,h=["FORTRESS","STRONGHOLD","DOMAIN","DOMINION","LAIR"],u=["DARK","DREAD","DIRE","IRON","BLOODY","CURSED"],m=["LEGION","ARMY"];for(let b=0;b<h.length;b++)for(let I=0;I<u.length;I++)for(let $=0;$<m.length;$++)c.patterns.push(`THE ${h[b]} OF THE ${u[I]} ${m[$]}`);const p=at();let T=_t("barracks",p),w=ye("dungeon",p),v=ye("military",p).concat(w);return new nt("fortress","hill",c,a,i,l,r,["stone tile"],v,[new kt(T,1,2)])}function er(){let t=Ot(!1),e=He();e=Je("humanoid",e);let n=K.int(1,2),s=e;s=ze(s,n);let r=Gt("magic",t);r=r.concat($t());let a=st(3,r),i=Ge(3,4,r),l=rt(5,r),c=new et,h=["LABORATORY","LAIR","DOMAIN","DOMINION"],u=["MAD","DREAD","DARK","CRAZED","RECLUSIVE","DOOMED","CURSED"],m=["ARCHMAGE","SORCERER","WIZARD","WITCH","WARLOCK"];for(let g=0;g<h.length;g++)for(let v=0;v<u.length;v++)for(let b=0;b<m.length;b++)c.patterns.push(`THE ${h[g]} OF THE ${u[v]} ${m[b]}`);const p=at(),T=ye("dungeon",p);let w=ye("mage",p);return w=w.concat(T),new nt("mage lair","forest",c,a,i,l,s,["stone tile","marble"],w,[])}function tr(){let t=He();t=Je("humanoid",t);let e=K.int(1,2),n=jt("martial",t);n=ze(n,e);let s=$t();s=s.concat(Rn());let r=st(2,s),a=Ge(3,4,s),i=rt(5,s),l=new et,c=["TOMB","CRYPT","CATACOMBS","MAUSOLEUM","BARROWS"],h=["THE DAMNED","THE FORGOTTEN","THE LOST","WAKING NIGHTMARES","FORGOTTEN SOULS","LOST SOULS"];for(let T=0;T<c.length;T++)for(let w=0;w<h.length;w++)l.patterns.push(`THE ${c[T]} OF ${h[w]}`);const u=at(),m=ye("dungeon",u);let p=ye("tomb",u);return p=p.concat(m),new nt("tomb","hill",l,r,a,i,n,["stone tile"],p,[])}function nr(){let t=[];return t.push(Js()),t.push(zs()),t.push(er()),t.push(tr()),t}class Lt{constructor(){o(this,"minRoom");o(this,"maxRoom");o(this,"treasure");o(this,"behavior");o(this,"value");o(this,"isCarried");o(this,"isHidden");this.minRoom=-1,this.maxRoom=-1,this.value=1,this.treasure=[],this.isCarried=!1,this.isHidden=!1}}class sr{constructor(){o(this,"minRoom");o(this,"maxRoom");o(this,"encounterConfig");o(this,"treasureSpawns");this.minRoom=-1,this.maxRoom=-1,this.treasureSpawns=[]}}function rr(){return[new Wt("brazier",t=>{let e=new J("brazier",["There is a large lit brazier in the middle of the room.","There are lit braziers around the room here."],[],!1);return t.features.push(e.generate()),t.lightLevel+=2,t},["light"]),new Wt("torches",t=>{let e=new J("torches",["Torches line the walls.","A few torches sit in sconces on the walls."],[],!1);return t.features.push(e.generate()),t.lightLevel+=1,t},["light"])]}function ar(t,e){let n=[];for(let s=0;s<e.length;s++)e[s].tags.includes(t)&&n.push(e[s]);return n}class S{constructor(e,n){o(this,"commonality");o(this,"generator");this.commonality=e,this.generator=n}}class be{constructor(e){o(this,"entries");this.entries=e}}class jn{constructor(){o(this,"tables");this.tables=[]}}class Cn{constructor(e){o(this,"config");this.config=e}generate(){let e=[];for(const n of this.config.tables){let s=n.entries,i=Ne(s).generator.generate();e=e.concat(i)}return e}}class lr{constructor(){o(this,"name");o(this,"description");o(this,"value");o(this,"lockId");o(this,"quality");o(this,"tags")}}class ir{constructor(){o(this,"name");o(this,"description");o(this,"value");o(this,"quality");o(this,"tags");this.name="an art object",this.description="an art object",this.value=10,this.quality=2,this.tags=["art object"]}}class xt{constructor(e,n,s){o(this,"minValue");o(this,"maxValue");o(this,"count");this.minValue=e,this.maxValue=n,this.count=s}generate(){let e=[];for(let n=0;n<this.count;n++){let s=new ir;s.value=K.int(this.minValue,this.maxValue),s.name=or(this.minValue,this.maxValue);let r=Ve(s.value,!1,!1,!1);s.description=`${Ee(s.name)} ${s.name} worth ${r}`,e.push(s)}return e}}function or(t,e){const n=hr();let s=[];for(let r=0;r<n.length;r++)n[r].value>=t&&n[r].value<=e&&s.push(n[r].name);return k(s)}function hr(){return[{name:"silver ewer",value:2500},{name:"carved bone statuette",value:2500},{name:"small gold bracelet",value:2500},{name:"cloth-of-gold vestments",value:2500},{name:"black velvet mask stitched with silver thread",value:2500},{name:"copper chalice with silver filigree",value:2500},{name:"pair of engraved bone dice",value:2500},{name:"small mirror set in a painted wood frame",value:2500},{name:"embroidered silk handkerchief",value:2500},{name:"gold locket with a painted portrait inside",value:2500},{name:"gold ring set with bloodstones",value:25e3},{name:"carved ivory statuette",value:25e3},{name:"large gold bracelet",value:25e3},{name:"silver necklace with a gemstone pendant",value:25e3},{name:"bronze crown",value:25e3},{name:"silk robe with gold embroidery",value:25e3},{name:"large well-made tapestry",value:25e3},{name:"brass mug with jade inlay",value:25e3},{name:"box of turquoise animal figurines",value:25e3},{name:"gold bird cage with electrum filigree",value:25e3},{name:"silver chalice set with moonstones",value:75e3},{name:"silver-plated steel longsword with jet set in hilt",value:75e3},{name:"carved harp of exotic wood with ivory inlay and zircon gems",value:75e3},{name:"small gold idol",value:75e3},{name:"gold dragon comb set with red garnets as eyes",value:75e3},{name:"bottle stopper cork embossed with gold leaf and set with amethysts",value:75e3},{name:"ceremonial electrum dagger with a black pearl in the pommel",value:75e3},{name:"silver and gold brooch",value:75e3},{name:"obsidian statuette with gold fittings and inlay",value:75e3},{name:"painted gold war mask",value:75e3},{name:"fine gold chain set with a fire opal",value:25e4},{name:"old masterpiece painting",value:25e4},{name:"embroidered silk and velvet mantle set with numerous moonstones",value:25e4},{name:"platinum bracelet set with a sapphire",value:25e4},{name:"embroidered glove set with jewel chips",value:25e4},{name:"jeweled anklet",value:25e4},{name:"gold music box",value:25e4},{name:"gold circlet set with four aquamarines",value:25e4},{name:"eye patch with a mock eye set in blue sapphire and moonstone",value:25e4},{name:"necklace string of small pink pearls",value:25e4},{name:"jeweled gold crown",value:75e4},{name:"jeweled platinum ring",value:75e4},{name:"small gold stattuete set with rubies",value:75e4},{name:"gold cup set with emeralds",value:75e4},{name:"painted gold child's sarcophagus",value:75e4},{name:"jade game board with solid gold playing pieces",value:75e4},{name:"bejeweled ivory drinking horn with gold filigree",value:75e4}]}class cr{constructor(){o(this,"name");o(this,"description");o(this,"value");o(this,"quality");o(this,"tags");this.name="a bag of coins",this.description="a bag of coins",this.value=10,this.quality=1,this.tags=["bag of coins"]}}class ne{constructor(e,n,s,r,a){o(this,"cp");o(this,"sp");o(this,"ep");o(this,"gp");o(this,"pp");this.cp=e,this.sp=n,this.ep=s,this.gp=r,this.pp=a}generate(){let e=new cr,n=0,s=0,r=0,a=0,i=0;this.cp!=""&&(n=ie(this.cp)),this.sp!=""&&(s=ie(this.sp)),this.ep!=""&&(r=ie(this.ep)),this.gp!=""&&(a=ie(this.gp)),this.pp!=""&&(i=ie(this.pp)),e.value=n+s*10+r*50+a*100+i*1e3;let l=n+s+r+a+i,c=k(["bag","pouch","purse"]);l>1e3?c=k(["chest","large chest"]):l>250?c=k(["chest","satchel"]):l>100&&(c=k(["sack","box"])),e.name=`a ${c} of coins`,e.description="a "+c+" of coins "+k(["containing","holding","with"])+" ";let h=[];return n>0&&h.push(`${new Intl.NumberFormat().format(n)} cp`),s>0&&h.push(`${new Intl.NumberFormat().format(s)} sp`),r>0&&h.push(`${new Intl.NumberFormat().format(r)} ep`),a>0&&h.push(`${new Intl.NumberFormat().format(a)} gp`),i>0&&h.push(`${new Intl.NumberFormat().format(i)} pp`),e.description+=wn(h),[e]}}class ur{constructor(){o(this,"name");o(this,"description");o(this,"value");o(this,"quality");o(this,"tags");this.name="a gem",this.description="a gem",this.value=10,this.quality=2,this.tags=["gem"]}}class Ze{constructor(e,n,s){o(this,"minValue");o(this,"maxValue");o(this,"gemCount");this.minValue=e,this.maxValue=n,this.gemCount=s}generate(){let e=[];for(let n=0;n<this.gemCount;n++){let s=new ur;s.value=K.int(this.minValue,this.maxValue),s.value<1100?s.name=k(mr()):s.value<8100?s.name=k(fr()):s.value<15100?s.name=k(dr()):s.value<50100?s.name=k(gr()):s.value<100100?s.name=k(pr()):s.name=k(wr());let r=Ve(s.value,!1,!1,!1);s.description=`${Ee(s.name)} ${s.name} worth ${r}`,e.push(s)}return e}}function mr(){return["banded agate","eye agate","moss agate","azurite","blue quartz","hematite","lapis lazuli","malachite","obsidian","rhodochrosite","tiger eye","turquoise","irregular freshwater pearl"]}function fr(){return["bloodstone","carnelian","chalcedony","chrysoprase","citrine","jasper","moonstone","onyx","quartz","sardonyx","star rose quartz","zircon"]}function dr(){return["amber","amethyst","chrysoberyl","coral","garnet","jade","jet","pearl","spinel","tourmaline"]}function gr(){return["alexandrite","aquamarine","black pearl","blue spinel","peridot","topaz"]}function pr(){return["black opal","blue sapphire","emerald","fire opal","opal","star ruby","star sapphire","yellow sapphire"]}function wr(){return["black sapphire","diamond","jacinth","ruby"]}class br{constructor(e,n,s){o(this,"minValue");o(this,"maxValue");o(this,"count");this.minValue=e,this.maxValue=n,this.count=s}generate(){let e=[],n=Qn();for(let s=0;s<this.count;s++){let r=new xn;r.pattern=k(n),r.useMutator=!0,r.minQuality=2,r.maxQuality=5,r.minValue=this.minValue,r.maxValue=this.maxValue;let i=new bn(r).generate(),l=Ve(i.value,!1,!1,!1);i.description=`${Ee(i.name)} ${i.name} worth ${l}`,e.push(i)}return e}}function vr(){return[new be([new S(30,new ne("6d6x100","3d6x100","","2d6x10",""))]),new be([new S(8,new Ze(900,1e3,ie("2d6"))),new S(12,new xt(1500,3500,ie("2d4"))),new S(8,new Ze(4500,5e3,ie("2d6")))])]}function yr(){return[new be([new S(30,new ne("5d6","","","","")),new S(30,new ne("","4d6","","","")),new S(10,new ne("","","3d6","","")),new S(25,new ne("","","","3d6","")),new S(5,new ne("","","","","1d6"))])]}function Tr(){return[new be([new S(30,new ne("","","","4d6x1000","5d6x100"))]),new be([new S(20,new xt(2e4,3e4,ie("2d4"))),new S(30,new Ze(45e3,5e4,ie("3d6"))),new S(8,new Ze(95e3,1e5,ie("3d6"))),new S(10,new xt(7e4,8e4,ie("2d4")))]),new be([new S(5,new br(1e4,3e4,ie("1d6")))])]}function kr(){return[new be([new S(20,new ne("","4d6x100","","1d6x100","")),new S(15,new ne("","","1d6x100","1d6x100","")),new S(40,new ne("","","","2d6x100","1d6x10")),new S(25,new ne("","","","2d6x100","2d6x10"))])]}function _r(){return[new be([new S(30,new ne("4d6x100","","1d6x10","","")),new S(30,new ne("","6d6x10","","2d6x10","")),new S(10,new ne("","","1d6x100","2d6x10","")),new S(25,new ne("","","","4d6x10","")),new S(5,new ne("","","","2d6x10","3d6"))])]}class xr{constructor(e){o(this,"config");this.config=e}generate(){let e=new Cs;e.environment=k(["arctic","coastal","desert","forest","grassland","hill","mountain","urban","underdark"]),e.tiles=Dr(this.config.width,this.config.height);let n=nr();e.theme=k(n),e.name=e.theme.nameGenerator.generate(1)[0],e=Er(e,this.config.width,this.config.height);let s=K.int(this.config.minRooms,this.config.maxRooms);e=Gr(e,s,this.config.width,this.config.height);for(let c=0;c<2;c++)e=Vs(e);e=Rr(e);let r=$r(e),a=[],i=0;for(let c=1;c<e.rooms.length;c++){let h=oe(100),u="none";if(c==e.rooms.length-1?u="boss":h>90?u="strong":h>30&&(u="weak"),u!="none"){let m=Cr(e,u,c);a.push(m),i++}}let l=Ar(e);return e=jr(e,a),e=Or(e,r),e=Lr(e,l),e.averageThreatLevel=Math.floor(e.totalThreatLevel/i),e}}function Rr(t){let e=rr(),n=ar("light",e);for(let s=0;s<t.rooms.length;s++)if(oe(100)>60){let r=k(n);t.rooms[s]=r.mutate(t.rooms[s])}return t}function Rt(t,e){for(let n=0;n<t.vertices.length;n++)e[t.vertices[n].y][t.vertices[n].x]=Ct;return e}function jr(t,e){for(let n=0;n<e.length;n++){let s=e[n].maxRoom;s==-1&&(s=t.rooms.length-1);let r=e[n].minRoom,a=K.int(r,s),i=new ys;i.config=e[n].encounterConfig;let l=i.generate();if(t.rooms[a].encounters.push(l),t.totalThreatLevel+=l.totalThreatLevel,e[n].treasureSpawns.length>0)for(let c=0;c<e[n].treasureSpawns.length;c++){let h=e[n].treasureSpawns[c];for(let u=0;u<l.groups.length;u++)for(let m=0;m<l.groups[u].mobs.length;m++)oe(100)>50&&l.groups[u].mobs[m].carried.push(k(h.treasure))}}return t}function Cr(t,e,n){let s=new vs;s.environment=t.environment,s.sentientOptions=t.theme.sentientOptions;let r=yr();e=="boss"?(s.template=Ne(t.theme.bossEncounterTemplates),s.minThreatLevel=3,s.maxThreatLevel=10,r=kr()):e=="strong"?(s.template=Ne(t.theme.strongEncounterTemplates),r=_r()):s.template=Ne(t.theme.weakEncounterTemplates);let a=new sr;a.minRoom=n,a.maxRoom=n,a.encounterConfig=s;let i=!1;if(a.encounterConfig.template===null)throw new Error("Encounter template is null");for(let m=0;m<a.encounterConfig.template.groupTemplates.length;m++)a.encounterConfig.template.groupTemplates[m].isSentient&&(i=!0);let l=new jn;l.tables=r;let h=new Cn(l).generate(),u=new Lt;return u.treasure=u.treasure.concat(h),i&&a.treasureSpawns.push(u),a}function Er(t,e,n){let s=Zs();s.flooringOptions=t.theme.flooringOptions;let r=new kn(e,n,s),i=new _n(r).generate();return i.id=0,t.rooms.push(i),t.tiles=Rt(i,t.tiles),t}function $r(t){let e=[];for(let n=0;n<t.doors.length;n++)if(t.doors[n].lock!==null){let s=new Lt;s.behavior=`This key unlocks the door between room ${t.doors[n].room1+1} and room ${t.doors[n].room2+1} in ${t.name}.`,s.minRoom=0,s.maxRoom=t.doors[n].room1;let r=new lr;r.name="a key";let a=t.doors[n].lock;if(a===null)throw new Error("Door has no lock but expected one");r.lockId=a.id;let i=k([`a ${k(["simple","plain","rough"])} key`,`a ${k(["small","ornate","shiny","tarnished"])} key`]);r.description=`${i} that unlocks the door between room ${t.doors[n].room1+1} and room ${t.doors[n].room2+1}`,r.value=K.int(1,10),s.treasure.push(r),e.push(s)}return e}function Or(t,e){for(let n=0;n<e.length;n++){let s=K.int(e[n].minRoom,e[n].maxRoom);if(t.rooms[s].encounters.length>0){let r=k(t.rooms[s].encounters);k(r.groups[0].mobs).carried.push(e[n].treasure[0])}else t.rooms[s].treasureCaches.push(e[n].treasure[0].description)}return t}function Gr(t,e,n,s){let r=0,a=!0,i=0,l=5;for(let c=0;c<t.theme.requiredRooms.length;c++){let h=t.theme.requiredRooms[c],u=K.int(h.minCount,h.maxCount);for(let m=0;m<u;m++){let p=Pt(n,s,h.theme,t.rooms);p===null?console.debug("Room broke",h,t.theme.name):(r+=1,p.id=r,t.rooms.push(p),t.tiles=Rt(p,t.tiles))}}for(;a;)if(t.rooms.length>=e)a=!1;else{let c=Ne(t.theme.roomThemes);c.environment==t.theme.mainEnvironment&&(c.flooringOptions=t.theme.flooringOptions);let h=Pt(n,s,c,t.rooms);h===null?i++:(r+=1,h.id=r,t.rooms.push(h),t.tiles=Rt(h,t.tiles)),i>l&&(a=!1)}return t}function Lr(t,e){for(let n=0;n<e.length;n++){let s=e[n].maxRoom;s==-1&&(s=t.rooms.length-1);let r=e[n].minRoom;r==-1&&(r=1);let a=K.int(r,s),i=[];for(const c of e[n].treasure)i.push(c.description);let l=wn(i);if(e[n].isHidden)l+=", hidden somewhere in the room",t.rooms[a].treasureCaches.push(l);else if(e[n].isCarried){let c=k(t.rooms[a].encounters);k(c.groups[0].mobs).carried.push(l)}else{let c=[];for(let h=0;h<t.rooms[a].features.length;h++)t.rooms[a].features[h].isContainer&&c.push(h);c.length>0&&oe(100)>10&&(l+=", inside "+t.rooms[a].features[k(c)].name),t.rooms[a].treasureCaches.push(l)}}return t}function Ar(t){let e=100,n=[],s=vr(),r=Tr();for(let a=1;a<t.rooms.length;a++)if(oe(100)>e){let i=new jn;i.tables=s,a==t.rooms.length-1&&(i.tables=r);let c=new Cn(i).generate(),h=new Lt;h.treasure=h.treasure.concat(c),n.push(h),e=100}else e-=2;return n}function Dr(t,e){let n=[];for(let s=0;s<e;s++){let r=[];n[s]=r;for(let a=0;a<t;a++)n[s][a]=yt}return n}class Mr{constructor(e,n,s,r){o(this,"tileSize");o(this,"mapHeight");o(this,"mapWidth");o(this,"imageWidth");o(this,"imageHeight");this.imageWidth=e,this.imageHeight=n,this.mapHeight=s,this.mapWidth=r,this.tileSize=e/r}render(e,n){const s=n.getContext("2d");if(s==null)throw new Error("Could not get 2d context from canvas");s.fillStyle="white",s.fillRect(0,0,this.imageWidth,this.imageHeight);for(let r=0;r<this.mapHeight;r++)for(let a=0;a<this.mapWidth;a++){let i=e.tiles[r][a];i==Tt?Ir(s,a,r,this.tileSize):i==Et?qr(s,a,r,this.tileSize):i==Ct?Hr(s,a,r,this.tileSize):i==Tn?Nr(s,a,r,this.tileSize):i==yn?Br(s,a,r,this.tileSize):Vr(s,a,r,this.tileSize)}for(let r=0;r<e.rooms.length;r++){let a=e.rooms[r].minX*this.tileSize+(e.rooms[r].maxX-e.rooms[r].minX)*this.tileSize/2+this.tileSize*.25,i=e.rooms[r].minY*this.tileSize+(e.rooms[r].maxY-e.rooms[r].minY)*this.tileSize/2+this.tileSize*.8;s.beginPath(),s.strokeStyle="#5698DA",s.fillStyle="#5698DA",s.font="20px Eczar",s.fillText(`${e.rooms[r].id+1}`,a,i),s.strokeText(`${e.rooms[r].id+1}`,a,i)}}}function qe(t,e,n,s){let r=e*s,a=n*s;t.fillRect(r,a,s,s),t.strokeStyle="#85BBF1",t.strokeRect(r,a,s,s)}function Ir(t,e,n,s){t.fillStyle="white",t.fillRect(e*s,n*s,s,s),qe(t,e,n,s),t.beginPath(),t.strokeStyle="#85BBF1";let r=new W(e*s+s/2,n*s),a=new W(e*s+s/2,n*s+s);t.moveTo(r.x,r.y),t.lineTo(a.x,a.y),t.stroke(),t.fillRect(e*s+s*.35,n*s+s*.2,s*.3,s*.6),t.strokeRect(e*s+s*.35,n*s+s*.2,s*.3,s*.6)}function Nr(t,e,n,s){t.fillStyle="white",t.fillRect(e*s,n*s,s,s),qe(t,e,n,s),t.beginPath(),t.strokeStyle="#85BBF1";let r=new W(e*s+s/2,n*s),a=new W(e*s+s/2,n*s+s);t.moveTo(r.x,r.y),t.lineTo(a.x,a.y),t.stroke(),t.fillStyle="#85BBF1",t.font="12px sans-serif",t.fillText("S",e*s+s/3.5,n*s+s/1.3)}function Vr(t,e,n,s){t.fillStyle="#A4CFF9";let r=e*s,a=n*s;t.fillRect(r,a,s,s)}function Hr(t,e,n,s){t.fillStyle="white";let r=e*s,a=n*s;t.fillRect(r,a,s,s),qe(t,e,n,s)}function qr(t,e,n,s){t.fillStyle="white",t.fillRect(e*s,n*s,s,s),qe(t,e,n,s),t.beginPath(),t.strokeStyle="#85BBF1";let r=new W(e*s,n*s+s/2),a=new W(e*s+s,n*s+s/2);t.moveTo(r.x,r.y),t.lineTo(a.x,a.y),t.stroke(),t.fillRect(e*s+s*.2,n*s+s*.35,s*.6,s*.3),t.strokeRect(e*s+s*.2,n*s+s*.35,s*.6,s*.3)}function Br(t,e,n,s){t.fillStyle="white",t.fillRect(e*s,n*s,s,s),qe(t,e,n,s),t.beginPath(),t.strokeStyle="#85BBF1";let r=new W(e*s,n*s+s/2),a=new W(e*s+s,n*s+s/2);t.moveTo(r.x,r.y),t.lineTo(a.x,a.y),t.stroke(),t.save(),t.translate(e*s+s/2,n*s+s/2),t.rotate(90*Math.PI/180),t.fillStyle="#85BBF1",t.font="12px sans-serif",t.fillText("S",-t.measureText("S").width/2,4),t.restore()}const{document:Qt}=In;function St(t,e,n){const s=t.slice();return s[13]=e[n],s}function Kt(t,e,n){const s=t.slice();return s[16]=e[n],s}function Zt(t,e,n){const s=t.slice();return s[19]=e[n],s}function Jt(t,e,n){const s=t.slice();return s[22]=e[n],s}function zt(t,e,n){const s=t.slice();return s[25]=e[n],s}function en(t,e,n){const s=t.slice();return s[28]=e[n],s}function tn(t,e,n){const s=t.slice();return s[31]=e[n],s}function nn(t,e,n){const s=t.slice();return s[34]=e[n],s}function sn(t){let e,n="This room is dark.";return{c(){e=C("p"),e.textContent=n,this.h()},l(s){e=E(s,"P",{class:!0,"data-svelte-h":!0}),ae(e)!=="svelte-94wbjp"&&(e.textContent=n),this.h()},h(){y(e,"class","svelte-jl2xcj")},m(s,r){Q(s,e,r)},d(s){s&&_(e)}}}function rn(t){let e=t[34].description+" ",n;return{c(){n=Y(e)},l(s){n=F(s,e)},m(s,r){Q(s,n,r)},p(s,r){r[0]&8&&e!==(e=s[34].description+" ")&&z(n,e)},d(s){s&&_(n)}}}function an(t){let e,n=t[13].secrets+"",s;return{c(){e=C("div"),s=Y(n),this.h()},l(r){e=E(r,"DIV",{class:!0});var a=U(e);s=F(a,n),a.forEach(_),this.h()},h(){y(e,"class","room-secrets svelte-jl2xcj")},m(r,a){Q(r,e,a),f(e,s)},p(r,a){a[0]&8&&n!==(n=r[13].secrets+"")&&z(s,n)},d(r){r&&_(e)}}}function Yr(t){let e,n=Ee(t[22].name)+"",s;return{c(){e=Y("is "),s=Y(n)},l(r){e=F(r,"is "),s=F(r,n)},m(r,a){Q(r,e,a),Q(r,s,a)},p(r,a){a[0]&8&&n!==(n=Ee(r[22].name)+"")&&z(s,n)},d(r){r&&(_(e),_(s))}}}function Fr(t){let e,n=t[22].mobs.length+"",s;return{c(){e=Y("are "),s=Y(n)},l(r){e=F(r,"are "),s=F(r,n)},m(r,a){Q(r,e,a),Q(r,s,a)},p(r,a){a[0]&8&&n!==(n=r[22].mobs.length+"")&&z(s,n)},d(r){r&&(_(e),_(s))}}}function ln(t){let e,n="Abilities:",s,r,a=se(t[25].abilities),i=[];for(let l=0;l<a.length;l+=1)i[l]=on(tn(t,a,l));return{c(){e=C("p"),e.textContent=n,s=G(),r=C("ul");for(let l=0;l<i.length;l+=1)i[l].c();this.h()},l(l){e=E(l,"P",{class:!0,"data-svelte-h":!0}),ae(e)!=="svelte-rzkllc"&&(e.textContent=n),s=L(l),r=E(l,"UL",{class:!0});var c=U(r);for(let h=0;h<i.length;h+=1)i[h].l(c);c.forEach(_),this.h()},h(){y(e,"class","svelte-jl2xcj"),y(r,"class","svelte-jl2xcj")},m(l,c){Q(l,e,c),Q(l,s,c),Q(l,r,c);for(let h=0;h<i.length;h+=1)i[h]&&i[h].m(r,null)},p(l,c){if(c[0]&8){a=se(l[25].abilities);let h;for(h=0;h<a.length;h+=1){const u=tn(l,a,h);i[h]?i[h].p(u,c):(i[h]=on(u),i[h].c(),i[h].m(r,null))}for(;h<i.length;h+=1)i[h].d(1);i.length=a.length}},d(l){l&&(_(e),_(s),_(r)),ve(i,l)}}}function on(t){let e,n=t[31]+"",s;return{c(){e=C("li"),s=Y(n),this.h()},l(r){e=E(r,"LI",{class:!0});var a=U(e);s=F(a,n),a.forEach(_),this.h()},h(){y(e,"class","svelte-jl2xcj")},m(r,a){Q(r,e,a),f(e,s)},p(r,a){a[0]&8&&n!==(n=r[31]+"")&&z(s,n)},d(r){r&&_(e)}}}function hn(t){let e,n="Carrying the following:",s,r,a=se(t[25].carried),i=[];for(let l=0;l<a.length;l+=1)i[l]=cn(en(t,a,l));return{c(){e=C("p"),e.textContent=n,s=G(),r=C("ul");for(let l=0;l<i.length;l+=1)i[l].c();this.h()},l(l){e=E(l,"P",{class:!0,"data-svelte-h":!0}),ae(e)!=="svelte-z9itxp"&&(e.textContent=n),s=L(l),r=E(l,"UL",{class:!0});var c=U(r);for(let h=0;h<i.length;h+=1)i[h].l(c);c.forEach(_),this.h()},h(){y(e,"class","svelte-jl2xcj"),y(r,"class","svelte-jl2xcj")},m(l,c){Q(l,e,c),Q(l,s,c),Q(l,r,c);for(let h=0;h<i.length;h+=1)i[h]&&i[h].m(r,null)},p(l,c){if(c[0]&8){a=se(l[25].carried);let h;for(h=0;h<a.length;h+=1){const u=en(l,a,h);i[h]?i[h].p(u,c):(i[h]=cn(u),i[h].c(),i[h].m(r,null))}for(;h<i.length;h+=1)i[h].d(1);i.length=a.length}},d(l){l&&(_(e),_(s),_(r)),ve(i,l)}}}function cn(t){let e,n=t[28].description+"",s,r,a=Ve(t[28].value,!1,!1,!1)+"",i;return{c(){e=C("li"),s=Y(n),r=Y(", worth "),i=Y(a),this.h()},l(l){e=E(l,"LI",{class:!0});var c=U(e);s=F(c,n),r=F(c,", worth "),i=F(c,a),c.forEach(_),this.h()},h(){y(e,"class","svelte-jl2xcj")},m(l,c){Q(l,e,c),f(e,s),f(e,r),f(e,i)},p(l,c){c[0]&8&&n!==(n=l[28].description+"")&&z(s,n),c[0]&8&&a!==(a=Ve(l[28].value,!1,!1,!1)+"")&&z(i,a)},d(l){l&&_(e)}}}function un(t){let e,n,s=t[25].name+"",r,a,i=t[25].summary+"",l,c,h=t[25].threatLevel+"",u,m,p,T,w=t[25].abilities.length>0&&ln(t),g=t[25].carried.length>0&&hn(t);return{c(){e=C("div"),n=C("h4"),r=Y(s),a=Y(", "),l=Y(i),c=Y(" (TL "),u=Y(h),m=Y(")"),p=G(),w&&w.c(),T=G(),g&&g.c(),this.h()},l(v){e=E(v,"DIV",{class:!0});var b=U(e);n=E(b,"H4",{class:!0});var I=U(n);r=F(I,s),a=F(I,", "),l=F(I,i),c=F(I," (TL "),u=F(I,h),m=F(I,")"),I.forEach(_),p=L(b),w&&w.l(b),T=L(b),g&&g.l(b),b.forEach(_),this.h()},h(){y(n,"class","svelte-jl2xcj"),y(e,"class","mob svelte-jl2xcj")},m(v,b){Q(v,e,b),f(e,n),f(n,r),f(n,a),f(n,l),f(n,c),f(n,u),f(n,m),f(e,p),w&&w.m(e,null),f(e,T),g&&g.m(e,null)},p(v,b){b[0]&8&&s!==(s=v[25].name+"")&&z(r,s),b[0]&8&&i!==(i=v[25].summary+"")&&z(l,i),b[0]&8&&h!==(h=v[25].threatLevel+"")&&z(u,h),v[25].abilities.length>0?w?w.p(v,b):(w=ln(v),w.c(),w.m(e,T)):w&&(w.d(1),w=null),v[25].carried.length>0?g?g.p(v,b):(g=hn(v),g.c(),g.m(e,null)):g&&(g.d(1),g=null)},d(v){v&&_(e),w&&w.d(),g&&g.d()}}}function mn(t){let e,n,s,r=t[22].name+"",a,i,l,c,h;function u(g,v){return g[22].mobs.length>1?Fr:Yr}let m=u(t),p=m(t),T=se(t[22].mobs),w=[];for(let g=0;g<T.length;g+=1)w[g]=un(zt(t,T,g));return{c(){e=C("p"),n=Y("There "),p.c(),s=G(),a=Y(r),i=Y(" here."),l=G(),c=C("div");for(let g=0;g<w.length;g+=1)w[g].c();h=G(),this.h()},l(g){e=E(g,"P",{class:!0});var v=U(e);n=F(v,"There "),p.l(v),s=L(v),a=F(v,r),i=F(v," here."),v.forEach(_),l=L(g),c=E(g,"DIV",{class:!0});var b=U(c);for(let I=0;I<w.length;I+=1)w[I].l(b);h=L(b),b.forEach(_),this.h()},h(){y(e,"class","svelte-jl2xcj"),y(c,"class","mobs svelte-jl2xcj")},m(g,v){Q(g,e,v),f(e,n),p.m(e,null),f(e,s),f(e,a),f(e,i),Q(g,l,v),Q(g,c,v);for(let b=0;b<w.length;b+=1)w[b]&&w[b].m(c,null);f(c,h)},p(g,v){if(m===(m=u(g))&&p?p.p(g,v):(p.d(1),p=m(g),p&&(p.c(),p.m(e,s))),v[0]&8&&r!==(r=g[22].name+"")&&z(a,r),v[0]&8){T=se(g[22].mobs);let b;for(b=0;b<T.length;b+=1){const I=zt(g,T,b);w[b]?w[b].p(I,v):(w[b]=un(I),w[b].c(),w[b].m(c,h))}for(;b<w.length;b+=1)w[b].d(1);w.length=T.length}},d(g){g&&(_(e),_(l),_(c)),p.d(),ve(w,g)}}}function fn(t){let e,n=se(t[19].groups),s=[];for(let r=0;r<n.length;r+=1)s[r]=mn(Jt(t,n,r));return{c(){for(let r=0;r<s.length;r+=1)s[r].c();e=Ht()},l(r){for(let a=0;a<s.length;a+=1)s[a].l(r);e=Ht()},m(r,a){for(let i=0;i<s.length;i+=1)s[i]&&s[i].m(r,a);Q(r,e,a)},p(r,a){if(a[0]&8){n=se(r[19].groups);let i;for(i=0;i<n.length;i+=1){const l=Jt(r,n,i);s[i]?s[i].p(l,a):(s[i]=mn(l),s[i].c(),s[i].m(e.parentNode,e))}for(;i<s.length;i+=1)s[i].d(1);s.length=n.length}},d(r){r&&_(e),ve(s,r)}}}function dn(t){let e,n,s="Treasure",r,a,i=se(t[13].treasureCaches),l=[];for(let c=0;c<i.length;c+=1)l[c]=gn(Kt(t,i,c));return{c(){e=C("div"),n=C("h4"),n.textContent=s,r=G(),a=C("ul");for(let c=0;c<l.length;c+=1)l[c].c();this.h()},l(c){e=E(c,"DIV",{class:!0});var h=U(e);n=E(h,"H4",{class:!0,"data-svelte-h":!0}),ae(n)!=="svelte-1y7msnj"&&(n.textContent=s),r=L(h),a=E(h,"UL",{class:!0});var u=U(a);for(let m=0;m<l.length;m+=1)l[m].l(u);u.forEach(_),h.forEach(_),this.h()},h(){y(n,"class","svelte-jl2xcj"),y(a,"class","svelte-jl2xcj"),y(e,"class","treasure svelte-jl2xcj")},m(c,h){Q(c,e,h),f(e,n),f(e,r),f(e,a);for(let u=0;u<l.length;u+=1)l[u]&&l[u].m(a,null)},p(c,h){if(h[0]&8){i=se(c[13].treasureCaches);let u;for(u=0;u<i.length;u+=1){const m=Kt(c,i,u);l[u]?l[u].p(m,h):(l[u]=gn(m),l[u].c(),l[u].m(a,null))}for(;u<l.length;u+=1)l[u].d(1);l.length=i.length}},d(c){c&&_(e),ve(l,c)}}}function gn(t){let e,n=t[16]+"",s;return{c(){e=C("li"),s=Y(n),this.h()},l(r){e=E(r,"LI",{class:!0});var a=U(e);s=F(a,n),a.forEach(_),this.h()},h(){y(e,"class","svelte-jl2xcj")},m(r,a){Q(r,e,a),f(e,s)},p(r,a){a[0]&8&&n!==(n=r[16]+"")&&z(s,n)},d(r){r&&_(e)}}}function pn(t){let e,n,s=t[13].id+1+"",r,a,i=qt(t[13].name)+"",l,c,h,u,m=t[13].description+"",p,T,w,g,v,b,I,$=t[13].lightLevel==0&&sn(),ue=se(t[13].features),X=[];for(let x=0;x<ue.length;x+=1)X[x]=rn(nn(t,ue,x));let P=t[13].secrets!=""&&an(t),fe=se(t[13].encounters),Z=[];for(let x=0;x<fe.length;x+=1)Z[x]=fn(Zt(t,fe,x));let H=t[13].treasureCaches.length>0&&dn(t);return{c(){e=C("div"),n=C("h3"),r=Y(s),a=Y(". "),l=Y(i),c=G(),$&&$.c(),h=G(),u=C("div"),p=Y(m),T=G();for(let x=0;x<X.length;x+=1)X[x].c();w=G(),P&&P.c(),g=G(),v=C("div");for(let x=0;x<Z.length;x+=1)Z[x].c();b=G(),H&&H.c(),I=G(),this.h()},l(x){e=E(x,"DIV",{class:!0});var O=U(e);n=E(O,"H3",{class:!0});var j=U(n);r=F(j,s),a=F(j,". "),l=F(j,i),j.forEach(_),c=L(O),$&&$.l(O),h=L(O),u=E(O,"DIV",{class:!0});var re=U(u);p=F(re,m),T=L(re);for(let me=0;me<X.length;me+=1)X[me].l(re);re.forEach(_),w=L(O),P&&P.l(O),g=L(O),v=E(O,"DIV",{class:!0});var he=U(v);for(let me=0;me<Z.length;me+=1)Z[me].l(he);he.forEach(_),b=L(O),H&&H.l(O),I=L(O),O.forEach(_),this.h()},h(){y(n,"class","svelte-jl2xcj"),y(u,"class","room-description svelte-jl2xcj"),y(v,"class","encounter svelte-jl2xcj"),y(e,"class","room svelte-jl2xcj")},m(x,O){Q(x,e,O),f(e,n),f(n,r),f(n,a),f(n,l),f(e,c),$&&$.m(e,null),f(e,h),f(e,u),f(u,p),f(u,T);for(let j=0;j<X.length;j+=1)X[j]&&X[j].m(u,null);f(e,w),P&&P.m(e,null),f(e,g),f(e,v);for(let j=0;j<Z.length;j+=1)Z[j]&&Z[j].m(v,null);f(e,b),H&&H.m(e,null),f(e,I)},p(x,O){if(O[0]&8&&s!==(s=x[13].id+1+"")&&z(r,s),O[0]&8&&i!==(i=qt(x[13].name)+"")&&z(l,i),x[13].lightLevel==0?$||($=sn(),$.c(),$.m(e,h)):$&&($.d(1),$=null),O[0]&8&&m!==(m=x[13].description+"")&&z(p,m),O[0]&8){ue=se(x[13].features);let j;for(j=0;j<ue.length;j+=1){const re=nn(x,ue,j);X[j]?X[j].p(re,O):(X[j]=rn(re),X[j].c(),X[j].m(u,null))}for(;j<X.length;j+=1)X[j].d(1);X.length=ue.length}if(x[13].secrets!=""?P?P.p(x,O):(P=an(x),P.c(),P.m(e,g)):P&&(P.d(1),P=null),O[0]&8){fe=se(x[13].encounters);let j;for(j=0;j<fe.length;j+=1){const re=Zt(x,fe,j);Z[j]?Z[j].p(re,O):(Z[j]=fn(re),Z[j].c(),Z[j].m(v,null))}for(;j<Z.length;j+=1)Z[j].d(1);Z.length=fe.length}x[13].treasureCaches.length>0?H?H.p(x,O):(H=dn(x),H.c(),H.m(e,I)):H&&(H.d(1),H=null)},d(x){x&&_(e),$&&$.d(),ve(X,x),P&&P.d(),ve(Z,x),H&&H.d()}}}function Xr(t){let e,n,s,r="Dungeon Generator",a,i,l="A dungeon generator.",c,h,u,m="Random Seed",p,T,w,g,v,b="Min. Rooms",I,$,ue,X,P,fe="Max. Rooms",Z,H,x,O,j="Generate From Seed",re,he,me="Random Seed (and Generate)",lt,Re,Le=t[3].name+"",Be,it,de,Te,At="Environment:",ot,Ae=t[3].environment+"",Ye,ht,ge,ke,Dt="Total Threat Level:",ct,De=t[3].totalThreatLevel+"",Fe,ut,pe,_e,Mt="Average Threat Level:",mt,Me=t[3].averageThreatLevel+"",Xe,ft,we,dt,gt,It,je=se(t[3].rooms),te=[];for(let N=0;N<je.length;N+=1)te[N]=pn(St(t,je,N));return{c(){e=G(),n=C("section"),s=C("h1"),s.textContent=r,a=G(),i=C("p"),i.textContent=l,c=G(),h=C("div"),u=C("label"),u.textContent=m,p=G(),T=C("input"),w=G(),g=C("div"),v=C("label"),v.textContent=b,I=G(),$=C("input"),ue=G(),X=C("div"),P=C("label"),P.textContent=fe,Z=G(),H=C("input"),x=G(),O=C("button"),O.textContent=j,re=G(),he=C("button"),he.textContent=me,lt=G(),Re=C("h2"),Be=Y(Le),it=G(),de=C("p"),Te=C("strong"),Te.textContent=At,ot=G(),Ye=Y(Ae),ht=G(),ge=C("p"),ke=C("strong"),ke.textContent=Dt,ct=G(),Fe=Y(De),ut=G(),pe=C("p"),_e=C("strong"),_e.textContent=Mt,mt=G(),Xe=Y(Me),ft=G(),we=C("canvas"),dt=G();for(let N=0;N<te.length;N+=1)te[N].c();this.h()},l(N){Mn("svelte-negoxg",Qt.head).forEach(_),e=L(N),n=E(N,"SECTION",{class:!0});var R=U(n);s=E(R,"H1",{class:!0,"data-svelte-h":!0}),ae(s)!=="svelte-ouv5ej"&&(s.textContent=r),a=L(R),i=E(R,"P",{class:!0,"data-svelte-h":!0}),ae(i)!=="svelte-ma8c12"&&(i.textContent=l),c=L(R),h=E(R,"DIV",{class:!0});var xe=U(h);u=E(xe,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),ae(u)!=="svelte-1akft3f"&&(u.textContent=m),p=L(xe),T=E(xe,"INPUT",{type:!0,name:!0,id:!0,class:!0}),xe.forEach(_),w=L(R),g=E(R,"DIV",{class:!0});var We=U(g);v=E(We,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),ae(v)!=="svelte-1oarxv4"&&(v.textContent=b),I=L(We),$=E(We,"INPUT",{type:!0,name:!0,id:!0,class:!0}),We.forEach(_),ue=L(R),X=E(R,"DIV",{class:!0});var Pe=U(X);P=E(Pe,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),ae(P)!=="svelte-fugdp8"&&(P.textContent=fe),Z=L(Pe),H=E(Pe,"INPUT",{type:!0,name:!0,id:!0,class:!0}),Pe.forEach(_),x=L(R),O=E(R,"BUTTON",{class:!0,"data-svelte-h":!0}),ae(O)!=="svelte-1u7zbd5"&&(O.textContent=j),re=L(R),he=E(R,"BUTTON",{class:!0,"data-svelte-h":!0}),ae(he)!=="svelte-192mxrq"&&(he.textContent=me),lt=L(R),Re=E(R,"H2",{class:!0});var Nt=U(Re);Be=F(Nt,Le),Nt.forEach(_),it=L(R),de=E(R,"P",{class:!0});var Ue=U(de);Te=E(Ue,"STRONG",{class:!0,"data-svelte-h":!0}),ae(Te)!=="svelte-1kamiyt"&&(Te.textContent=At),ot=L(Ue),Ye=F(Ue,Ae),Ue.forEach(_),ht=L(R),ge=E(R,"P",{class:!0});var Qe=U(ge);ke=E(Qe,"STRONG",{class:!0,"data-svelte-h":!0}),ae(ke)!=="svelte-1cj036k"&&(ke.textContent=Dt),ct=L(Qe),Fe=F(Qe,De),Qe.forEach(_),ut=L(R),pe=E(R,"P",{class:!0});var Se=U(pe);_e=E(Se,"STRONG",{class:!0,"data-svelte-h":!0}),ae(_e)!=="svelte-1ejia3j"&&(_e.textContent=Mt),mt=L(Se),Xe=F(Se,Me),Se.forEach(_),ft=L(R),we=E(R,"CANVAS",{id:!0,width:!0,height:!0,class:!0}),U(we).forEach(_),dt=L(R);for(let pt=0;pt<te.length;pt+=1)te[pt].l(R);R.forEach(_),this.h()},h(){Qt.title="Dungeon Generator | Iron Arachne",y(s,"class","svelte-jl2xcj"),y(i,"class","svelte-jl2xcj"),y(u,"for","seed"),y(u,"class","svelte-jl2xcj"),y(T,"type","text"),y(T,"name","seed"),y(T,"id","seed"),y(T,"class","svelte-jl2xcj"),y(h,"class","input-group svelte-jl2xcj"),y(v,"for","minRooms"),y(v,"class","svelte-jl2xcj"),y($,"type","number"),y($,"name","minRooms"),y($,"id","minRooms"),y($,"class","svelte-jl2xcj"),y(g,"class","input-group svelte-jl2xcj"),y(P,"for","maxRooms"),y(P,"class","svelte-jl2xcj"),y(H,"type","number"),y(H,"name","maxRooms"),y(H,"id","maxRooms"),y(H,"class","svelte-jl2xcj"),y(X,"class","input-group svelte-jl2xcj"),y(O,"class","svelte-jl2xcj"),y(he,"class","svelte-jl2xcj"),y(Re,"class","svelte-jl2xcj"),y(Te,"class","svelte-jl2xcj"),y(de,"class","svelte-jl2xcj"),y(ke,"class","svelte-jl2xcj"),y(ge,"class","svelte-jl2xcj"),y(_e,"class","svelte-jl2xcj"),y(pe,"class","svelte-jl2xcj"),y(we,"id","mapCanvas"),y(we,"width","800"),y(we,"height","1000"),y(we,"class","svelte-jl2xcj"),y(n,"class","fantasy main svelte-jl2xcj")},m(N,le){Q(N,e,le),Q(N,n,le),f(n,s),f(n,a),f(n,i),f(n,c),f(n,h),f(h,u),f(h,p),f(h,T),Ce(T,t[0]),f(n,w),f(n,g),f(g,v),f(g,I),f(g,$),Ce($,t[1]),f(n,ue),f(n,X),f(X,P),f(X,Z),f(X,H),Ce(H,t[2]),f(n,x),f(n,O),f(n,re),f(n,he),f(n,lt),f(n,Re),f(Re,Be),f(n,it),f(n,de),f(de,Te),f(de,ot),f(de,Ye),f(n,ht),f(n,ge),f(ge,ke),f(ge,ct),f(ge,Fe),f(n,ut),f(n,pe),f(pe,_e),f(pe,mt),f(pe,Xe),f(n,ft),f(n,we),f(n,dt);for(let R=0;R<te.length;R+=1)te[R]&&te[R].m(n,null);gt||(It=[Ie(T,"input",t[6]),Ie($,"input",t[7]),Ie(H,"input",t[8]),Ie(O,"click",t[4]),Ie(he,"click",t[5])],gt=!0)},p(N,le){if(le[0]&1&&T.value!==N[0]&&Ce(T,N[0]),le[0]&2&&Ke($.value)!==N[1]&&Ce($,N[1]),le[0]&4&&Ke(H.value)!==N[2]&&Ce(H,N[2]),le[0]&8&&Le!==(Le=N[3].name+"")&&z(Be,Le),le[0]&8&&Ae!==(Ae=N[3].environment+"")&&z(Ye,Ae),le[0]&8&&De!==(De=N[3].totalThreatLevel+"")&&z(Fe,De),le[0]&8&&Me!==(Me=N[3].averageThreatLevel+"")&&z(Xe,Me),le[0]&8){je=se(N[3].rooms);let R;for(R=0;R<je.length;R+=1){const xe=St(N,je,R);te[R]?te[R].p(xe,le):(te[R]=pn(xe),te[R].c(),te[R].m(n,null))}for(;R<te.length;R+=1)te[R].d(1);te.length=je.length}},i:Vt,o:Vt,d(N){N&&(_(e),_(n)),ve(te,N),gt=!1,Gn(It)}}}function Wr(t,e,n){let s=wt(13),r,a=20,i=30,l=new zn,c=new xr(l);l.minRooms=a,l.maxRooms=i;let h=c.generate(),u=new Mr(800,1e3,l.height,l.width);function m(){K.use(Nn(s)),l.minRooms=a,l.maxRooms=i,n(3,h=c.generate()),u.render(h,r)}function p(){n(0,s=wt(13)),m()}Ln(()=>{r=document.getElementById("mapCanvas"),p()});function T(){s=this.value,n(0,s)}function w(){a=Ke(this.value),n(1,a)}function g(){i=Ke(this.value),n(2,i)}return[s,a,i,h,m,p,T,w,g]}class ca extends An{constructor(e){super(),Dn(this,e,Wr,Xr,On,{},null,[-1,-1])}}export{ca as component};
//# sourceMappingURL=10.aaf8ce19.js.map

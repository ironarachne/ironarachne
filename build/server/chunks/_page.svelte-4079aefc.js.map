{"version":3,"file":"_page.svelte-4079aefc.js","sources":["../../../../src/routes/planet/+page.svelte"],"sourcesContent":["<script lang=\"ts\">\n  import * as RND from '@ironarachne/rng';\n  import * as Classifications from '$lib/planets/classifications';\n  import * as PlanetRenderer from '$lib/renderers/planets/planet-webgl';\n  import * as THREE from 'three';\n  import * as StarfieldShader from '$lib/renderers/starfields/starfield-webgl';\n  import random from 'random';\n  import seedrandom from 'seedrandom';\n\n  import { onMount } from 'svelte';\n  import PlanetGeneratorConfig from '$lib/planets/generatorconfig';\n  import PlanetGenerator from '$lib/planets/generator';\n\n  let materials: THREE.Material[] = [];\n  let meshes: THREE.Mesh[] = [];\n  let geometries: (THREE.PlaneGeometry|THREE.SphereGeometry)[] = [];\n  let planetTypes = Classifications.getClassificationNames();\n  let planetVertexShader = \"\";\n  let planetFragmentShader = \"\";\n  let planetCloudShader = \"\";\n\n  let seed = RND.randomString(13);\n  random.use(seedrandom(seed));\n  let planetType = 'random';\n  let planetGenConfig = new PlanetGeneratorConfig();\n  let planetGen = new PlanetGenerator(planetGenConfig);\n  let planet = planetGen.generate();\n  let initialized = false;\n  let scene = new THREE.Scene();\n  let camera: THREE.PerspectiveCamera;\n  let canvas;\n  let renderer: THREE.WebGLRenderer;\n\n  function clean() {\n    for (let i = 0; i < materials.length; i++) {\n      materials[i].dispose();\n    }\n    for (let i = 0; i < geometries.length; i++) {\n      geometries[i].dispose();\n    }\n    materials = [];\n    meshes = [];\n    geometries = [];\n    renderer.dispose();\n    initialized = false;\n  }\n\n  function generate() {\n    if (initialized) {\n      // If we already have a scene, destroy it and free up its resources\n      clean();\n    }\n\n    random.use(seedrandom(seed));\n\n    if (planetType == 'random') {\n      planetGen.config.possibleClassifications = Classifications.all();\n    } else {\n      let classification = Classifications.getClassificationByName(planetType);\n      if (classification !== undefined) {\n        planetGen.config.possibleClassifications = [\n        classification,\n      ];\n      }\n    }\n\n    planet = planetGen.generate();\n\n    let shaderData = PlanetRenderer.getShaderData(planet.classification.name);\n    planetFragmentShader = shaderData.generateFragmentShader();\n    planetVertexShader = shaderData.generateVertexShader();\n    planetCloudShader = shaderData.generateCloudShader();\n\n    render();\n  }\n\n  function animate() {\n    requestAnimationFrame(animate);\n    renderer.render(scene, camera);\n  }\n\n  function newSeed() {\n    seed = RND.randomString(13);\n    generate();\n  }\n\n  function render() {\n    if (planetType == '') {\n      planetType = 'random';\n    }\n    canvas = document.getElementById('render');\n    scene = new THREE.Scene();\n    camera = new THREE.PerspectiveCamera(65, 600 / 400, 0.1, 100);\n    camera.position.set(0, 10, 20);\n    if (canvas === null) {\n      throw new Error(\"Canvas not found\");\n    }\n    renderer = new THREE.WebGLRenderer({ canvas: canvas, antialias: true });\n    renderer.setSize(600, 400);\n\n    let starfieldGeometry = new THREE.PlaneGeometry(50, 50, 50);\n    geometries.push(starfieldGeometry);\n    let starfieldMaterial = new THREE.ShaderMaterial({\n      fragmentShader: StarfieldShader.generate(),\n    });\n    materials.push(starfieldMaterial);\n    let plane = new THREE.Mesh(starfieldGeometry, starfieldMaterial);\n    meshes.push(plane);\n    scene.add(plane);\n\n    let fragmentShader = planetFragmentShader;\n    let vertexShader = planetVertexShader;\n\n    let uniforms = THREE.UniformsUtils.merge([THREE.UniformsLib['lights']]);\n\n    uniforms.u_resolution = { value: { x: 600, y: 400 } };\n    uniforms.seed = { value: random.float(0, 200.0) };\n\n    let planetSize = PlanetRenderer.translateDiameterToModelSize(planet.diameter);\n\n    let planetGeometry = new THREE.SphereGeometry(planetSize, 32, 32);\n    geometries.push(planetGeometry);\n\n    let planetMaterial = new THREE.ShaderMaterial({\n      uniforms: uniforms,\n      fragmentShader: fragmentShader,\n      vertexShader: vertexShader,\n      lights: true,\n    });\n    materials.push(planetMaterial);\n\n    let light = new THREE.HemisphereLight(0xf6e86d, 0x404040, 0.5);\n    scene.add(light);\n\n    let planetMesh = new THREE.Mesh(planetGeometry, planetMaterial);\n    planetMesh.position.set(0, 10, 0);\n    meshes.push(planetMesh);\n\n    scene.add(planetMesh);\n\n    if (planet.has_clouds) {\n      let cloudsShader = planetCloudShader;\n      let planetCloudGeometry = new THREE.SphereGeometry(planetSize + 0.1, 32, 32);\n      geometries.push(planetCloudGeometry);\n      uniforms.numOctaves = { value: 16 };\n      let cloudsMaterial = new THREE.ShaderMaterial({\n        uniforms: uniforms,\n        fragmentShader: cloudsShader,\n        vertexShader: vertexShader,\n        transparent: true,\n      });\n      materials.push(cloudsMaterial);\n      let clouds = new THREE.Mesh(planetCloudGeometry, cloudsMaterial);\n      clouds.position.set(0, 10, 0);\n      meshes.push(clouds);\n\n      scene.add(clouds);\n    }\n\n    initialized = true;\n    animate();\n  }\n\n  onMount(() => {\n    newSeed();\n  });\n</script>\n\n<svelte:head>\n  <title>Planet Generator | Iron Arachne</title>\n</svelte:head>\n\n<section class=\"main scifi\">\n  <h1>Planet Generator</h1>\n\n  <p>This lets you generate a planet. It uses WebGL and your graphics card.</p>\n\n  <div class=\"input-group\">\n    <label for=\"seed\">Random Seed</label>\n    <input type=\"text\" name=\"seed\" bind:value={seed} id=\"seed\" />\n  </div>\n\n  <div class=\"input-group\">\n    <label for=\"planetType\">Planet Type</label>\n    <select bind:value={planetType} id=\"planetType\">\n      <option>random</option>\n      {#each planetTypes as pType}\n        <option>{pType}</option>\n      {/each}\n    </select>\n  </div>\n\n  <button on:click={generate}>Generate From Seed</button>\n  <button on:click={newSeed}>Random Seed (and Generate)</button>\n\n  <h2>{planet.name}</h2>\n\n  <canvas id=\"render\" />\n\n  <p>{planet.description}</p>\n\n  <p><strong>Planet Type:</strong> {planet.classification.name}</p>\n  <p><strong>Population:</strong> {planet.populationFriendly}</p>\n  <p><strong>Government:</strong> {planet.government}</p>\n  <p><strong>Culture:</strong> {planet.culture}</p>\n  <p>\n    <strong>Distance from Star:</strong>\n    {new Intl.NumberFormat().format(planet.distance_from_sun)} AU\n  </p>\n  <p>\n    <strong>Mass:</strong>\n    {new Intl.NumberFormat().format(planet.mass)} &times; 10<sup>24</sup> kg ({new Intl.NumberFormat().format(\n      Math.floor((planet.mass / 5.9722) * 100),\n    )}% Earth's mass)\n  </p>\n  <p>\n    <strong>Diameter:</strong>\n    {new Intl.NumberFormat().format(Math.floor(planet.diameter))} km ({new Intl.NumberFormat().format(\n      Math.floor((planet.diameter / 12756) * 100),\n    )}% Earth's diameter)\n  </p>\n  <p>\n    <strong>Gravity:</strong>\n    {new Intl.NumberFormat().format(planet.gravity)} m/s<sup>2</sup>\n    ({new Intl.NumberFormat().format(Math.floor((planet.gravity / 9.81) * 100))}% Earth's gravity)\n  </p>\n  <p>\n    <strong>Orbital Period:</strong>\n    {new Intl.NumberFormat().format(Math.floor(planet.orbital_period))} days\n  </p>\n</section>\n\n<style lang=\"scss\">\n  @import \"$lib/styles/reset.scss\";\n  @import \"$lib/styles/main.scss\";\n  @import '$lib/styles/global.scss';\n  @import '$lib/styles/scifi.scss';\n\n  canvas {\n    display: block;\n    width: 600px;\n    height: 400px;\n    margin: 1rem auto;\n  }\n</style>\n"],"names":["Classifications.getClassificationNames"],"mappings":";;;;;;;;;;;;;;;AAgBM,EAAN,IAAM,WAAN,GAAoBA,sBAApB,EAAA,CAAA;AAKA,EAAA,IAAM,IAAN,GAAa,GAAb,CAAiB,YAAjB,CAA8B,EAAE,CAAhC,CAAA;AACE,EAAF,MAAA,CAAS,GAAT,CAAa,UAAb,CAAwB,IAAI,CAAA,CAA5B,CAAA;AAEA,EAAA,IAAM,eAAN,GAA4B,IAAA,qBAA5B,EAAA,CAAA;AACM,EAAN,IAAM,SAAN,GAAM,IAAgB,eAAtB,CAAsC,eAAe,CAArD,CAAA;AACM,EAAN,IAAM,MAAN,GAAe,SAAf,CAAyB,QAAzB,EAAA,CAAA;AAEM,EAAN,IAAkB,KAAlB,CAAwB,KAAxB,EAAA,CAAA;;AAuJ+C,EAA/C,OAA+C,CAA/C,EAA+C,QAA/C,CAA+C,IAA/C,IAA+C,CAA/C,kCAAA,EAA+C,QAA/C,CAA+C,KAA/C,GAA+C,CAA/C,8CAAA,CAAA,EAA+C,EAAA,CAA/C,gCAAA,CAAA,EAA+C,EAAA,CAA/C,icAAA,EAA+C,aAA/C,CAA+C,OAA/C,EAA+C,IAA/C,EAAA,CAAA,CAAA,CAAA,qQAAA,EAAA,IAAA,CAOa,WAPb,EAOwB,CAPxB,KAAA,KAOwB;AACP,IAAjB,OAAiB,CAAjB,OAAA,EAAiB,aAAjB,CAAiB,OAAjB,EAAiB,KAAjB,EAAA,CAAA,CAAA,CAAA,CAAA,EAAA,MAAA,CAAiB,KAAK,CAAA,CAAtB,SAAA,CAAA,CAAA;AAAsB,GAAtB,CAAA,CAAA,uOAAA,EAAA,MAAA,CAQO,MARP,CAQc,IAAI,CAIZ,CAZN,qFAAA,EAYM,MAZN,CAYM,MAZN,CAYa,WAAW,CAAA,CAZxB,mHAAA,EAYwB,MAZxB,CAcoC,MAdpC,CAc2C,cAd3C,CAc0D,IAAI,CAC3B,CAfnC,iHAAA,EAemC,MAfnC,CAemC,MAfnC,CAe0C,kBAAkB,CAAA,CAf5D,kHAAA,EAe4D,MAf5D,CAgBmC,MAhBnC,CAgB0C,UAAU,CACpB,CAjBhC,8GAAA,EAiBgC,MAjBhC,CAiBgC,MAjBhC,CAiBuC,OAAO,CAjB9C,CAAA,0HAAA,EAAA,MAAA,CAAA,IAoBS,IApBT,CAoBc,YApBd,EAAA,CAoB6B,MApB7B,CAoBoC,MApBpC,CAoB2C,iBAAiB,CAAA,CAAA,CApB5D,+GAAA,EAoB4D,MApB5D,CAoB4D,IAInD,IAxBT,CAwBc,YAxBd,EAAA,CAwB6B,MAxB7B,CAwBoC,MAxBpC,CAwB2C,IAAI,CAxB/C,CAAA,CAAA,6EAAA,EAAA,MAAA,CAAA,IAwBmF,IAxBnF,CAwBwF,YAxBxF,EAAA,CAwBuG,MAxBvG,CAyBM,IAzBN,CAyBW,KAzBX,CAyBkB,MAzBlB,CAyByB,IAzBzB,GAyBgC,MAzBhC,GAyB0C,GAAG,CAKpC,CAAA,CAAA,CA9BT,mIAAA,EA8BS,MA9BT,CA8BS,IAAA,IA9BT,CA8Bc,YA9Bd,EAAA,CA8B6B,MA9B7B,CA8BoC,IA9BpC,CA8ByC,KA9BzC,CA8B+C,MA9B/C,CA8BsD,QAAQ,CAAa,CAAA,CAAA,CA9B3E,KAAA,EA8B2E,MA9B3E,CA8B2E,IAAA,IA9B3E,CA8BgF,YA9BhF,EAAA,CA8B+F,MA9B/F,CA+BM,IA/BN,CA+BW,KA/BX,CA+BkB,MA/BlB,CA+ByB,QA/BzB,GA+BoC,KA/BpC,GA+B6C,GAAG,CAKvC,CAAA,CAAA,CApCT,qIAAA,EAoCS,MApCT,CAoCS,IAAA,IApCT,CAoCc,YApCd,EAAA,CAoC6B,MApC7B,CAoCoC,MApCpC,CAoC2C,OAAO,CAAA,CAAA,CApClD;AAoCkD,KAAlD,EACU,MADV,CACU,IAAA,IADV,CACe,YADf,EAAA,CAC8B,MAD9B,CACqC,IADrC,CAC0C,KAD1C,CACiD,MADjD,CACwD,OADxD,GACkE,IADlE,GAC0E,GAAG,CAIpE,CAAA,CAAA,CALT,4IAAA,EAKS,MALT,CAKS,IAAA,IALT,CAKc,YALd,EAAA,CAK6B,MAL7B,CAKoC,IALpC,CAKyC,KALzC,CAK+C,MAL/C,CAKsD,cAAc,CAAA,CAAA,CAAA,CALpE,oBAAA,CAAA,CAAA;;;;;"}